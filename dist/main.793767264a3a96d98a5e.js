(()=>{var e,t={3607:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,o){function a(e){try{l(s.next(e))}catch(e){o(e)}}function r(e){try{l(s.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),i(5996),i(9520);const n=i(8838),o=i(6649),a=i(6285);!function(){s(this,void 0,void 0,(function*(){const e=document.getElementById("view");let t;(yield a.WebGPUEngine.IsSupportedAsync)?(t=new a.WebGPUEngine(e),yield t.initAsync()):t=new n.Engine(e,!0),new o.default(t).init().then((()=>{t.runRenderLoop((()=>{const e=t.scenes[0];e&&e.update()}))}))}))}()},6867:(e,t)=>{"use strict";var i,s;Object.defineProperty(t,"__esModule",{value:!0}),t.AudioLocation=t.AudioType=void 0,(s=t.AudioType||(t.AudioType={}))[s.AMBIENT=0]="AMBIENT",s[s.BATTLE=1]="BATTLE",s[s.BATTLE_BOSS=2]="BATTLE_BOSS",(i=t.AudioLocation||(t.AudioLocation={}))[i.GLOBAL=0]="GLOBAL",i[i.LOCAL=1]="LOCAL"},6491:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.MissionType=void 0,(i=t.MissionType||(t.MissionType={}))[i.DUMMY=0]="DUMMY",i[i.TRIGGER=1]="TRIGGER",i[i.KILL_MONSTERS=2]="KILL_MONSTERS",i[i.KILL_ANY_MONSTER=3]="KILL_ANY_MONSTER",i[i.TALK_TO_NPC=4]="TALK_TO_NPC",i[i.FOLLOW_NPC=5]="FOLLOW_NPC"},671:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(7872);t.default=class{static get characters(){return s.characters}static get monsters(){return s.monsters}static get projectiles(){return s.projectiles}static get scenes(){return s.scenes}static get npcs(){return s.npcs}static get audios(){return s.audios}static get globals(){return s.globals}static get missions(){return s.missions}static getCharacter(e){return s.characters.find((t=>t.id===e))}static getMonster(e){return s.monsters.find((t=>t.id===e))}static getNpc(e){return s.npcs.find((t=>t.id===e))}static getProjectile(e){return s.projectiles.find((t=>t.id===e))}static getScene(e){return s.scenes.find((t=>t.id===e))}static getMission(e){return s.missions.find((t=>t.id===e))}}},871:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(2557),n=i(5038),o=i(8403),a=i(320),r=i(4473),l=i(3120);class h extends l.default{constructor(e,t){super(e,t),this._direction=0,this.addComponent(new o.default(this,e.hitpoint,1)),this.addComponent(new n.default(this,e.combat)),this.addComponent(new a.default(this,e.movement)),this.addComponent(new r.default(this,e.render)),this.addComponent(new s.default(this,e.animation))}get direction(){return this._direction}set direction(e){this._direction=e}load(e){super.load(e),this._direction=e.direction}save(){let e=super.save();return e.direction=this._direction,e}get type(){return l.GameObjectType.Character}}t.default=h},4365:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(3120);class n extends s.default{constructor(e,t){super(e,t),this._itemIds=[],this._opened=!1}get type(){return s.GameObjectType.Chest}load(e){super.load(e),this._itemIds=e.drops,this._opened=e.opened||!1}save(){let e=super.save();return e.drops=this._itemIds,e.opened=this._opened,e}}t.default=n},2439:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6285),n=i(5176),o=i(8629),a=i(320);class r extends a.default{constructor(){super(...arguments),this.onMove=()=>{},this._path=[],this._pathIndex=0,this._pause=!1}moveTo(e){if(this.parent.position.equals(e))return;const t=this._parent.position,i=this._parent.level.tileMap.pathFinder.findPath(t,e);0!==i.length?(this._path=i,this._pathIndex=0):console.warn("No path found")}clearPath(){this._path=[],this._pathIndex=0,this._velocity=s.Vector2.Zero()}update(){if(!this.parent.alive)return;if(0===this._path.length)return;if(this._pause)return void this.onMove(0);const e=this._config.speed*n.default.TICK_DELTA_TIME;this.updatePFMove(e),this.updateDirection(),0===this._path.length?this.onMove(0):this.onMove(1)}updatePFMove(e){const t=this._path[this._pathIndex],i=s.Vector2.Distance(this.parent.position,t);if(i<e)this.parent.position=t,this._pathIndex++,this._pathIndex>=this._path.length?this.clearPath():this.updatePFMove(e-i);else{const i=s.Vector2.Normalize(t.subtract(this.parent.position));this._velocity=i.scale(e),this.parent.position=this.parent.position.add(this._velocity)}}get type(){return o.ComponentType.MonsterMovement}pause(){this._pause=!0}resume(){this._pause=!1}get paused(){return this._pause}}t.default=r},2557:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(8629),n=i(320),o=i(2439),a=i(8403),r=i(4473),l=i(5038),h=i(1076);class c extends s.default{constructor(e,t=null){var i,s;super(e),this._groups={},this._config=t;let c=!1,d=!1;const p=null!==(i=this.parent.findComponent(n.default))&&void 0!==i?i:this.parent.findComponent(o.default);p&&(p.onMove=e=>{e<.25?c||d&&this._currentGroup.isPlaying||(c=!0,d=!1,this.play("idle")):(c=!1,d=!1,this.play("walk",e))});const u=null!==(s=this.parent.findComponent(l.default))&&void 0!==s?s:this.parent.findComponent(h.default);u&&u.onAttack.add((()=>{this.play("attack"),d=!0}));const _=this.parent.findComponent(a.default);_&&(_.onDeath.add((()=>{this.play("die"),d=!1})),_.onDamage.add((()=>{this.play("damage"),d=!1})));const m=this.parent.findComponent(r.default);m&&m.onLoaded.add((()=>{this.play("idle",1,!0,!1)}))}_loadAnimation(e,t=1,i=!0,s=!0){let n=e.clip;if(e.alt&&e.alt.length>0&&s){const t=Math.random()*(e.alt.length+1);t<e.alt.length&&(n=e.alt[Math.floor(t)])}const o=this._groups[n];if(!o)return console.warn(`Animation group ${n} not found`),null;o.speedRatio=t*e.speed,o!==this._currentGroup&&(o.play(e.loop),i&&this._currentGroup&&this._currentGroup.stop(),this._currentGroup=o)}play(e,t=1,i=!0,s=!0){let n;switch(e){case"idle":n=this._config.idle;break;case"walk":n=this._config.walk;break;case"attack":n=this._config.attack;break;case"die":n=this._config.die;break;case"damage":n=this._config.damage;break;default:return void console.warn(`Unknown animation clip ${e}`)}this._loadAnimation(n,t,i,s)}get type(){return s.ComponentType.Animation}update(){}setGroups(e){e.forEach((e=>{this._groups[e.name]=e}))}}t.default=c},5038:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(671),n=i(5176),o=i(3639),a=i(8629),r=i(8403),l=i(1253);class h extends a.default{constructor(e=null,t=null){super(e),this.onAttack=new l.EventList,this._attackCooldown=0,this._config=t}get type(){return a.ComponentType.Combat}get canAttack(){return this._attackCooldown<=0}get team(){return this._parent.getComponent(r.default).team}attack(e){if(console.assert(this.canAttack,"Cannot attack"),console.log("Attack"),this._attackCooldown=n.default.getTicks(this._config.attackDelay),this._config.projectileId){const t=s.default.getProjectile(this._config.projectileId),i=new o.default(t,this._parent.level);i.init(e,this._config.shootDamage,this._config.projectileSpeed,this.team,this._config.shootRadius,n.default.getTicks(this._config.projectileLifetime)),i.position.set(this._parent.position.x,this._parent.position.y),i.direction=e,this._parent.gameObjectManager.addObject(i)}else{const e=this._parent.gameObjectManager.objects.values(),t=this._parent.position;for(const i of e){const e=i.position,s=e.x-t.x,n=e.y-t.y;if(Math.sqrt(s*s+n*n)<=this._config.shootRadius){const e=i.findComponent(r.default);e&&e.team!=this.team&&e.hit(this._config.shootDamage)}}}this.onAttack.trigger()}update(){this._attackCooldown>0&&this._attackCooldown--}}t.default=h},8629:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ComponentType=void 0,function(e){e[e.Movement=0]="Movement",e[e.Render=1]="Render",e[e.Animation=2]="Animation",e[e.MonsterMovement=3]="MonsterMovement",e[e.Combat=4]="Combat",e[e.MonsterCombat=5]="MonsterCombat",e[e.Hitpoint=6]="Hitpoint"}(i||(i={})),t.ComponentType=i,t.default=class{constructor(e){this._parent=e}destroy(){this._parent=null}get parent(){return this._parent}}},8403:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(5176),n=i(8629),o=i(1253);class a extends n.default{constructor(e,t=null,i=0){super(e),this.onDamage=new o.EventListT,this.onHeal=new o.EventListT,this.onDeath=new o.EventList,this._config=t,this._hitpoint=t.max,this._regenDelay=0,this._team=i}get type(){return n.ComponentType.Hitpoint}get alive(){return this._hitpoint>0}get hitpoint(){return this._hitpoint}get maxHitpoint(){return this._config.max}get team(){return this._team}heal(e){this.alive&&(this._hitpoint=Math.min(this._hitpoint+e,this._config.max),this.onHeal.trigger(e))}hit(e){this.alive&&(this._hitpoint=Math.max(this._hitpoint-e,0),this._regenDelay=s.default.getTicks(this._config.regenDelay),this.onDamage.trigger(e),this.alive||(this._deathDespawnDelay=s.default.getTicks(.75),this.onDeath.trigger()))}update(){this._regenDelay--,this._regenDelay<=0&&this._config.regenAmount>0&&(this._regenDelay=s.default.getTicks(this._config.regenDelay),this.heal(this._config.regenAmount)),this.alive||(this._deathDespawnDelay--,this._deathDespawnDelay<=0&&this.parent.gameObjectManager.removeObject(this.parent))}}t.default=a},1076:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6285),n=i(5038),o=i(8629),a=i(5176),r=i(2439);class l extends n.default{constructor(e,t=null){super(e,t),this._patrolPointIndex=-1,this._alertInRadius=t.alertInRadius,this._alertOutRadius=t.alertOutRadius,this._patrolRadius=t.patrolRadius}get type(){return o.ComponentType.MonsterCombat}freezePatrol(){this._patrolPoints=[new s.Vector2(this.parent.position.x,this.parent.position.y)],this._patrolPointIndex=0}get isFrozenPatrol(){return null!=this._patrolPoints&&1==this._patrolPoints.length}get isAlerted(){return this._alerted}update(){super.update(),this.parent.alive&&(--this._freezeTime>0||(null==this._patrolPoints&&this.calculatePatrolPoints(),this.checkAlert(),this.checkAttack(),this.checkPatrol()))}checkAlert(){if(this._alertCheckDelay--,this._alertCheckDelay>0)return;this._alertCheckDelay=l.AlertCheckTimer;const e=this.findEnemyInRadius(this._alerted?this._alertOutRadius:this._alertInRadius);null!=e?(this._alerted=!0,this.setTarget(e)):(this._alerted=!1,this.setTarget(null))}checkAttack(){const e=this._currentTarget;if(null==e)return;if(!this.canAttack)return;const t=this._parent.position,i=e.position,n=s.Vector2.DistanceSquared(t,i),o=1.25*this.attackRange;if(n<=o*o){const e=i.subtract(t),s=Math.atan2(e.y,e.x);this.attack(s),this._freezeTime=a.default.getTicks(1)}}checkPatrol(){if(!this._alerted&&null!=this.findEnemyInRadius(25)){if(this.isOnPatrolPoint()){if(this._patrolStayTimer--,this._patrolStayTimer>0)return}else if(this._patrolPointIndex>=0)return;this._patrolStayTimer=l.PatrolStayTimer,this._patrolPointIndex=(this._patrolPointIndex+1)%this._patrolPoints.length,this.moveToPatrolPoint()}}moveToPatrolPoint(){-1!==this._patrolPointIndex&&this.parent.getComponent(r.default).moveTo(this._patrolPoints[this._patrolPointIndex])}setTarget(e){if(null===e&&null===this._currentTarget)return;this._currentTarget=e,this._currentTargetPosition=null==e?void 0:e.position.clone();const t=this.parent.getComponent(r.default);null!=e?t.moveTo(this.findBestAttackPosition()):(this._patrolStayTimer=l.PatrolStayTimer,this._patrolPointIndex=this.searchClosestPatrolPointIndex(),console.log("searchClosestPatrolPointIndex",this._patrolPointIndex),this.moveToPatrolPoint())}findBestAttackPosition(){const e=this._parent.position,t=this._currentTargetPosition.subtract(e),i=t.length()-.75*this.attackRange;return i<=0?e:e.add(t.normalize().scale(i))}get attackRange(){let e=this._config.shootRadius;return this._config.projectileId&&(e+=this._config.projectileSpeed*(.1*this._config.projectileLifetime)),e}findEnemyInRadius(e){const t=e*e,i=this._parent.gameObjectManager.objects.values();let n=null,o=Number.MAX_VALUE;for(const e of i)if(e.alive&&e.team!==this._parent.team&&-1!==e.team){const i=s.Vector2.DistanceSquared(e.position,this._parent.position);i<=t&&i<o&&(o=i,n=e)}return n}calculatePatrolPoints(){this._patrolPoints=[],this._patrolPointIndex=-1;const e=this._parent.position.clone();for(let t=0;t<l.NumPatrolPoints;t++){const i=2*Math.PI*t/l.NumPatrolPoints,n=this._patrolRadius,o=e.x+n*Math.cos(i),a=e.y+n*Math.sin(i),r=new s.Vector2(o,a);this.parent.level.isPassableTile(r)&&this._patrolPoints.push(r)}for(let e=0;e<this._patrolPoints.length;e++){const t=Math.floor(Math.random()*this._patrolPoints.length),i=this._patrolPoints[e];this._patrolPoints[e]=this._patrolPoints[t],this._patrolPoints[t]=i}}searchClosestPatrolPointIndex(){const e=this._parent.position;let t=Number.MAX_VALUE,i=-1;for(let n=0;n<this._patrolPoints.length;n++){const o=s.Vector2.DistanceSquared(e,this._patrolPoints[n]);o<t&&(t=o,i=n)}return i}isOnPatrolPoint(){const e=this._parent.position,t=this._patrolPoints[this._patrolPointIndex];return s.Vector2.DistanceSquared(e,t)<=.1}}t.default=l,l.AlertCheckTimer=a.default.getTicks(1),l.PatrolStayTimer=a.default.getTicks(2.5),l.NumPatrolPoints=4},320:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MovementInput=void 0;const s=i(5412),n=i(5176),o=i(8629);class a extends o.default{constructor(e,t=null){super(e),this.onMove=()=>{},this._dashing=!1,this._dashTimer=0,this.input=new r,this._velocity=s.Vector2.Zero(),this._config=t}get type(){return o.ComponentType.Movement}get canDash(){return this._dashTimer<=0}update(){this.parent.alive&&(!1!==this._parent.level.isPassableTile(this._parent.position)?(this.updateMove(this.input),this.updateDirection()):console.warn("Character is not on passable tile"))}updateMove(e){let t=e.axis;if(t.lengthSquared()>1&&t.normalize(),--this._dashTimer,e.dash&&!this._dashing&&this.canDash){if(this._dashing=!0,this._dashTimer=a.DASH_TIME,e.dash=!1,0===t.lengthSquared()){const e=this._parent.direction-Math.PI/2;t.x=Math.cos(e),t.y=Math.sin(e),t.normalize()}this._velocity=t.scale(this._config.dashSpeed)}else this._dashing||0===t.lengthSquared()?(this._velocity=s.Vector2.Lerp(this._velocity,s.Vector2.Zero(),(this._dashing?this._config.dashDeceleration:this._config.deceleration)*n.default.TICK_DELTA_TIME),this._dashing&&(this._dashing=this._velocity.lengthSquared()>this._config.speed*this._config.speed)):this._velocity=s.Vector2.Lerp(this._velocity,t.scale(this._config.speed),this._config.acceleration*n.default.TICK_DELTA_TIME);const i=this._velocity.clone().scale(n.default.TICK_DELTA_TIME),o=this._parent.level;let r=this._parent.position.add(i);if(!o.isPassableTile(r)){const e=r.clone();e.x=this._parent.position.x,o.isPassableTile(e)?r=e:(e.x=r.x,e.y=this._parent.position.y,r=o.isPassableTile(e)?e:this._parent.position)}this._parent.position=r,this.onMove(this._velocity.length()/this._config.speed)}updateDirection(){let e=this._velocity;if(e.lengthSquared()>1&&(e=e.clone().normalize()),e.lengthSquared()>.001){let t=Math.atan2(e.y,e.x);this.parent.direction=t+Math.PI/2}}}a.DASH_TIME=n.default.getTicks(1.5);class r{constructor(){this.axis=s.Vector2.Zero(),this.dash=!1}}t.MovementInput=r,t.default=a},4473:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6285),n=i(3063),o=i(2557),a=i(8629),r=i(1253);class l extends a.default{constructor(e,t=null){super(e),this.onLoaded=new r.EventListT,this._hide=!1,this._handle=n.default.instance.load(t.model),this._handle.onLoaded=e=>{this._mesh=e.meshes[0],e.animationGroups.forEach((e=>{e.targetedAnimations.forEach((e=>{e.animation.enableBlending=!0,e.animation.blendingSpeed=.25}))})),this._mesh.scaling=new s.Vector3(-t.scale,t.scale,-t.scale),this._rotationOffsetX=t.rotation*(Math.PI/180);const i=this.parent.findComponent(o.default);i&&i.setGroups(e.animationGroups);const n=this._mesh.getScene();n?(n.onBeforeRenderObservable.add(this.updateRender.bind(this)),this._mesh.position=new s.Vector3(this.parent.position.x,0,this.parent.position.y)):console.error("No scene found for mesh"),this.onLoaded.trigger(this._mesh)}}destroy(){super.destroy(),this._mesh&&(this._mesh.dispose(),this._mesh=null),this._handle&&(this._handle.dispose(),this._handle=null)}get type(){return a.ComponentType.Render}update(){}updateRender(){if(this._mesh){const e=new s.Vector3(this.parent.position.x,0,this.parent.position.y),t=this._mesh.rotation,i=new s.Vector3(this._rotationOffsetX,-this.parent.direction,0).subtract(t);i.y>Math.PI&&(i.y-=2*Math.PI),i.y<-Math.PI&&(i.y+=2*Math.PI),this._mesh.position=s.Vector3.Lerp(this._mesh.position,e,.2),this._mesh.rotation=t.add(i.scale(.2)),this._hide?(e.y=-100,this._mesh.position=e):this._mesh.position.y<-.1&&(this._mesh.position=e)}}hide(){this._hide=!0}show(){this._hide=!1}}t.default=l},3120:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GameObjectType=void 0;const s=i(5412),n=i(8403);var o;t.default=class{constructor(e,t){this._components=new Map,this._level=t,this._config=e,this._id=-1,this._position=s.Vector2.Zero()}destroy(){this._components.forEach((e=>{e.destroy()})),this._components.clear()}get id(){return this._id}set id(e){this._id=e}get level(){return this._level}get gameObjectManager(){return this._level.gameObjectManager}get config(){return this._config}get position(){return this._position}set position(e){this._position=e}get direction(){return 0}set direction(e){}get team(){const e=this.findComponent(n.default);return e?e.team:-1}get alive(){const e=this.findComponent(n.default);return!e||e.alive}getComponent(e){const t=e.prototype.type;if(!this._components.has(t))throw new Error(`Component of type ${t} does not exist.`);return this._components.get(t)}findComponent(e){const t=e.prototype.type;return this._components.has(t)?this._components.get(t):null}addComponent(e){if(this._components.has(e.type))throw new Error(`Component of type ${e.type} already exists.`);this._components.set(e.type,e)}update(){this._components.forEach((e=>{e.update()}))}load(e){this._id=e.id,this._position=new s.Vector2(e.position.x,e.position.y)}save(){return{id:this._id,position:{x:this._position.x,y:this._position.y}}}},(o=t.GameObjectType||(t.GameObjectType={}))[o.Character=0]="Character",o[o.Monster=1]="Monster",o[o.Projectile=2]="Projectile",o[o.Chest=3]="Chest",o[o.Trigger=4]="Trigger",o[o.Npc=5]="Npc"},5163:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(4365),n=i(671),o=i(871),a=i(3120),r=i(3115),l=i(5832),h=i(9973);t.default=class{constructor(e){this.onNewObject=()=>{},this.onRemoveObject=()=>{},this._objects=new Map,this._nextId=0,this._level=e}get level(){return this._level}get objects(){return this._objects}addObject(e){if(-1==e.id?e.id=this._nextId++:this._nextId=Math.max(this._nextId,e.id+1),this._objects.has(e.id))throw new Error(`Object with id ${e.id} already exists.`);this._objects.set(e.id,e),this.onNewObject(e)}removeObject(e){if(!this._objects.has(e.id))throw new Error(`Object with id ${e.id} does not exist.`);e.destroy(),this._objects.delete(e.id),this.onRemoveObject(e)}getObject(e){return this._objects.get(e)}destroy(){this._objects.forEach((e=>{e.destroy()})),this._objects.clear(),this._nextId=0}load(e){this.destroy();for(let t=0;t<e.length;t++){console.log(e[t]);const i=e[t],s=i.type,n=i.config,o=this.createObject(s,n);o.id=i.id,o.load(i),this.addObject(o)}}save(){let e=[];return this._objects.forEach((t=>{let i=t.save();i.type=t.type,i.config=t.config.id,i.id=t.id,e.push(i)})),e}update(){this._objects.forEach((e=>{e.update()}))}createObject(e,t){switch(e){case a.GameObjectType.Character:return new o.default(n.default.getCharacter(t),this._level);case a.GameObjectType.Monster:return new r.default(n.default.getMonster(t),this._level);case a.GameObjectType.Chest:return new s.default({id:1,name:"Dummy_Chest"},this._level);case a.GameObjectType.Trigger:return new l.default({id:2,name:"Dummy_Trigger"},this._level);case a.GameObjectType.Npc:return new h.default(n.default.getNpc(t),this._level);default:throw new Error(`Unknown game object type: ${e}`)}}get player(){const e=this._objects.values();for(const t of e)if(t.type==a.GameObjectType.Character)return t;return null}}},3115:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(2557),n=i(8403),o=i(1076),a=i(2439),r=i(4473),l=i(3120);class h extends l.default{constructor(e,t){super(e,t),this._direction=0,this.addComponent(new n.default(this,e.hitpoint)),this.addComponent(new a.default(this,e.movement)),this.addComponent(new o.default(this,e.combat)),this.addComponent(new r.default(this,e.render)),this.addComponent(new s.default(this,e.animation))}get direction(){return this._direction}set direction(e){this._direction=e}load(e){super.load(e),this._direction=e.direction,e.freezePatrol&&this.findComponent(o.default).freezePatrol()}save(){let e=super.save();return e.direction=this._direction,e.freezePatrol=this.findComponent(o.default).isFrozenPatrol,e}get type(){return l.GameObjectType.Monster}}t.default=h},9973:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(2557),n=i(2439),o=i(4473),a=i(3120),r=i(671),l=i(5176),h=i(6285);class c extends a.default{constructor(e,t){super(e,t),this._startWaitingDistance=0,this._endWaitingDistance=0,this._waitingCheckTimer=0,this._direction=0,this.addComponent(new n.default(this,r.default.globals.npcMovement)),this.addComponent(new o.default(this,e.render)),this.addComponent(new s.default(this,e.animation)),this._startWaitingDistance=r.default.globals.npcStartWaitingPlayerDistance,this._endWaitingDistance=r.default.globals.npcStartChasingPlayerDistance,this._waitingCheckTimer=l.default.getTicks(.5)}get direction(){return this._direction}set direction(e){this._direction=e}load(e){super.load(e),this._direction=e.direction||0}save(){let e=super.save();return e.direction=this._direction||0,e}get type(){return a.GameObjectType.Npc}update(){if(super.update(),--this._waitingCheckTimer<=0){this._waitingCheckTimer=l.default.getTicks(.5);const e=this.gameObjectManager.player;if(e){const t=this.getComponent(n.default),i=h.Vector2.DistanceSquared(this.position,e.position);i>=this._startWaitingDistance*this._startWaitingDistance?t.pause():i<=this._endWaitingDistance*this._endWaitingDistance&&t.resume()}}}}t.default=c},3639:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6285),n=i(4473),o=i(3120),a=i(8403),r=i(5176);class l extends o.default{constructor(e,t){super(e,t),this.addComponent(new n.default(this,e.render))}init(e,t,i,s,n,o){this._direction=e,this._damage=t,this._speed=i,this._team=s,this._radius=n,this._lifeTime=o}get type(){return o.GameObjectType.Projectile}get direction(){return this._direction}set direction(e){this._direction=e}update(){if(this._lifeTime--,0==this._lifeTime)return void this.gameObjectManager.removeObject(this);const e=this.position,t=this.position.clone();t.x+=Math.cos(this._direction)*this._speed*r.default.TICK_DELTA_TIME,t.y+=Math.sin(this._direction)*this._speed*r.default.TICK_DELTA_TIME;let i=!1;const s=this.gameObjectManager.objects.values();for(const n of s){const s=n.position;if(this.isInLine(e,t,this._radius,s)){const e=n.findComponent(a.default);null!==e&&e.team!=this._team&&(e.hit(this._damage),i=!0)}}i&&this.gameObjectManager.removeObject(this),this.position=t,super.update()}isInLine(e,t,i,n){const o=e.clone().add(new s.Vector2(-i,-i)),a=e.clone().add(new s.Vector2(i,-i)),r=e.clone().add(new s.Vector2(i,i)),l=e.clone().add(new s.Vector2(-i,i)),h=this.isInTriangle(o,a,t,n),c=this.isInTriangle(a,r,t,n),d=this.isInTriangle(r,l,t,n);return h||c||d}isInTriangle(e,t,i,s){const n=s.x-e.x,o=s.y-e.y,a=(t.x-e.x)*o-(t.y-e.y)*n>0;return(i.x-e.x)*o-(i.y-e.y)*n>0!=a&&(i.x-t.x)*(s.y-t.y)-(i.y-t.y)*(s.x-t.x)>0==a}}t.default=l},5832:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(3120),n=i(1253);class o extends s.default{constructor(e,t){super(e,t),this.onTrigger=new n.EventList,this.onReset=new n.EventList}get type(){return s.GameObjectType.Trigger}update(){if(super.update(),this._triggered&&!this._autoReset)return;let e=!1;const t=this.gameObjectManager.objects.values();for(const i of t)if(i.type==s.GameObjectType.Character){const t=i.position;if(t.x>=this._area.xMin&&t.x<=this._area.xMax&&t.y>=this._area.yMin&&t.y<=this._area.yMax){e=!0;break}}e!=this._triggered&&(this._triggered=e,this._triggered?this.onTrigger.trigger():this.onReset.trigger())}load(e){super.load(e),this._triggered=e.triggered||!1,this._area={xMin:e.area[0],yMin:e.area[1],xMax:e.area[2],yMax:e.area[3]},this._autoReset=e.autoReset||!1}save(){let e=super.save();return e.triggered=this._triggered,e.area=[this._area.xMin,this._area.yMin,this._area.xMax,this._area.yMax],e.autoReset=this._autoReset,e}get triggered(){return this._triggered}}t.default=o},4026:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6285),n=i(5163),o=i(7163),a=i(1571);t.default=class{constructor(e,t,i){this._points=new Map,this._id=e,this._tileMap=new o.default(t,i),this._gameObjectManager=new n.default(this),this._missionManager=new a.default(this),this._points=new Map}get id(){return this._id}get size(){return this._tileMap.size}get resolution(){return this._tileMap.resolution}get gameObjectManager(){return this._gameObjectManager}get tileMap(){return this._tileMap}get missionManager(){return this._missionManager}destroy(){this._gameObjectManager.destroy()}load(e){const t=e.objects;this._gameObjectManager.load(t);const i=e.points;this._points.clear();for(const e of i){const t=e.id,i=e.position;this._points.set(t,new s.Vector2(i.x,i.y))}}save(){return{objects:this._gameObjectManager.save(),points:Array.from(this._points.entries()).map((([e,t])=>({id:e,position:{x:t.x,y:t.y}})))}}isPassableTile(e){const t=this._tileMap.get(e),i=0!=(t&o.TileState.Terrain);return!(0!=(t&o.TileState.Water)&&!i)&&0==(t&o.TileState.Object)}getPoint(e){return this._points.get(e)||s.Vector2.Zero()}update(){this._gameObjectManager.update(),this._missionManager.update()}}},7163:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileState=void 0;const s=i(6285),n=i(1502);var o;t.default=class{constructor(e,t){this._size=e,this._subSize=new s.Vector2(e.x*t,e.y*t),this._states=new Uint8Array(this._subSize.x*this._subSize.y),this._resolution=t,this._pathFinder=new n.default(this)}get size(){return this._size}get subSize(){return this._subSize}get resolution(){return this._resolution}get states(){return this._states}get pathFinder(){return this._pathFinder}get(e){const t=Math.floor(e.x*this._resolution),i=Math.floor(e.y*this._resolution);return this.getSubTile(t,i)}set(e,t){const i=Math.floor(e.x*this._resolution),s=Math.floor(e.y*this._resolution);this.setSubTile(i,s,t)}getSubTile(e,t){return e<0||e>=this._subSize.x||t<0||t>=this._subSize.y?o.Object:this._states[e*this._subSize.y+t]}setSubTile(e,t,i){if(e<0||e>=this._subSize.x||t<0||t>=this._subSize.y)throw new Error("Position out of bounds");this._states[e*this._subSize.y+t]=i}setSubTiles(e,t,i,s){if(t!==this._subSize.x||i!==this._subSize.y)throw new Error("Invalid size");if(s!==this._resolution)throw new Error("Invalid precision");this._states=e,this._pathFinder.updateGrid()}updatePathFinder(){this._pathFinder.updateGrid()}destroy(){this._states=new Uint8Array(0)}},function(e){e[e.None=0]="None",e[e.Terrain=1]="Terrain",e[e.Water=2]="Water",e[e.Object=4]="Object"}(o=t.TileState||(t.TileState={}))},1571:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(7275),n=i(671);t.default=class{constructor(e){this._level=e,this._currentMission=null,this._completedMissions=[]}update(){var e;null===this._currentMission||this._currentMission.isCompleted?(this._currentMission&&this._completedMissions.push(this._currentMission.config),this._currentMission=this.searchOpenMission(),null===(e=this._currentMission)||void 0===e||e.start()):this._currentMission.update()}get currentMission(){return this._currentMission}isMissionCompleted(e){return this._completedMissions.includes(e)}searchOpenMission(){for(const e of n.default.missions)if(e.sceneId===this._level.id&&!this.isMissionCompleted(e)&&!e.dependencyIds.some((e=>!this.isMissionCompleted(n.default.getMission(e)))))return new s.default(e,this._level);return null}getCompletedMissionsInGroup(e){return n.default.missions.filter((t=>t.groupId===e)).filter((e=>this.isMissionCompleted(e)))}getTotalMissionsInGroup(e){return n.default.missions.filter((t=>t.groupId===e)).length}}},7275:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6491),n=i(3115),o=i(8403),a=i(6285),r=i(2439);t.default=class{constructor(e,t){switch(this._config=e,this._level=t,this._requiredProgress=1,this._progress=0,this._npc=null,this._npcMovePoints=[],this._config.type){case s.MissionType.TRIGGER:{this._requiredProgress=this._config.triggerIds.length;const e=t.gameObjectManager;for(const t of this._config.triggerIds){const i=e.getObject(t);i.triggered?this._progress++:(i.onTrigger.add(this.completionEvent.bind(this)),console.log(`Mission ${this._config.id} is waiting for trigger ${t}`))}break}case s.MissionType.KILL_MONSTERS:{this._requiredProgress=this._config.monsterIds.length;const e=t.gameObjectManager;for(const t of this._config.monsterIds){const i=e.getObject(t);if(!i){this._progress++;continue}const s=i.findComponent(o.default);null!==s&&s.alive?s.onDeath.add(this.completionEvent.bind(this)):this._progress++}break}case s.MissionType.KILL_ANY_MONSTER:this._requiredProgress=this._config.monsterCount,this._progress=Math.max(this._config.monsterCount-this.calculateTotalKillableMonsters(),0);break;case s.MissionType.FOLLOW_NPC:if(this._requiredProgress=this._config.npcMovePointIds.length,this._npc=t.gameObjectManager.getObject(this._config.npcId),!this._npc){console.warn(`Mission ${this._config.id} has no NPC`),this._progress=this._requiredProgress;break}for(const e of this._config.npcMovePointIds)this._npcMovePoints.push(t.getPoint(e))}if(0!=this._config.tpPoint){const e=t.getPoint(this._config.tpPoint);t.gameObjectManager.player.position=e.clone()}this._progress>=this._requiredProgress&&this.complete()}start(){console.log(`Mission ${this._config.id} is started`),this._config.type===s.MissionType.FOLLOW_NPC&&this.moveNpcToNextPoint()}completionEvent(){this._progress<this._requiredProgress&&(this._progress++,this._progress>=this._requiredProgress&&this.complete())}complete(){this._progress=this._requiredProgress,this._completed=!0,console.log(`Mission ${this._config.id} is completed`)}get config(){return this._config}get isCompleted(){return this._completed}get npc(){return this._npc}get progress(){return this._progress}get requiredProgress(){return this._requiredProgress}update(){if(this._config.type===s.MissionType.FOLLOW_NPC){const e=this._npc.position,t=this._npcMovePoints[this._progress];a.Vector2.DistanceSquared(e,t)<.1&&(this.completionEvent(),this._progress<this._requiredProgress&&this.moveNpcToNextPoint())}}moveNpcToNextPoint(){const e=this._npcMovePoints[this._progress];this._npc.getComponent(r.default).moveTo(e)}calculateTotalKillableMonsters(){const e=this._level.gameObjectManager;let t=0;for(const i of e.objects.values())if(i instanceof n.default){const e=i.findComponent(o.default);if(null===e||!e.alive)continue;t++}return t}}},5176:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(){this._tickNumber=0,this._startTimestamp=0}get tick(){return this._tickNumber}get timestamp(){return this._startTimestamp+Math.floor(this._tickNumber/i.TICKS_PER_SECOND)}static getTicks(e){return Math.floor(e*i.TICKS_PER_SECOND)}static getSeconds(e){return e/i.TICKS_PER_SECOND}}t.default=i,i.TICKS_PER_SECOND=60,i.TICK_DELTA_TIME=1/i.TICKS_PER_SECOND},1253:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventListT=t.EventList=void 0,t.EventList=class{constructor(){this._events=[]}add(e){this._events.push(e)}remove(e){const t=this._events.indexOf(e);t>=0&&this._events.splice(t,1)}clear(){this._events.length=0}trigger(){for(const e of this._events)e()}},t.EventListT=class{constructor(){this._events=[]}add(e){this._events.push(e)}remove(e){const t=this._events.indexOf(e);t>=0&&this._events.splice(t,1)}clear(){this._events.length=0}trigger(e){for(const t of this._events)t(e)}}},1502:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6285),n=i(7163),o=i(6515),a=i(394);class r{constructor(e){this._downscaleFactor=1,this._tileMap=e,this._downscaleFactor=1,this.updateGrid()}updateGrid(){const e=new s.Vector2(Math.floor(this._tileMap.subSize.x/this._downscaleFactor),Math.floor(this._tileMap.subSize.y/this._downscaleFactor)),t=new Array(e.y);for(let i=0;i<e.y;i++){const s=new Array(e.x);for(let t=0;t<e.x;t++){const e=this._tileMap.getSubTile(t*this._downscaleFactor,i*this._downscaleFactor),o=0!=(e&n.TileState.Terrain),a=0!=(e&n.TileState.Object),r=o&&!a?0:1;s[t]=r}t[i]=s}this._grid=new o(e.x,e.y,o.bytesFrom2DArray(e.x,e.y,t))}findPath(e,t){console.log(`Finding path from ${e} to ${t}`);const i=this._tileMap.resolution,s=Math.floor(e.x*i/this._downscaleFactor),n=Math.floor(e.y*i/this._downscaleFactor),o=Math.floor(t.x*i/this._downscaleFactor),l=Math.floor(t.y*i/this._downscaleFactor),h=a.findPath(s,n,o,l,this._grid,!0,!1,1e3);return h?r.buildPath(h,i,this._downscaleFactor):[]}static buildPath(e,t,i){const n=[];let o=-1,a=-1,r=-1,l=-1;for(let h=0;h<e.length;h++){const c=e[h],d=c>>>16,p=65535&c;if(-1!==o&&-1!==r){const e=Math.sign(o-r),s=Math.sign(a-l),h=Math.sign(d-o),c=Math.sign(p-a);if(e===h&&s===c){o=d,a=p;const e=n[n.length-1];e.x=d/t*i,e.y=p/t*i;continue}}n.push(new s.Vector2(d/t*i,p/t*i)),r=o,l=a,o=d,a=p}return n}}t.default=r},1826:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6285),n=i(6867),o=i(3120),a=i(1076),r=i(671);t.default=class{constructor(e,t){this._audios=new Map,this._currentAudioConfig=null,this._currentAudio=null,this._level=t;const i=r.default.audios;for(const t of i){const i=new s.Sound(t.name,"assets/"+t.audio,e,(()=>{this._audios.set(t,i)}),{loop:!1,autoplay:!1})}}update(){const e=this.getCurrentEnvType(),t=this.pickAudio(e);if(t&&(null===this._currentAudioConfig||!this._currentAudio.isPlaying||t.type!==e||t.location!==this._currentAudioConfig.location)&&(this._currentAudio&&(this._currentAudio.setVolume(0,1),this._currentAudio.stop(1)),this._currentAudioConfig=null,this._currentAudio=null,t)){const e=this._audios.get(t);e&&(this._currentAudioConfig=t,this._currentAudio=e,console.log("Playing audio: "+t.name),e.setVolume(t.volume,1),e.play(0,0))}}destroy(){for(const e of this._audios.values())e.dispose()}getCurrentEnvType(){let e=!1,t=!1;const i=this._level.gameObjectManager.objects;for(const s of i.values())s.type===o.GameObjectType.Monster&&s.alive&&s.getComponent(a.default).isAlerted&&(e=!0,s.config.isBoss&&(t=!0));return t?n.AudioType.BATTLE_BOSS:e?n.AudioType.BATTLE:n.AudioType.AMBIENT}pickAudio(e){let t=null;const i=r.default.audios.filter((t=>0!=t.area.length&&t.type===e));if(0!=i.length){const e=i.filter((e=>{const t=e.area;for(const e of t){const t=this._level.gameObjectManager.getObject(e);if(t&&t.triggered)return!0}return!1}));0!=e.length&&(t=e)}return null===t&&(t=r.default.audios.filter((t=>0===t.area.length&&t.type===e))),0===t.length?null:t[Math.floor(Math.random()*t.length)]}}},936:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(7967),n=i(2710),o=i(4473);t.default=class{constructor(e,t,i){this._currentCinematic=null,this._animationPlaySeconds=0,this._animationRemainingSeconds=0,this._fadeIn=0,this._canvasCurrentFadeIn=1,this._scene=e,this._level=i,this._missionManager=i.missionManager,this._playerCamera=e.getComponent(s.default),this._cinematicCamera=t,this._dialogComponent=e.getComponent(n.default)}update(){if(this._currentCinematic&&this._updatePlayingCinematic(),null===this._currentCinematic){const e=this._missionManager.currentMission;if(e&&!e.isCompleted){const t=e.config;t.cinematic&&""!=t.cinematic&&(this._playCinematic(t.cinematic)||e.complete())}}null===this._currentCinematic&&(this._fadeIn=Math.min(1,this._fadeIn+this._scene.getEngine().getDeltaTime()/1e3)),this._updateFadeInFadeOut()}destroy(){}_playCinematic(e){if(console.log("Playing cinematic: "+e),this._currentCinematic=this._scene.getAnimationGroupByName(e),!this._currentCinematic)return console.error("Cinematic not found: "+e),!1;if("Cinematic_Intro"==e){const e=this._level.gameObjectManager.player;e&&e.getComponent(o.default).hide()}return this._playerCamera.camera.setEnabled(!1),this._cinematicCamera.setEnabled(!0),this._scene.activeCamera=this._cinematicCamera,this._currentCinematic.play(),!0}_updatePlayingCinematic(){var e;if(this._currentCinematic)if(this._currentCinematic.isPlaying){const e=this._currentCinematic.to;let t=4294967295;for(const e of this._currentCinematic.targetedAnimations)for(const i of e.animation.runtimeAnimations){const e=i.currentFrame;e<t&&(t=e)}const i=(e-t)/60;if(i<1&&!this._dialogComponent.isCompleted)return void this._currentCinematic.goToFrame(e-60);this._animationRemainingSeconds=i,this._animationPlaySeconds=e/60,this._fadeIn=Math.min(1,i)}else this._stopCinematic(),null===(e=this._missionManager.currentMission)||void 0===e||e.complete()}_stopCinematic(){if(this._currentCinematic){if("Cinematic_Intro"==this._currentCinematic.name){const e=this._level.gameObjectManager.player;e&&e.getComponent(o.default).show()}this._currentCinematic.stop(),this._currentCinematic=null,this._cinematicCamera.setEnabled(!1),this._playerCamera.camera.setEnabled(!0),this._scene.activeCamera=this._playerCamera.camera,this._fadeIn=0}}_createDebugMenu(){const e=[];for(const t of this._scene.animationGroups)console.log(t.name),t.name.toLowerCase().startsWith("cinematic")&&e.push(t);const t=document.createElement("select");t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.zIndex="100",t.style.color="white",t.style.backgroundColor="black",t.style.border="none",t.style.padding="5px",t.style.fontFamily="monospace";const i=document.createElement("option");i.value="",i.text="None",t.appendChild(i);for(const i of e){const e=document.createElement("option");e.value=i.name,e.text=i.name,t.appendChild(e)}document.body.appendChild(t),t.addEventListener("change",(()=>{const e=t.value;""===e?this._stopCinematic():this._playCinematic(e)}))}_updateFadeInFadeOut(){if(this._fadeIn!=this._canvasCurrentFadeIn){const e=this._scene.getEngine().getRenderingCanvas();if(e){const t=Math.min(1,Math.max(0,this._fadeIn));e.style.opacity=t.toString(),this._canvasCurrentFadeIn=t}}}get playingCinematic(){return null!=this._currentCinematic}}},2710:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(8841);t.default=class{constructor(e,t){this._currentMission=null,this._missionManager=t.missionManager,this._manager=s.Dialogue.getInstance(),this._manager.clear(),this._manager.clearDialogues(),this._manager.isLooping=!1}destroy(){}update(e){this._manager.update(e);const t=this._missionManager.currentMission;if(t!=this._currentMission&&(this._currentMission=t,this._manager.clear(),null!=t))for(const e of t.config.dialogs){const t=0!=e.delay?e.delay:.075*e.text.length+2;this._manager.addText(e.text,t)}}get isCompleted(){return this._manager.isCompleted}}},7967:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6285);t.default=class{constructor(e,t,i,n=10){this._scene=e,this._camera=t,this._camera.mode=s.Camera.PERSPECTIVE_CAMERA,this._camera.position=i,this._camera.parent=null,this._target=null,this._offset=i,this._speed=n}update(e){if(this._tracking)if(this._target){const t=new s.Vector3(this._target.position.x,0,this._target.position.y),i=this._camera.position,n=t.add(this._offset),o=s.Vector3.Lerp(i,n,this._speed*e);this._camera.position=o;const a=t.subtract(o);a.normalize();const r=Math.atan2(a.y,a.z);this._camera.rotation=new s.Vector3(-r,0,0)}else console.warn("No target set for player camera")}get tracking(){return this._tracking}set tracking(e){this._tracking=e,this._camera.position=new s.Vector3(this._target.position.x,0,this._target.position.y).add(this._offset)}get enabled(){return this._camera.isEnabled()}set enabled(e){this._camera.setEnabled(e)}get camera(){return this._camera}set target(e){this._target=e,this.tracking=!0}destroy(){this._camera=null,this._target=null}}},7838:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(5038),n=i(320),o=i(4521),a=i(936);class r{constructor(e){this._attackDirection=null,e.onPointerDown=(e,t)=>{if(t.hit){const e=this._character.position,i=t.pickedPoint,s=Math.atan2(i.x-e.x,i.z-e.y);this._attackDirection=-s+Math.PI/2,console.log(s)}},this._cinematicComponent=e.getComponent(a.default)}destroy(){this._character=null}get character(){return this._character}set character(e){this._character=e}update(){if(!this._character||!this._character.alive)return;const e=this._cinematicComponent.playingCinematic;e&&o.default.clear();const t=this._character.findComponent(n.default);if(t){const e=this.getKeyAxis(r.KEY_RIGHT)-this.getKeyAxis(r.KEY_LEFT),i=this.getKeyAxis(r.KEY_FORWARD)-this.getKeyAxis(r.KEY_BACKWARD),s=t.input;s.axis.x=e,s.axis.y=i,s.dash=s.dash||o.default.isKeyDown("Shift",!0)}if(null!==this._attackDirection&&!e){const e=this._character.findComponent(s.default);e&&e.canAttack&&e.attack(this._attackDirection),this._attackDirection=null}}getKeyAxis(e){return o.default.isKeyDown(e)?1:0}}t.default=r,r.KEY_FORWARD="z",r.KEY_BACKWARD="s",r.KEY_LEFT="q",r.KEY_RIGHT="d"},143:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,o){function a(e){try{l(s.next(e))}catch(e){o(e)}}function r(e){try{l(s.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i(9591);t.default=class{constructor(e,t){this._level=t,this._sceneConfig=e}loadAsync(){return s(this,void 0,void 0,(function*(){console.log("Loading tilemap");const e="assets/scenes/"+this._sceneConfig.name+"/tilemap.bin",t=yield fetch(e),i=yield t.arrayBuffer(),s=new Uint8Array(i),o=s.slice(0,5),a=s.slice(5,s.length-2),r=s.slice(s.length-2);if(65534!=(r[0]|r[1]<<8))throw new Error("Invalid tilemap magic");const l=n.ungzip(a),h=o[0]|o[1]<<8,c=o[2]|o[3]<<8,d=o[4];if(l.length!==h*c)throw new Error("Invalid tilemap size: "+l.length+" vs "+h*c);this._level.tileMap.setSubTiles(l,h,c,d)}))}update(e){}destroy(){}}},601:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6285),n=i(6491),o=i(3120),a=i(8841),r=i(8403);t.default=class{constructor(e,t){this._currentMission=null,this._currentMissionPathTime=0,this._currentPath=null,this._enemyLifeBars=new Map,this._scene=e,this._level=t,this._ui=a.Dialogue.getInstance(),this._ui.show(),this._ui.updatePlayerImage("assets/images/main_character.png")}destroy(){}update(e){const t=this._level.missionManager.currentMission;t&&(this._currentMission!==t&&(this._currentMission=t,this._currentMissionPathTime=0),this._currentMissionPathTime-=e,this._currentMissionPathTime<=0&&(this._updateMissionPath(),this._currentMissionPathTime=1),this._ui.updateQuest(t.config.title,t.config.description.replace("%progress%",t.progress.toString()).replace("%total%",t.requiredProgress.toString())));let i=0;for(const e of this._level.gameObjectManager.objects.values())e.type===o.GameObjectType.Monster&&e.alive&&i++;this._ui.updateMonsterCount(i);const n=this._level.gameObjectManager.player;if(n){const e=n.getComponent(r.default);e&&this._ui.updateHealthBar(e.hitpoint/e.maxHitpoint*100)}const a=this._level.gameObjectManager.objects.values();for(const e of a){const t=e.findComponent(r.default);if(null!==t&&-1!==t.team&&t.team!==n.team){let i=this._enemyLifeBars.get(e.id);i||(i=s.MeshBuilder.CreatePlane("enemyLifeBar",{width:4,height:.5},this._scene),this._enemyLifeBars.set(e.id,i),t.onDeath.add((()=>{null==i||i.dispose(),this._enemyLifeBars.delete(e.id)}))),i.position=new s.Vector3(e.position.x,5,e.position.y),i.scaling=new s.Vector3(t.hitpoint/t.maxHitpoint,1,1),i.billboardMode=s.Mesh.BILLBOARDMODE_ALL;const n=this._scene.activeCamera;n&&(i.lookAt(n.position),i.rotate(new s.Vector3(0,1,0),Math.PI))}}}_updateMissionPath(){if(this._currentPath&&(this._currentPath.dispose(),this._currentPath=null),!this._currentMission)return;const e=this._currentMission,t=new s.Vector2(0,0);switch(e.config.type){case n.MissionType.FOLLOW_NPC:case n.MissionType.TALK_TO_NPC:const i=e.npc;t.set(i.position.x,i.position.y);break;case n.MissionType.KILL_MONSTERS:const s=e.config.monsterIds.filter((e=>this._level.gameObjectManager.getObject(e)));if(s.length>0){const e=this._level.gameObjectManager.getObject(s[0]);t.set(e.position.x,e.position.y)}break;case n.MissionType.KILL_ANY_MONSTER:const a=[];for(const e of this._level.gameObjectManager.objects.values())e.type===o.GameObjectType.Monster&&e.alive&&a.push(e);if(a.length>0){const e=a[0];t.set(e.position.x,e.position.y)}break;case n.MissionType.TRIGGER:const r=e.config.triggerIds.filter((e=>this._level.gameObjectManager.getObject(e)));if(r.length>0){const e=this._level.gameObjectManager.getObject(r[0]);t.set(e.position.x,e.position.y)}break;default:return}const i=this._level.gameObjectManager.player;if(!i||s.Vector2.DistanceSquared(i.position,t)<1)return;const a=this._level.tileMap.pathFinder.findPath(i.position,t);if(!a)return;const r=a.map((e=>new s.Vector3(e.x,1,e.y))),l=s.MeshBuilder.CreateLines("path",{points:r},this._scene);l.color=new s.Color3(1,0,0),l.isPickable=!1,this._currentPath=l}}},4521:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6285);class n{static init(e){e.onKeyboardObservable.add((e=>{e.type===s.KeyboardEventTypes.KEYDOWN?n._keysDown[e.event.key]=!0:n._keysDown[e.event.key]=!1}))}static isKeyDown(e,t=!1){const i=n._keysDown[e]||!1;return i&&t&&(n._keysDown[e]=!1),i}static onKeyDown(e){n._keysDown[e]=!0}static clear(){for(const e in n._keysDown)n._keysDown[e]=!1}}t.default=n,n._keysDown={}},3063:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MeshAsyncHandle=void 0;const s=i(6285);class n{constructor(){this._queue=[],this._nextId=0,this._pendingPromises=[]}load(e){const t=new o(this._nextId++,e);return this._queue.push(t),t}executeQueue(){if(0!==this._queue.length){console.log(`Loading ${this._queue.length} meshes...`);for(const e of this._queue){const t=s.SceneLoader.ImportMeshAsync(null,"assets/"+e.path,null,n.activeScene).then((t=>{e.result=t}));this._pendingPromises.push(t.then((()=>{this._pendingPromises.splice(this._pendingPromises.indexOf(t),1)})))}this._queue=[]}}executeAsync(){return this.executeQueue(),Promise.all(this._pendingPromises).then((()=>{console.log("All meshes loaded")}))}}t.default=n,n.instance=new n;class o{constructor(e,t){this._onLoaded=e=>{},this._onDisposed=()=>{},this._id=e,this._path=t,this._isLoaded=!1,this._isDisposed=!1}get id(){return this._id}get path(){return this._path}get mesh(){return this._result}get isLoaded(){return this._isLoaded}set result(e){if(this._isDisposed)for(const t of e.meshes)t.dispose();else this._result=e,this._isLoaded=!0,this._onLoaded(this._result)}get onLoaded(){return this._onLoaded}set onLoaded(e){this._onLoaded=e,this._isLoaded&&this._onLoaded(this._result)}get onDisposed(){return this._onDisposed}set onDisposed(e){this._onDisposed=e,this._isDisposed&&this._onDisposed()}dispose(){if(this._isDisposed=!0,this._result){for(const e of this._result.meshes)e.dispose();this._onDisposed(),this._result=null}}}t.MeshAsyncHandle=o},3184:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,o){function a(e){try{l(s.next(e))}catch(e){o(e)}}function r(e){try{l(s.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i(5897),o=i(4521),a=i(3063);class r extends n.Scene{constructor(e){super(e),this._sceneComponents=[]}init(){return s(this,void 0,void 0,(function*(){yield this.whenReadyAsync(),window.addEventListener("resize",(()=>{this.getEngine().resize()})),a.default.activeScene=this}))}update(){this.render();const e=this.getEngine().getDeltaTime()/1e3;this._sceneComponents.forEach((t=>t.update(e))),o.default.init(this),a.default.instance.executeQueue()}destroy(){this._sceneComponents.forEach((e=>e.destroy())),this._sceneComponents=[]}addComponent(e){this._sceneComponents.push(e)}getComponent(e){return this._sceneComponents.find((t=>t instanceof e))}}t.default=r},6649:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,o){function a(e){try{l(s.next(e))}catch(e){o(e)}}function r(e){try{l(s.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i(6285),o=i(3184),a=i(7907),r=i(6752),l=i(3856),h=i(8841),c=i(671),d=i(817),p=i(9985);class u extends o.default{constructor(e){super(e),this._inputF=!1,this.onDispose=()=>{}}init(){const e=Object.create(null,{init:{get:()=>super.init}});return s(this,void 0,void 0,(function*(){yield e.init.call(this),yield Ammo();let t=new n.AmmoJSPlugin(void 0,Ammo);this.enablePhysics(new n.Vector3(0,-9.81,0),t),this._createLight(),this._createSkybox(),this._createPlanets(),this._createDialogue(),this._createHint(),yield this._createSpaceship(),yield this._createSpaceStation(),yield this._ship.enterSpaceship(),yield this._ship.exitSpaceship(),yield this._station.enterStation(),this._addPostProcessing([this._ship.getCamera(),this._station.getCamera()]),this.onKeyboardObservable.add((e=>{e.type==n.KeyboardEventTypes.KEYDOWN&&("Enter"==e.event.key&&(this._station.exitStation(),this._ship.enterSpaceship()),"Escape"==e.event.key&&(this._ship.exitSpaceship(),this._station.enterStation()),"f"==e.event.key?this._inputF=!0:this._inputF=!1)})),h.Dialogue.getInstance().showOnlyDialogues()}))}_createHint(){let e=n.MeshBuilder.CreateSphere("sphere",{diameter:2},this);e.position=new n.Vector3(17,7,54);let t=new n.StandardMaterial("material",this);t.alpha=.5,t.diffuseColor=new n.Color3(0,1,0),e.material=t,e.isPickable=!1,e.renderOutline=!0,e.outlineWidth=5,e.outlineColor=new n.Color3(0,255,0),e.renderingGroupId=1,this._triggerCube=n.MeshBuilder.CreateBox("trigger",{size:10},this),this._triggerCube.position=new n.Vector3(17,7,54),this._triggerCube.isVisible=!1}_createLight(){this._sun=new n.HemisphericLight("light1",new n.Vector3(1,1,0),this)}_createSkybox(){let e=n.MeshBuilder.CreateBox("skyBox",{size:1e4},this),t=new n.StandardMaterial("skyBox",this);t.backFaceCulling=!1,t.reflectionTexture=new n.CubeTexture("assets/space/img/skybox/skybox",this),t.reflectionTexture.coordinatesMode=n.Texture.SKYBOX_MODE,t.diffuseColor=new n.Color3(0,0,0),t.specularColor=new n.Color3(0,0,0),e.material=t,e.infiniteDistance=!0}_createPlanets(){this._planets=new a.PlanetManager(this),this._planets.createMeshes()}_createSpaceship(){return s(this,void 0,void 0,(function*(){this._ship=new r.Spaceship("assets/space/obj/","Luminaris Starship.glb",this),yield this._ship.spawnAsync(this._planets),this._ship.subCollision((e=>this.onSpaceShipCollision(e)))}))}_addPostProcessing(e){var t=new n.DefaultRenderingPipeline("default",!0,this,e);t.bloomEnabled=!0,t.bloomThreshold=.05,t.bloomWeight=.35,t.bloomScale=1,t.bloomKernel=32,t.imageProcessingEnabled=!0,t.imageProcessing.contrast=1.25,t.imageProcessing.exposure=1.2,t.imageProcessing.toneMappingEnabled=!1,t.imageProcessing.vignetteEnabled=!0,t.imageProcessing.vignetteWeight=2.5,t.imageProcessing.vignetteStretch=.5}_createSpaceStation(){return s(this,void 0,void 0,(function*(){this._station=new d.SpaceStation(this),yield this._station.init()}))}_createDialogue(){this._dialogue=h.Dialogue.getInstance(),this._dialogue.showOnlyDialogues(),this._dialogue.isLooping=!0,this._dialogue.addText("(Je dois me diriger vers mon vaisseau)",4500),this._dialogue.addText("(Il me semble qu'il est au fond de l'aile droite de la station)",5e3)}update(){this._planets.update(this.getEngine().getDeltaTime()),this._dialogue.update(this.getEngine().getDeltaTime()),this._station.getPlayerMesh().intersectsMesh(this._triggerCube,!1)?(h.Dialogue.getInstance().updateHint("Appuyez sur F pour entrer dans le vaisseau"),this._inputF&&(this._station.exitStation(),this._ship.enterSpaceship(),h.Dialogue.getInstance().hideHint(),this._dialogue.clear(),this._dialogue.addText("Bienvenue dans Nakama ! Nous sommes heureux de vous accueillir dans ce jeu spatial épique (1/5)",1e4),this._dialogue.addText("Avant de commencer, voici les commandes de votre vaisseau spatial : Z pour monter, S pour descendre, Q pour tourner à gauche et D pour tourner à droite (2/5)",1e4),this._dialogue.addText("Espace pour accélérer, et Shift pour ralentir. Assurez-vous de les maîtriser avant de partir à l'aventure. (3/5)",1e4),this._dialogue.addText("Votre mission est de naviguer dans l'espace et de choisir la planète que vous voulez (La plus proche, sinon c loin). Utilisez la touche E pour orienter votre vaisseau vers elle. Une fois que vous l'avez trouvée, atterrissez sur sa surface pour explorer ses merveilles. (4/5)",1e4),this._dialogue.addText("Pour changer de planete, utilisez la touche fleche du haut pour aller vers la planete suivante, et la touche fleche du bas pour aller vers la planete precedente. (5/5)",1e4))):h.Dialogue.getInstance().hideHint(),p.update(),super.update()}onSpaceShipCollision(e){this.isDisposed||this._switchToWorldScene()}_switchToWorldScene(){const e=this.getEngine();console.log("switching to world scene using engine",e),new l.default(e,c.default.getScene(1)).init().then((()=>{this.dispose()}))}}t.default=u},3856:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,o){function a(e){try{l(s.next(e))}catch(e){o(e)}}function r(e){try{l(s.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i(6285),o=i(4026),a=i(5176),r=i(7967),l=i(7838),h=i(3184),c=i(6649),d=i(143),p=i(936),u=i(2490),_=i(2710),m=i(3063),g=i(601),f=i(1826);class y extends h.default{constructor(e,t){super(e),this._logicTime=0,this._initialized=!1,this._level=new o.default(t.id,new n.Vector2(Math.floor(t.width/t.precision),Math.floor(t.height/t.precision)),t.precision),this._config=t,this.onDispose=()=>{this._level.destroy()};const i=n.SceneOptimizerOptions.ModerateDegradationAllowed(60);this._optimizer=new n.SceneOptimizer(this,i,!0,!0)}get level(){return this._level}init(){const e=Object.create(null,{init:{get:()=>super.init}});return s(this,void 0,void 0,(function*(){yield e.init.call(this),yield this.createTerrain(),this.blockMaterialDirtyMechanism=!0;const t=this.cameras[0],i=new u.TargetCamera("PlayerCamera",n.Vector3.Up(),this,!0);this.activeCamera=i,this.addComponent(new r.default(this,this.activeCamera,y.CAMERA_OFFSET,y.CAMERA_SPEED)),this.addComponent(new _.default(this,this._level)),this.addComponent(new g.default(this,this._level)),this.addComponent(new p.default(this,t,this._level)),this.addComponent(new l.default(this)),this.addComponent(new f.default(this,this._level)),this.loadLevel(),this._sun=this.lights[0],this._sun.autoCalcShadowZBounds=!0,this._shadowGenerator=new n.ShadowGenerator(4096,this._sun,null,this.activeCamera),this._shadowGenerator.useCloseExponentialShadowMap=!0,this._shadowGenerator.bias=1e-4,this._shadowGenerator.setDarkness(.1);for(const e of this.meshes)e.receiveShadows&&(this._shadowGenerator.addShadowCaster(e),console.log("added shadow caster",e.name));const s=this.transformNodes.find((e=>"Cinematic"===e.name));if(!s)throw new Error("cinematic node not found");for(const e of s.getChildTransformNodes())e.unfreezeWorldMatrix();const o=new n.DefaultRenderingPipeline("default",!0,this,[this.activeCamera,t]);o.bloomEnabled=!0,o.bloomThreshold=.05,o.bloomWeight=.35,o.bloomScale=1,o.bloomKernel=32,o.imageProcessingEnabled=!0,o.imageProcessing.contrast=1.1,o.imageProcessing.exposure=1.15,o.imageProcessing.toneMappingEnabled=!1,o.imageProcessing.vignetteEnabled=!0,o.imageProcessing.vignetteWeight=2.5,o.imageProcessing.vignetteStretch=.5,this._initialized=!0,this._optimizer.start(),yield m.default.instance.executeAsync(),console.log("scene initialized")}))}loadLevel(){const e=[];for(const t of this._config.objects)console.log("loading object",t.name),e.push(Object.assign({id:t.id,position:new n.Vector3(t.position.x,t.position.y,0),direction:Math.PI/2-t.direction,type:t.type},t.params));this._level.load({objects:e,points:this._config.points});const t=this._level.gameObjectManager.player,i=this.getComponent(r.default);null!==i&&(i.target=t);const s=this.getComponent(l.default);null!==s&&(s.character=t)}createTerrain(){return s(this,void 0,void 0,(function*(){const e="assets/scenes/"+this._config.name+"/models/",t=[];for(const i of this._config.models){const s=new n.Vector3(i.position.x,i.position.y,i.position.z);s.x*=-1,s.z*=-1;const o=new n.Vector3(i.rotation.x*Math.PI/180,i.rotation.y*Math.PI/180,i.rotation.z*Math.PI/180),a=new n.Vector3(i.scale.x,i.scale.y,i.scale.z);a.x*=-1,t.push(this.loadModelAsync(e+i.path,s,o,a))}if(yield Promise.all(t),!this._config.useBakedTilemap)throw new Error("Non baked tilemap is not supported now");{const e=new d.default(this._config,this._level);this.addComponent(e),yield e.loadAsync()}}))}loadModelAsync(e,t,i,o){return s(this,void 0,void 0,(function*(){console.log("Loading model",e);const s=yield n.SceneLoader.ImportMeshAsync("",e,null,this),a=s.meshes[0];a.position=t,a.rotation=i,a.scaling=o;for(const e of s.meshes)this._optimizeMesh(e);const r=["_rock_","_rocks_","_grass_"];for(const e of s.meshes){let t=!1;const i=e.name.toLowerCase();for(const e of r)if(-1!==i.indexOf(e)){t=!0;break}t||(e.receiveShadows=!0,e.material instanceof n.PBRMaterial&&(e.material.roughness=.25))}}))}_optimizeMesh(e){e.computeWorldMatrix(!0),e.freezeWorldMatrix(),e.checkCollisions=!1,e.material&&e.material.freeze(),e.cullingStrategy=n.AbstractMesh.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY}updateLogic(){if(!this._initialized)return;const e=this.getEngine().getDeltaTime()/1e3;for(this._logicTime=Math.min(this._logicTime+e,1e4);this._logicTime>a.default.TICK_DELTA_TIME;)this._level.update(),this._logicTime-=a.default.TICK_DELTA_TIME;null===this._level.gameObjectManager.player&&this.loadLevel()}update(){this.updateLogic(),super.update()}switchToSpace(){const e=this.getEngine();new c.default(e).init().then((()=>{this.dispose()}))}_reloadCurrentScene(){const e=this.getEngine();new y(e,this._config).init().then((()=>{this.dispose()}))}}t.default=y,y.CAMERA_SPEED=15,y.CAMERA_OFFSET=new n.Vector3(0,37.5,-30)},722:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DoorAxis=void 0;const s=i(9985);var n;t.default=class{constructor(e,t,i){this.doors=[],this.initialPositions=[],this.isOpening=!1,this.isClosing=!1,this.doorsTween=[],this._maxTravelDistance=t,this._transformNode=e,this.axis=i,this.doors.push(this._transformNode.getChildren()[0]),this.initialPositions.push(this.doors[0].position.clone()),this.axis!==n.Y&&(this.doors.push(this._transformNode.getChildren()[1]),this.initialPositions.push(this.doors[1].position.clone())),this.trigger=this.doors[0].absolutePosition.clone()}stopAllTweens(){this.doorsTween.forEach((e=>{e.stop()})),this.doorsTween=[]}open(){this.isOpening||(this.stopAllTweens(),this.isOpening=!0,this.isClosing=!1,this.axis===n.Z?this.openZ():this.axis===n.Y?this.openY():this.axis===n.X&&this.openX())}openZ(){const e=this.initialPositions[0].z+this._maxTravelDistance,t=this.initialPositions[1].z-this._maxTravelDistance,i=new s.Tween(this.doors[0].position).to({z:e},1e3).easing(s.Easing.Quadratic.Out).onComplete((()=>{this.isOpening=!1})),n=new s.Tween(this.doors[1].position).to({z:t},1e3).easing(s.Easing.Quadratic.Out);this.doorsTween.push(i),this.doorsTween.push(n),i.start(),n.start()}openY(){const e=this.initialPositions[0].y+this._maxTravelDistance,t=new s.Tween(this.doors[0].position).to({y:e},1e3).easing(s.Easing.Quadratic.Out).onComplete((()=>{this.isOpening=!1}));this.doorsTween.push(t),t.start()}openX(){const e=this.initialPositions[0].x+this._maxTravelDistance,t=this.initialPositions[1].x-this._maxTravelDistance,i=new s.Tween(this.doors[0].position).to({x:e},1e3).easing(s.Easing.Quadratic.Out).onComplete((()=>{this.isOpening=!1})),n=new s.Tween(this.doors[1].position).to({x:t},1e3).easing(s.Easing.Quadratic.Out);this.doorsTween.push(i),this.doorsTween.push(n),i.start(),n.start()}close(){this.isClosing||(this.stopAllTweens(),this.isOpening=!1,this.isClosing=!0,this.axis===n.Z?this.closeZ():this.axis===n.Y?this.closeY():this.axis===n.X&&this.closeX())}closeZ(){const e=this.initialPositions[0].z,t=this.initialPositions[1].z,i=new s.Tween(this.doors[0].position).to({z:e},500).easing(s.Easing.Quadratic.In).onComplete((()=>{this.isClosing=!1})),n=new s.Tween(this.doors[1].position).to({z:t},500).easing(s.Easing.Quadratic.In);i.start(),n.start()}closeY(){const e=this.initialPositions[0].y,t=new s.Tween(this.doors[0].position).to({y:e},500).easing(s.Easing.Quadratic.In).onComplete((()=>{this.isClosing=!1}));this.doorsTween.push(t),t.start()}closeX(){const e=this.initialPositions[0].x,t=this.initialPositions[1].x,i=new s.Tween(this.doors[0].position).to({x:e},500).easing(s.Easing.Quadratic.In).onComplete((()=>{this.isClosing=!1})),n=new s.Tween(this.doors[1].position).to({x:t},500).easing(s.Easing.Quadratic.In);this.doorsTween.push(i),this.doorsTween.push(n),i.start(),n.start()}toggleDoors(){this.isOpening?(console.log("close"),this.close()):(console.log("open"),this.open())}getDoorPosition(){return this.trigger}},function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(n=t.DoorAxis||(t.DoorAxis={}))},8977:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Planet=void 0;const s=i(6285),n=i(5432);t.Planet=class{constructor(e,t,i,s,n,o){this._name=e,this._orbitRadius=t,this._orbitSpeed=i,this._rotationSpeed=s,this._diameter=n,this._texture=o}createMeshes(e){const t=s.MeshBuilder.CreateTorus(`${this._name}-orbit`,{diameter:2*this._orbitRadius,thickness:.01},e);this._orbitMesh=t,this._orbitMesh.visibility=.1;const i=s.MeshBuilder.CreateSphere(`${this._name}-planet`,{diameter:this._diameter},e);i.material=n.ToonMaterial.createMaterial(this._texture),i.material.freeze(),this._planetMesh=i}update(e){this._orbitMesh&&this._planetMesh&&(this._planetMesh.rotation.y+=e*this._rotationSpeed,this._planetMesh.position.x=this._orbitRadius*Math.cos(Date.now()/1e3*this._orbitSpeed),this._planetMesh.position.z=this._orbitRadius*Math.sin(Date.now()/1e3*this._orbitSpeed))}getMesh(){return this._planetMesh}getRadius(){return this._diameter/2}dispose(){this._orbitMesh&&this._orbitMesh.dispose(),this._planetMesh&&this._planetMesh.dispose()}getName(){return this._name}getAtmosphereRadius(){return this._diameter/2+.1*this._diameter}}},7907:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlanetManager=void 0;const s=i(6285),n=i(8977);t.PlanetManager=class{constructor(e){this._scale=1/300,this._scene=e,this._planets=[];let t=new n.Planet("mercury",500,4e-4,1e-5,4879*this._scale,new s.Texture("assets/space/img/planets/2k_mercury.jpg",e)),i=new n.Planet("venus",875,.0035,1e-5,12104*this._scale,new s.Texture("assets/space/img/planets/2k_venus_surface.jpg",e)),o=new n.Planet("earth",1250,.003,1e-5,12742*this._scale,new s.Texture("assets/space/img/planets/2k_earth_daymap.jpg",e)),a=new n.Planet("mars",1875,.0024,1e-5,6779*this._scale,new s.Texture("assets/space/img/planets/2k_mars.jpg",e)),r=new n.Planet("jupiter",2500,.0013,1e-5,139820*this._scale,new s.Texture("assets/space/img/planets/2k_jupiter.jpg",e)),l=new n.Planet("saturn",3125,.009,1e-5,116460*this._scale,new s.Texture("assets/space/img/planets/2k_saturn.jpg",e)),h=new n.Planet("uranus",3750,7e-4,1e-5,50724*this._scale,new s.Texture("assets/space/img/planets/2k_uranus.jpg",e));this._planets.push(t,i,o,a,r,l,h)}createMeshes(){this._planets.forEach((e=>{e.createMeshes(this._scene)}))}getPlanets(){return this._planets}getPlanet(e,t){let i=e%this._planets.length;i<0&&(i=this._planets.length+i);let s=this._planets[i];return{planet:s,distance:this.getDistance(s,t)}}update(e){this._planets.forEach((t=>{t.update(e)}))}getDistanceClosestPlanet(e){let t=Number.MAX_VALUE,i=null;return this._planets.forEach((n=>{let o=s.Vector3.Distance(e.position,n.getMesh().position)-n.getRadius();o<t&&(t=o,i=n)})),{planet:i,distance:t}}getDistance(e,t){return s.Vector3.Distance(t.position,e.getMesh().position)-e.getRadius()}disposeAll(){this._planets.forEach((e=>{e.dispose()}))}}},7577:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FirstPersonPlayer=void 0;const s=i(6285);t.FirstPersonPlayer=class{constructor(e,t){this._moveSpeedPerSec=.4,this._moveRunPerSec=.65,this._moveForward=!1,this._moveLeft=!1,this._moveRight=!1,this._moveBackward=!1,this._shift=!1,this._playerRotation=0,this._playerEnabled=!1,this.scene=e,this._startPosition=t,this.setupCamera(),this.setupPlayer(),this.scene.onBeforeRenderObservable.add((()=>{this._update()}))}setupCamera(){this._camera=new s.UniversalCamera("playerCamera",new s.Vector3(0,0,0),this.scene),this._camera.attachControl(),this._camera.inputs.removeByType("FreeCameraKeyboardMoveInput"),this._camera.parent=this.playerMesh,this._camera.position=new s.Vector3(0,1.3,0),this._camera.rotationQuaternion=s.Quaternion.Identity(),this._camera.rotationQuaternion=s.Quaternion.FromEulerAngles(0,1.74,0)}setupPlayer(){this.playerMesh=s.MeshBuilder.CreateCapsule("player",{radius:.5,height:2},this.scene),this.playerMesh.position=this._startPosition,this.playerMesh.physicsImpostor=new s.PhysicsImpostor(this.playerMesh,s.PhysicsImpostor.CapsuleImpostor,{mass:1,restitution:0,friction:1},this.scene),this.playerMesh.checkCollisions=!0,this.playerMesh.ellipsoid=new s.Vector3(.1,1,.1),this.playerMesh.ellipsoidOffset=new s.Vector3(0,1,0),this.playerMesh.isVisible=!1}setupControls(){this.inputObservable=this.scene.onKeyboardObservable.add((e=>{e.type===s.KeyboardEventTypes.KEYDOWN&&("z"===e.event.key&&(this._moveForward=!0),"s"===e.event.key&&(this._moveBackward=!0),"q"===e.event.key&&(this._moveLeft=!0),"d"===e.event.key&&(this._moveRight=!0),"Shift"===e.event.key&&(this._shift=!0)),e.type===s.KeyboardEventTypes.KEYUP&&("z"===e.event.key&&(this._moveForward=!1),"s"===e.event.key&&(this._moveBackward=!1),"q"===e.event.key&&(this._moveLeft=!1),"d"===e.event.key&&(this._moveRight=!1),"Shift"===e.event.key&&(this._shift=!1))}))}_update(){if(!this._playerEnabled)return;let e=0;this._moveForward&&(e+=this._moveSpeedPerSec),this._moveBackward&&(e-=this._moveSpeedPerSec);let t=0;this._moveLeft&&(t-=this._moveSpeedPerSec),this._moveRight&&(t+=this._moveSpeedPerSec);let i=this._moveSpeedPerSec;this._shift&&(i=this._moveRunPerSec);let n=new s.Vector3(t,0,e),o=s.Vector3.TransformNormal(n,this._camera.getWorldMatrix());o.y=0,this.playerMesh.physicsImpostor.setLinearVelocity(new s.Vector3(0,-1,0)),this.playerMesh.moveWithCollisions(o.scale(i)),this.playerMesh.rotationQuaternion=s.Quaternion.FromEulerAngles(0,this._playerRotation,0)}dispawn(){this.scene.onKeyboardObservable.remove(this.inputObservable),this.playerMesh.position=this._startPosition,this._playerEnabled=!1}spawn(){this.setupPlayer(),this.setupControls(),this._camera.parent=this.playerMesh,this.scene.activeCamera=this._camera,this._playerEnabled=!0}get position(){return this.playerMesh.position}getCamera(){return this._camera}getPlayerMesh(){return this.playerMesh}}},817:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,o){function a(e){try{l(s.next(e))}catch(e){o(e)}}function r(e){try{l(s.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.SpaceStation=void 0;const n=i(6285),o=i(7577),a=i(722);t.SpaceStation=class{constructor(e){this._doors=[],this._distanceToOpenDoor=12,this._spaceStationEnabled=!1,this._scene=e}init(){return s(this,void 0,void 0,(function*(){yield this._setupCollider(),yield this._setupSpaceStation(),yield this._setupPlayer(),yield this._setupDoor(),this._scene.registerBeforeRender((()=>{this._update()}))}))}_setupCollider(){return s(this,void 0,void 0,(function*(){var e=yield n.SceneLoader.ImportMeshAsync("","assets/space/obj/","collider.glb",this._scene);this._collider=e.meshes[0],this._collider.position=new n.Vector3(0,0,0),e.meshes.forEach((e=>{e.physicsImpostor=new n.PhysicsImpostor(e,n.PhysicsImpostor.MeshImpostor,{mass:0,restitution:0},this._scene),e.checkCollisions=!0,e.isVisible=!1,e.freezeWorldMatrix()})),this._collider.freezeWorldMatrix()}))}_setupSpaceStation(){return s(this,void 0,void 0,(function*(){var e=yield n.SceneLoader.ImportMeshAsync("","assets/space/obj/","SpaceBase.glb",this._scene);this._spaceStation=e.meshes[0],this._spaceStation.getChildMeshes().forEach((e=>{e.name.includes("SpaceBase (1)")&&(e.freezeWorldMatrix(),e.material.freeze())}))}))}_setupPlayer(){return s(this,void 0,void 0,(function*(){this._player=new o.FirstPersonPlayer(this._scene,new n.Vector3(-124.8,.55,179.6))}))}_setupDoor(){return s(this,void 0,void 0,(function*(){let e=new a.default(this._getNodeById("HorizontalRectangleDoor",this._spaceStation),.5,a.DoorAxis.Z),t=new a.default(this._getNodeById("MainDoor",this._spaceStation),15,a.DoorAxis.Y),i=new a.default(this._getNodeById("RoundDoor",this._spaceStation),2.2,a.DoorAxis.X),s=new a.default(this._getNodeById("RoundDoor.001",this._spaceStation),-2.2,a.DoorAxis.X),n=new a.default(this._getNodeById("RoundDoor.002",this._spaceStation),2.2,a.DoorAxis.X),o=new a.default(this._getNodeById("RoundDoor.003",this._spaceStation),2.2,a.DoorAxis.X),r=new a.default(this._getNodeById("RoundDoor.004",this._spaceStation),2.2,a.DoorAxis.X),l=new a.default(this._getNodeById("RoundDoor.005",this._spaceStation),2.2,a.DoorAxis.X),h=new a.default(this._getNodeById("RoundDoor.006",this._spaceStation),2.2,a.DoorAxis.X),c=new a.default(this._getNodeById("VerticalRectangleDoor",this._spaceStation),7.67,a.DoorAxis.Z);this._doors.push(e,t,i,s,n,o,r,l,h,c)}))}enterStation(){this._spaceStationEnabled=!0,this._player.spawn()}exitStation(){this._spaceStationEnabled=!1,this._player.dispawn()}_getNodeById(e,t){if(t.id===e)return t;for(let i=0;i<t.getChildren().length;i++){let s=t.getChildren()[i];if(s.id===e)return s;if(s.getChildren().length>0){let t=this._getNodeById(e,s);if(t)return t}}return null}_update(){this._spaceStationEnabled&&this._updateDoor()}_updateDoor(){let e=this._getNearestDoor();this._doors.forEach((t=>{t===e?t.open():t.close()}))}getCamera(){return this._player.getCamera()}_getNearestDoor(){let e=null,t=Number.MAX_VALUE;return this._doors.forEach((i=>{let s=n.Vector3.Distance(i.getDoorPosition(),this._player.position);s<t&&(t=s,e=i)})),t>this._distanceToOpenDoor?null:e}getPlayerMesh(){return this._player.getPlayerMesh()}}},6752:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,o){function a(e){try{l(s.next(e))}catch(e){o(e)}}function r(e){try{l(s.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Spaceship=void 0;const n=i(6285),o=i(6376),a=i(7556),r=i(6527),l=i(1513),h=i(7650);t.Spaceship=class{constructor(e,t,i){this._speedCooldown=0,this._speedRefresh=.1,this._scaleFactor=.1,this._scaleSpeed=40,this._spaceshipEnabled=!1,this._spaceshipCollisionObservable=new n.Observable,this._firstView=!0,this._uiUpdateTime=0,this._rootUrl=e,this._sceneFilename=t,this._scene=i,this._setupCamera(),this._maxSpeed=5*this._scaleFactor,this._acceleration=35*this._scaleFactor/this._scaleSpeed,this._deceleration=1*this._scaleFactor/this._scaleSpeed,this._maxRotationSpeed=.05,this._rotationAcceleration=.025,this._rotationDeceleration=.004,this._selectedPlanetIndex=0,this._setupShake(),this._scene.onBeforeRenderObservable.add((()=>{this._update()}))}spawnAsync(e){return s(this,void 0,void 0,(function*(){this._planetManager=e;let t=yield n.SceneLoader.ImportMeshAsync("",this._rootUrl,this._sceneFilename,this._scene);this._spaceship=t.meshes[0],this._spaceship1=t.meshes[1]}))}_setupDashboard(){null==this._dashboard&&(this._dashboard=new h.Dashboard(this._scene,this._spaceship))}_setupEffect(){null==this._trailsEntry&&(this._trailsEntry=new r.TrailsManager(50,this._scene,this._spaceship,.1,4,!0,a.ColorFactory.yellow()),this._trailsEntry.start(),this._trailsEntry.changeEmitRate(0),this._trailsSpeed=new r.TrailsManager(10,this._scene,this._spaceship,.5,4,!0,a.ColorFactory.purple()),this._trailsSpeed.start(),this._cloudEffect=new l.CloudEffect(this._scene,this._spaceship),this._cloudEffect.start())}_setupShake(){this._projectionMatrix=this._camera.getProjectionMatrix(),this._r=this._projectionMatrix.getRow(3),this._t=0}_setupSpaceship(){null==this._parentMesh&&(this._spaceship.isVisible=!0,this._parentMesh=n.MeshBuilder.CreateBox("parentMesh",{size:1},this._scene),this._parentMesh.position=new n.Vector3(150,150,150),this._parentMesh.rotationQuaternion=n.Quaternion.Identity(),this._parentMesh.rotationQuaternion=n.Quaternion.FromEulerAngles(.8901179,-2.094395,.1745329),this._parentMesh.isVisible=!1,this._spaceship.parent=this._parentMesh,this._spaceship.rotationQuaternion=n.Quaternion.Identity(),this._spaceship.position=new n.Vector3(0,0,0),this._spaceship1.position=new n.Vector3(0,0,0),this._parentMesh.physicsImpostor=new n.PhysicsImpostor(this._spaceship,n.PhysicsImpostor.BoxImpostor,{mass:0,restitution:.9,friction:0},this._scene),this._spaceship.scaling=new n.Vector3(this._scaleFactor,this._scaleFactor,this._scaleFactor))}_setupCamera(){this._camera=new n.UniversalCamera("camera",new n.Vector3(0,1.2,-1.5),this._scene),this._camera.detachControl(),this._camera.fov=1.4,this._camera.maxZ=1e5}_setupKeyboardInput(){this._keyboardObserver=this._scene.onKeyboardObservable.add((e=>{switch(e.type){case 1:switch(e.event.key){case"q":this._isGoingLeft=!0;break;case"d":this._isGoingRight=!0;break;case"z":this._isGoingUp=!0;break;case"s":this._isGoingDown=!0;break;case" ":this._isGoingForward=!0;break;case"Shift":this._isGoingBackward=!0;break;case"e":this._reorientToPlanet();break;case"r":this._toggleCameraView();break;case"ArrowUp":this._selectedPlanetIndex++;break;case"ArrowDown":this._selectedPlanetIndex--}break;case 2:switch(e.event.key){case"q":this._isGoingLeft=!1;break;case"d":this._isGoingRight=!1;break;case"z":this._isGoingUp=!1;break;case"s":this._isGoingDown=!1;break;case" ":this._isGoingForward=!1;break;case"Shift":this._isGoingBackward=!1}}}))}_toggleCameraView(){this._firstView=!this._firstView,this._firstView?this._cameraFirstView():this._cameraSecondView()}_cameraFirstView(){this._camera.position=new n.Vector3(0,1.2,-1.5),this._camera.rotation=new n.Vector3(0,0,0),this._camera.fov=1.4}_cameraSecondView(){this._camera.position=new n.Vector3(0,2,-5),this._camera.rotation=new n.Vector3(0,0,0),this._camera.fov=1.4}_update(){if(!this._spaceshipEnabled)return;if(this._uiUpdateTime>0?this._uiUpdateTime-=this._scene.getEngine().getDeltaTime():(this._uiUpdateTime=250,this._updateDashboard()),this._shakeCamera(),this._lockMovement)return;var e=this._scene.getEngine().getDeltaTime()/1e3;let t=!1;this._isGoingBackward&&(this._speed+=this._acceleration*e,this._speed>=0?this._speed=0:this._speed>this._maxSpeed&&(this._speed=this._maxSpeed)),this._isGoingForward&&(this._speed-=this._acceleration*e,this._speed<-this._maxSpeed&&(this._speed=-this._maxSpeed)),this._isGoingRight&&(t=!0,this._rotationSpeedHori+=this._rotationAcceleration*e,this._rotationSpeedHori>this._maxRotationSpeed&&(this._rotationSpeedHori=this._maxRotationSpeed)),this._isGoingLeft&&(t=!0,this._rotationSpeedHori-=this._rotationAcceleration*e,this._rotationSpeedHori<-this._maxRotationSpeed&&(this._rotationSpeedHori=-this._maxRotationSpeed)),this._isGoingUp&&(t=!0,this._rotationSpeedVer+=this._rotationAcceleration*e,this._rotationSpeedVer>this._maxRotationSpeed&&(this._rotationSpeedVer=this._maxRotationSpeed)),this._isGoingDown&&(t=!0,this._rotationSpeedVer-=this._rotationAcceleration*e,this._rotationSpeedVer<-this._maxRotationSpeed&&(this._rotationSpeedVer=-this._maxRotationSpeed)),t||(this._rotationSpeedHori>0&&(this._rotationSpeedHori-=this._rotationDeceleration*e,this._rotationSpeedHori<0&&(this._rotationSpeedHori=0)),this._rotationSpeedHori<0&&(this._rotationSpeedHori+=this._rotationDeceleration*e,this._rotationSpeedHori>0&&(this._rotationSpeedHori=0)),this._rotationSpeedVer>0&&(this._rotationSpeedVer-=this._rotationDeceleration*e,this._rotationSpeedVer<0&&(this._rotationSpeedVer=0)),this._rotationSpeedVer<0&&(this._rotationSpeedVer+=this._rotationDeceleration*e,this._rotationSpeedVer>0&&(this._rotationSpeedVer=0)),this._speed>0?(this._speed-=this._deceleration*e,this._speed<0&&(this._speed=0)):this._speed<0&&(this._speed+=this._deceleration*e,this._speed>0&&(this._speed=0))),this._turnHorizontal(this._rotationSpeedHori),this._turnVertical(this._rotationSpeedVer),this._velocity=this._parentMesh.forward.scale(-this._speed),this._parentMesh.moveWithCollisions(this._velocity),this._computeSpeedKm(),this._planetData=this._planetManager.getPlanet(this._selectedPlanetIndex,this._parentMesh),this._updateEffects(),this._planetData.distance<=this._planetData.planet.getAtmosphereRadius()&&this._fakeStop()}_updateEffects(){this._trailsSpeed.changeEmitRate(o.Utils.clamp(0,this._maxSpeed,-this._speed)),this._planetData.planet.getAtmosphereRadius();let e=5*this._planetData.planet.getRadius();this._cloudEffect.changeEmitRate(1-o.Utils.clamp(4*this._planetData.planet.getRadius(),e,this._planetData.distance)),this._trailsEntry.changeEmitRate(1-o.Utils.clamp(4*this._planetData.planet.getRadius(),e,this._planetData.distance))}_fakeStop(){this._spaceshipEnabled&&(this._planetManager.disposeAll(),this._lockSpeed=this._speed,this._lockMove(),console.log("fake stop on planet "+this._planetData.planet.getName()),this._spaceshipCollisionObservable.notifyObservers(this._planetData.planet))}_lockMove(){this._lockMovement=!0}_unlockMove(){this._lockMovement=!1}_computeSpeedKm(){this._lockMovement||(this._speedCooldown-=this._scene.getEngine().getDeltaTime(),this._speedCooldown<=0&&(this._speedKm=3.6*-this._speed/this._speedRefresh*1/this._scaleFactor*this._scaleSpeed,this._speedCooldown=this._speedRefresh))}_turnHorizontal(e){const t=n.Quaternion.RotationAxis(n.Axis.Y,e);this._parentMesh.rotationQuaternion.multiplyInPlace(t)}_turnVertical(e){const t=n.Quaternion.RotationAxis(n.Axis.X,-e);this._parentMesh.rotationQuaternion.multiplyInPlace(t)}_shakeCamera(){let e=this._speed;this._lockMovement&&(e=this._lockSpeed),this._r.x+=.01*Math.cos(this._t)*o.Utils.clamp(0,this._maxSpeed,-e),this._r.y+=.01*Math.sin(this._t)*o.Utils.clamp(0,this._maxSpeed,-e),this._projectionMatrix.setRowFromFloats(3,this._r.x,this._r.y,this._r.z,this._r.w),this._t+=81337.18}_updateDashboard(){var e,t,i,s;let n=this._speed;this._lockMovement&&(n=this._lockSpeed),this._dashboard.setAllEngText(100*o.Utils.clamp(0,this._maxSpeed,-n)),this._dashboard.setSpeedText(this._speedKm),this._dashboard.setPlanetText(null!==(t=null===(e=this._planetData)||void 0===e?void 0:e.planet.getName())&&void 0!==t?t:"Inconnu"),this._dashboard.setDistanceText(null!==(s=(null===(i=this._planetData)||void 0===i?void 0:i.distance)*this._scaleSpeed)&&void 0!==s?s:0),this._dashboard.updateTime(),this._dashboard.updateFPSText()}_reorientToPlanet(){this._planetData&&(this._lockMovement||(this._rotationSpeedHori=0,this._rotationSpeedVer=0,this._parentMesh.lookAt(this._planetData.planet.getMesh().position)))}subCollision(e){this._spaceshipCollisionObservable.add(e)}enterSpaceship(){this._speed=0,this._speedKm=0,this._velocity=new n.Vector3(0,0,0),this._rotationSpeedHori=0,this._rotationSpeedVer=0,this._isGoingUp=!1,this._isGoingDown=!1,this._isGoingLeft=!1,this._isGoingRight=!1,this._isGoingForward=!1,this._isGoingBackward=!1,this._scene.activeCamera=this._camera,this._camera.parent=this._spaceship,this._unlockMove(),this._setupSpaceship(),this._setupEffect(),this._setupKeyboardInput(),this._setupDashboard(),this._spaceshipEnabled=!0}exitSpaceship(){this._spaceshipEnabled=!1,this._lockMove(),this._destroyEffect(),this._scene.onKeyboardObservable.remove(this._keyboardObserver)}_destroyEffect(){this._spaceshipEnabled=!1}getCamera(){return this._camera}}},7556:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColorFactory=void 0;const s=i(6285),n=i(5021);t.ColorFactory=class{static yellow(){return new n.ColorTheme(new s.Color4(1,1,.7,1),new s.Color4(1,1,.2,1),new s.Color4(.2,.2,0,.4))}static purple(){return new n.ColorTheme(new s.Color4(.9,0,.7,1),new s.Color4(.7,0,1,1),new s.Color4(.6,0,.26,.4))}}},5021:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColorTheme=void 0,t.ColorTheme=class{constructor(e,t,i){this._color1=e,this._color2=t,this._color3=i}get color1(){return this._color1}get color2(){return this._color2}get color3(){return this._color3}}},1513:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CloudEffect=void 0;const s=i(6285);class n extends s.GPUParticleSystem{constructor(e,t){if(super("cloud",{capacity:1500},e),!s.GPUParticleSystem.IsSupported)throw new Error("GPUParticleSystem is not supported");this._meshSpace=t,this._box=s.MeshBuilder.CreateBox("cloud",{size:1}),this._box.visibility=0,this._box.parent=t,this.emitter=this._box,this.isLocal=!0,this._box.position=new s.Vector3(0,0,5),this.particleTexture=new s.Texture("/assets/space/effects/smoke_15.png",e),this.color1=new s.Color4(.8,.8,.8,.5),this.color2=new s.Color4(.95,.95,.95,.4),this.colorDead=new s.Color4(.9,.9,.9,.3),this.minSize=4,this.maxSize=6,this.minLifeTime=.1,this.maxLifeTime=1.2,this.emitRate=0,this._maxEmitRate=2e3,this.blendMode=s.ParticleSystem.BLENDMODE_STANDARD,this.gravity=new s.Vector3(0,0,0),this.direction1=new s.Vector3(0,0,0),this.direction2=new s.Vector3(0,0,0),this.minAngularSpeed=-2,this.maxAngularSpeed=2,this.minEmitBox=new s.Vector3(-15,-10,-.5),this.maxEmitBox=new s.Vector3(15,10,.5),this.minEmitPower=.5,this.maxEmitPower=1,this.updateSpeed=.005}changeEmitRate(e){this.emitRate=e*this._maxEmitRate,e<=0&&this.reset()}}t.CloudEffect=n},1866:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TrailsEffect=void 0;const s=i(6285);class n extends s.ParticleSystem{constructor(e,t,i,n,o){super(e,t,i),this._box=s.MeshBuilder.CreateBox("box",{size:.01},i),this._box.isVisible=!1,this.particleTexture=new s.Texture("assets/space/effects/flare.png",i),this._box.parent=n,this.emitter=this._box,this.isLocal=!0,this.minEmitBox=new s.Vector3(0,0,0),this.maxEmitBox=new s.Vector3(0,0,0),this.color1=o.color1,this.color2=o.color2,this.colorDead=o.color3,this.minSize=.1,this.maxSize=.5,this.minLifeTime=.3,this.maxLifeTime=1.5,this.emitRate=0,this.blendMode=s.ParticleSystem.BLENDMODE_ONEONE,this.gravity=new s.Vector3(0,0,-10),this.direction1=new s.Vector3(-1,4,1),this.direction2=new s.Vector3(1,4,-1),this.minEmitPower=0,this.maxEmitPower=0,this.updateSpeed=.005}}t.TrailsEffect=n},6527:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TrailsManager=void 0;const s=i(6285),n=i(1866);t.TrailsManager=class{constructor(e,t,i,s,o,a,r){this.trails=[],this._maxEmitRate=200,this._maxGravity=-10,this._radius=s,this._distance=o,this._angled=a;for(let s=0;s<e;s++)this.trails.push(new n.TrailsEffect(s.toString(),200,t,i,r));this._setEmmitersPosition()}start(){this.trails.forEach((e=>{e.start()}))}_setEmmitersPosition(){let e=0,t=2*Math.PI/this.trails.length;this.trails.forEach((i=>{if(i.emitter instanceof s.Mesh){if(i.emitter.position.x=Math.cos(e)*this._radius,i.emitter.position.y=Math.sin(e)*this._radius,i.emitter.position.z=this._distance,this._angled){let t=new s.Vector3(5,5,1),n=new s.Vector3(Math.cos(e)*this._radius*-t.x,Math.sin(e)*this._radius*-t.y,this._distance*t.z);i.emitter.lookAt(n)}}else i.emitter instanceof s.Vector3&&(i.emitter.x=Math.cos(e)*this._radius,i.emitter.y=Math.sin(e)*this._radius,i.emitter.z=this._distance);e+=t}))}changeEmitRate(e){this.trails.forEach((t=>{t.emitRate=this._maxEmitRate*e,t.gravity=new s.Vector3(0,0,this._maxGravity*e)}))}stop(){this.trails.forEach((e=>{e.stop()}))}dispose(){this.trails.forEach((e=>{e.dispose()}))}}},5432:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ToonMaterial=void 0;const s=i(6285),n=i(3358);t.ToonMaterial=class{static createMaterial(e){let t=new n.NodeMaterial("Toon");var i=new n.InputBlock("position");i.visibleInInspector=!1,i.visibleOnFrame=!1,i.target=1,i.setAsAttribute("position");var o=new n.TransformBlock("worldPos");o.visibleInInspector=!1,o.visibleOnFrame=!1,o.target=1,o.complementZ=0,o.complementW=1;var a=new n.InputBlock("world");a.visibleInInspector=!1,a.visibleOnFrame=!1,a.target=1,a.setAsSystemValue(n.NodeMaterialSystemValues.World);var r=new n.TransformBlock("World normal");r.visibleInInspector=!1,r.visibleOnFrame=!1,r.target=1,r.complementZ=0,r.complementW=0;var l=new n.InputBlock("normal");l.visibleInInspector=!1,l.visibleOnFrame=!1,l.target=1,l.setAsAttribute("normal");var h=new n.VectorSplitterBlock("N");h.visibleInInspector=!1,h.visibleOnFrame=!1,h.target=4;var c=new n.NormalizeBlock("N (Normalized)");c.visibleInInspector=!1,c.visibleOnFrame=!1,c.target=4;var d=new n.DotBlock("N Dot L (Diffuse Light Intensity)");d.visibleInInspector=!1,d.visibleOnFrame=!1,d.target=4;var p=new n.NormalizeBlock("L (Normalized)");p.visibleInInspector=!1,p.visibleOnFrame=!1,p.target=4;var u=new n.LightInformationBlock("Light information");u.visibleInInspector=!1,u.visibleOnFrame=!1,u.target=1;var _=new n.AddBlock("H");_.visibleInInspector=!1,_.visibleOnFrame=!1,_.target=4;var m=new n.NormalizeBlock("V (Normalized)");m.visibleInInspector=!1,m.visibleOnFrame=!1,m.target=4;var g=new n.ViewDirectionBlock("View direction");g.visibleInInspector=!1,g.visibleOnFrame=!1,g.target=4;var f=new n.InputBlock("cameraPosition");f.visibleInInspector=!1,f.visibleOnFrame=!1,f.target=1,f.setAsSystemValue(n.NodeMaterialSystemValues.CameraPosition);var y=new n.DotBlock("N Dot V");y.visibleInInspector=!1,y.visibleOnFrame=!1,y.target=4;var v=new n.OneMinusBlock("1 - N Dot V");v.visibleInInspector=!1,v.visibleOnFrame=!1,v.target=4;var b=new n.MultiplyBlock("Rim INtensity");b.visibleInInspector=!1,b.visibleOnFrame=!1,b.target=4;var x=new n.PowBlock("Rim Factor");x.visibleInInspector=!1,x.visibleOnFrame=!1,x.target=4;var w=new n.InputBlock("Rim Intensity");w.visibleInInspector=!1,w.visibleOnFrame=!1,w.target=1,w.value=.4,w.min=0,w.max=0,w.isBoolean=!1,w.matrixMode=0,w.animationType=n.AnimatedInputBlockTypes.None,w.isConstant=!1;var M=new n.StepBlock("Quantized Rim Light Intensity");M.visibleInInspector=!1,M.visibleOnFrame=!1,M.target=4;var T=new n.InputBlock("Rim Cutoff");T.visibleInInspector=!1,T.visibleOnFrame=!1,T.target=1,T.value=.6,T.min=0,T.max=0,T.isBoolean=!1,T.matrixMode=0,T.animationType=n.AnimatedInputBlockTypes.None,T.isConstant=!1;var I=new n.ScaleBlock("Scale");I.visibleInInspector=!1,I.visibleOnFrame=!1,I.target=4;var P=new n.InputBlock("Rim Light Color");P.visibleInInspector=!1,P.visibleOnFrame=!1,P.target=1,P.value=new s.Color3(1,1,1),P.isConstant=!1;var C=new n.AddBlock("Add Rim + Spec + Diffuse + Ambient");C.visibleInInspector=!1,C.visibleOnFrame=!1,C.target=4;var S=new n.AddBlock("Add Specular + Diffuse + Ambient");S.visibleInInspector=!1,S.visibleOnFrame=!1,S.target=4;var k=new n.AddBlock("Add Ambient to Diffuse Light");k.visibleInInspector=!1,k.visibleOnFrame=!1,k.target=4;var O=new n.InputBlock("Ambient Light Color");O.visibleInInspector=!1,O.visibleOnFrame=!1,O.target=1,O.value=new s.Color3(.1803921568627451,.1803921568627451,.1803921568627451),O.isConstant=!1;var E=new n.ScaleBlock("Diffuse Light Calculation");E.visibleInInspector=!1,E.visibleOnFrame=!1,E.target=4;var D=new n.InputBlock("Diffuse Light Color");D.visibleInInspector=!1,D.visibleOnFrame=!1,D.target=1,D.value=new s.Color3(.6901960784313725,.6901960784313725,.6901960784313725),D.isConstant=!1;var A=new n.StepBlock("Quantized Diffuse Light Intensity");A.visibleInInspector=!1,A.visibleOnFrame=!1,A.target=4;var j=new n.InputBlock("Diffuse Cutoff");j.visibleInInspector=!1,j.visibleOnFrame=!1,j.target=1,j.value=0,j.min=0,j.max=0,j.isBoolean=!1,j.matrixMode=0,j.animationType=n.AnimatedInputBlockTypes.None,j.isConstant=!1;var B=new n.MultiplyBlock("Specular Factor");B.visibleInInspector=!1,B.visibleOnFrame=!1,B.target=4;var R=new n.DotBlock("N Dot H");R.visibleInInspector=!1,R.visibleOnFrame=!1,R.target=4;var N=new n.NormalizeBlock("H (Normalized)");N.visibleInInspector=!1,N.visibleOnFrame=!1,N.target=4;var L=new n.PowBlock("Specular Intensity");L.visibleInInspector=!1,L.visibleOnFrame=!1,L.target=4;var F=new n.MultiplyBlock("Glossiness ^2");F.visibleInInspector=!1,F.visibleOnFrame=!1,F.target=4;var V=new n.InputBlock("Glossiness");V.visibleInInspector=!1,V.visibleOnFrame=!1,V.target=1,V.value=5,V.min=0,V.max=0,V.isBoolean=!1,V.matrixMode=0,V.animationType=n.AnimatedInputBlockTypes.None,V.isConstant=!1;var z=new n.StepBlock("Quantized Specular Intensity");z.visibleInInspector=!1,z.visibleOnFrame=!1,z.target=4;var G=new n.InputBlock("Specular Cutoff");G.visibleInInspector=!1,G.visibleOnFrame=!1,G.target=1,G.value=.5,G.min=0,G.max=0,G.isBoolean=!1,G.matrixMode=0,G.animationType=n.AnimatedInputBlockTypes.None,G.isConstant=!1;var K=new n.ScaleBlock("Calculate Specular Light");K.visibleInInspector=!1,K.visibleOnFrame=!1,K.target=4;var W=new n.InputBlock("Color3");W.visibleInInspector=!1,W.visibleOnFrame=!1,W.target=1,W.value=new s.Color3(1,1,1),W.isConstant=!1;var q=new n.MultiplyBlock("Multiply Lighting by Color");q.visibleInInspector=!1,q.visibleOnFrame=!1,q.target=4;var H=new n.TextureBlock("Texture"),U=new n.InputBlock("uv"),Q=new n.ImageSourceBlock("Surface Texture");new n.InputBlock("Surface Color"),H.visibleInInspector=!1,H.visibleOnFrame=!1,H.target=3,H.convertToGammaSpace=!1,H.convertToLinearSpace=!1,H.disableLevelMultiplication=!1,H.texture=e,H.texture.wrapU=1,H.texture.wrapV=1,H.texture.uAng=0,H.texture.vAng=0,H.texture.wAng=0,H.texture.uOffset=0,H.texture.vOffset=0,H.texture.uScale=1,H.texture.vScale=1,H.texture.coordinatesMode=7,U.visibleInInspector=!1,U.visibleOnFrame=!1,U.target=1,U.setAsAttribute("uv"),Q.visibleInInspector=!1,Q.visibleOnFrame=!1,Q.target=3,Q.texture=e,Q.texture.wrapU=1,Q.texture.wrapV=1,Q.texture.uAng=0,Q.texture.vAng=0,Q.texture.wAng=0,Q.texture.uOffset=0,Q.texture.vOffset=0,Q.texture.uScale=1,Q.texture.vScale=1,Q.texture.coordinatesMode=7;var Y=new n.FragmentOutputBlock("fragmentOutput");Y.visibleInInspector=!1,Y.visibleOnFrame=!1,Y.target=2,Y.convertToGammaSpace=void 0,Y.convertToLinearSpace=void 0,Y.useLogarithmicDepth=!1;var X=new n.TransformBlock("worldPos * viewProjectionTransform");X.visibleInInspector=!1,X.visibleOnFrame=!1,X.target=1,X.complementZ=0,X.complementW=1;var Z=new n.InputBlock("viewProjection");Z.visibleInInspector=!1,Z.visibleOnFrame=!1,Z.target=1,Z.setAsSystemValue(n.NodeMaterialSystemValues.ViewProjection);var $=new n.VertexOutputBlock("vertexOutput");return $.visibleInInspector=!1,$.visibleOnFrame=!1,$.target=1,i.output.connectTo(o.vector),a.output.connectTo(o.transform),o.output.connectTo(X.vector),Z.output.connectTo(X.transform),X.output.connectTo($.vector),O.output.connectTo(k.left),D.output.connectTo(E.input),l.output.connectTo(r.vector),a.output.connectTo(r.transform),r.output.connectTo(h.xyzw),h.xyzOut.connectTo(c.input),c.output.connectTo(d.left),o.output.connectTo(u.worldPosition),u.direction.connectTo(p.input),p.output.connectTo(d.right),d.output.connectTo(A.value),j.output.connectTo(A.edge),A.output.connectTo(E.factor),E.output.connectTo(k.right),k.output.connectTo(S.left),W.output.connectTo(K.input),c.output.connectTo(R.left),o.output.connectTo(g.worldPosition),f.output.connectTo(g.cameraPosition),g.output.connectTo(m.input),m.output.connectTo(_.left),p.output.connectTo(_.right),_.output.connectTo(N.input),N.output.connectTo(R.right),R.output.connectTo(B.left),A.output.connectTo(B.right),B.output.connectTo(L.value),V.output.connectTo(F.left),V.output.connectTo(F.right),F.output.connectTo(L.power),L.output.connectTo(z.value),G.output.connectTo(z.edge),z.output.connectTo(K.factor),K.output.connectTo(S.right),S.output.connectTo(C.left),P.output.connectTo(I.input),c.output.connectTo(y.left),m.output.connectTo(y.right),y.output.connectTo(v.input),v.output.connectTo(b.left),d.output.connectTo(x.value),w.output.connectTo(x.power),x.output.connectTo(b.right),b.output.connectTo(M.value),T.output.connectTo(M.edge),M.output.connectTo(I.factor),I.output.connectTo(C.right),C.output.connectTo(q.left),U.output.connectTo(H.uv),Q.source.connectTo(H.source),H.rgb.connectTo(q.right),q.output.connectTo(Y.rgb),t.addOutputNode($),t.addOutputNode(Y),t.build(),t}}},7650:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Dashboard=void 0;const s=i(6285),n=i(9848);t.Dashboard=class{constructor(e,t){this._scene=e,this.spaceship=t,this._initMesh(),this._initGUI()}_initMesh(){this._screenMesh=s.MeshBuilder.CreatePlane("screen",{width:1.75,height:1},this._scene),this._screenMesh.parent=this.spaceship,this._screenMesh.visibility=.75,this._screenMesh.position=new s.Vector3(0,.75,.4),this._screenMesh.rotation=new s.Vector3(.53,0,0),this._screenMesh.scaling=new s.Vector3(.6,.6,1)}_initGUI(){this._uiTexture=n.AdvancedDynamicTexture.CreateForMesh(this._screenMesh,2048,1170,!1),this._uiTexture.background="transparent",this._uiTexture.parseFromURLAsync("assets/space/ui/FullDashboard.json").then((()=>{new s.StandardMaterial("mat",this._scene).diffuseTexture=this._uiTexture,this._grabElement()}))}_grabElement(){this._speedText=this._uiTexture.getControlByName("SPEED"),this._eng1Text=this._uiTexture.getControlByName("ENG_1"),this._eng2Text=this._uiTexture.getControlByName("ENG_2"),this._eng3Text=this._uiTexture.getControlByName("ENG_3"),this._pressText=this._uiTexture.getControlByName("PRESS"),this._tempText=this._uiTexture.getControlByName("TEMP"),this._o2Text=this._uiTexture.getControlByName("O2"),this._timeText=this._uiTexture.getControlByName("TIME"),this._distanceText=this._uiTexture.getControlByName("DISTANCE"),this._fpsText=this._uiTexture.getControlByName("FPS"),this._planetText=this._uiTexture.getControlByName("PLANET")}setSpeedText(e){this._speedText&&(this._speedText.text=e.toFixed(0))}setEng1Text(e){this._eng1Text&&(this._eng1Text.text=e.toFixed(0)+"%")}setEng2Text(e){this._eng2Text&&(this._eng2Text.text=e.toFixed(0)+"%")}setEng3Text(e){this._eng3Text&&(this._eng3Text.text=e.toFixed(0)+"%")}setAllEngText(e){this.setEng1Text(e),this.setEng2Text(e),this.setEng3Text(e)}setPressText(e){this._pressText&&(this._pressText.text=e.toFixed(0)+"hPa")}setTempText(e){this._tempText&&(this._tempText.text=e.toFixed(0)+"°C")}setO2Text(e){this._o2Text&&(this._o2Text.text=e.toFixed(0)+"%")}updateTime(){if(!this._timeText)return;let e=new Date,t=e.getHours(),i=e.getMinutes(),s=e.getSeconds();this._timeText.text=(t<10?"0"+t:t)+":"+(i<10?"0"+i:i)+":"+(s<10?"0"+s:s)}setDistanceText(e){this._distanceText&&(this._distanceText.text=e.toFixed(0)+"km restant")}updateFPSText(){if(!this._fpsText)return;let e=this._scene.getEngine().getFps();this._fpsText.text=e.toFixed(0)+"fps"}setPlanetText(e){this._planetText&&(this._planetText.text=e)}}},8841:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Dialogue=void 0;class i{constructor(){this._texts=[],this._cloneTexts=[],this._textTime=[],this._textTimeClone=[],this._isLooping=!1,this.monsterCountElement=document.getElementById("monster-count"),this.playerInfo={healthBar:document.getElementById("health-bar"),questTitle:document.getElementById("quest-title"),questDescription:document.getElementById("quest-description"),playerImage:document.getElementById("player-image")},this.dialoguesElement=document.getElementById("dialogues"),this.hintElement=document.getElementById("hint-text"),this.overlayElement=document.getElementById("game-overlay")}static getInstance(){return i.instance||(i.instance=new i),i.instance}set isLooping(e){this._isLooping=e}addText(e,t){this._texts.push(e),this._textTime.push(t),this._cloneTexts=[...this._texts],this._textTimeClone=[...this._textTime]}update(e){this._texts.length>0?(this.dialoguesElement.style.display="block",this.updateDialogues(this._texts[0]),this._textTime[0]-=e,this._textTime[0]<0&&(this._texts.shift(),this._textTime.shift())):(this.clearDialogues(),this._isLooping&&(this._texts=[...this._cloneTexts],this._textTime=[...this._textTimeClone]))}updateMonsterCount(e){this.monsterCountElement.innerText=`Monstres restants : ${e}`}updatePlayerInfo(e,t,i){this.playerInfo.healthBar.style.width=`${e}%`,this.playerInfo.questTitle.innerText=t,this.playerInfo.questDescription.innerText=i}updateHealthBar(e){this.playerInfo.healthBar.style.width=`${e}%`}updateQuest(e,t){this.playerInfo.questTitle.innerText=e,this.playerInfo.questDescription.innerText=t}updateQuestTitle(e){this.playerInfo.questTitle.innerText=e}updateQuestDescription(e){this.playerInfo.questDescription.innerText=e}updateDialogues(e){this.dialoguesElement.style.display="block",this.dialoguesElement.innerText=e}updatePlayerImage(e){this.playerInfo.playerImage.src=e}show(){this.monsterCountElement.style.display="block",this.playerInfo.healthBar.style.display="block",this.playerInfo.questTitle.style.display="block",this.playerInfo.questDescription.style.display="block",this.dialoguesElement.style.display="block",this.playerInfo.playerImage.style.display="block",this.hintElement.style.display="block",this.overlayElement.style.display="block"}hide(){this.overlayElement.style.display="none"}clearDialogues(){this.dialoguesElement.innerText="",this.dialoguesElement.style.display="none"}showOnlyDialogues(){this.monsterCountElement.style.display="none",this.playerInfo.healthBar.style.display="none",this.playerInfo.questTitle.style.display="none",this.playerInfo.questDescription.style.display="none",this.dialoguesElement.style.display="none",this.playerInfo.playerImage.style.display="none",this.hintElement.style.display="block",this.overlayElement.style.display="block"}updateHint(e){this.hintElement.style.display="block",this.hintElement.innerText=e}hideHint(){this.hintElement.style.display="none"}clear(){this._texts=[],this._textTime=[],this._cloneTexts=[],this._textTimeClone=[]}get isCompleted(){return 0==this._texts.length}}t.Dialogue=i},6376:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Utils=void 0,t.Utils=class{static clamp(e,t,i){let s=(i-e)/(t-e);return Math.min(Math.max(s,0),1)}}},6515:function(e,t,i){var s=i(8764).lW;(function(){var t;t=function(){function e(e,t,i){if(this.width=e,this.height=t,this.bytes=i,!(e>0&&t>0&&s.isBuffer(i)))throw new Error("bad arguments, width:"+e+", height:"+t+", bytes:"+i);if(i.length!==Math.ceil(e*t/8))throw new Error("bytes length mismatch, width:"+e+", height:"+t+", bytes.length:"+i.length)}return e.bytesFrom2DArray=function(e,t,i){var n,o,a,r,l,h,c,d,p,u,_,m,g;if(isNaN(e)||e<=0||isNaN(t)||t<=0||!Array.isArray(i))return console.log("ERROR [grid$::bytesFrom2DArray] bad arguments, width:"+e+", height:"+t+", array2d:"+i),null;for((n=new s(Math.ceil(e*t/8))).fill(255),p=u=0,m=i.length;u<m;p=++u)for(d=_=0,g=(c=i[p]).length;_<g;d=++_)r=c[d],Boolean(r)||(h=7-(l=p*e+d)%8,o=n[a=l>>>3],o^=1<<h,n[a]=o);return n},e.prototype.isWalkableAt=function(e,t){var i,s,n,o;return!(e<0||t<0||e>=this.width||t>=this.height||(s=(n=t*this.width+e)>>>3,o=7-n%8,i=this.bytes[s],Boolean(i>>>o&1)))},e.prototype.setWalkableAt=function(e,t,i){var s,n,o,a;return!(e<0||t<0||e>=this.width||t>=this.height)&&(n=(o=t*this.width+e)>>>3,a=7-o%8,s=this.bytes[n],i!==this.isWalkableAt(e,t)?this.bytes[n]=s^1<<a:void 0)},e.prototype.getNeighbors=function(e,t,i,s){var n,o,a,r,l,h,c,d,p;return null==i&&(i=!1),null==s&&(s=!1),e<0||t<0||e>=this.width||t>=this.height?null:(l=[],this.isWalkableAt(e,t-1)&&(l.push(e<<16|t-1),h=!0),this.isWalkableAt(e+1,t)&&(l.push(e+1<<16|t),c=!0),this.isWalkableAt(e,t+1)&&(l.push(e<<16|t+1),d=!0),this.isWalkableAt(e-1,t)&&(l.push(e-1<<16|t),p=!0),i?(s?(n=p&&h,o=h&&c,a=c&&d,r=d&&p):(n=p||h,o=h||c,a=c||d,r=d||p),n&&this.isWalkableAt(e-1,t-1)&&l.push(e-1<<16|t-1),o&&this.isWalkableAt(e+1,t-1)&&l.push(e+1<<16|t-1),a&&this.isWalkableAt(e+1,t+1)&&l.push(e+1<<16|t+1),r&&this.isWalkableAt(e-1,t+1)&&l.push(e-1<<16|t+1),l):l)},e.prototype.getARandomWalkableBrick=function(){for(var e,t;;)if(e=Math.random()*this.width>>>0,t=Math.random()*this.height>>>0,this.isWalkableAt(e,t))return e<<16|t},e.prototype.toString=function(e,t,i){var s,n,o,a,r,l,h,c,d,p,u,_;if(o={},Array.isArray(i))for(n=h=0,p=i.length;h<p;n=++h)o[i[n]]=n%10;for(isNaN(e)||(o[e]="S"),isNaN(t)||(o[t]="E"),a="[Grid(width="+this.width+", height="+this.height+")]\nDump: ░=walkable, ▓=blocked",l=c=0,u=this.height;c<u;l=c+=1){for(s=[],r=d=0,_=this.width;d<_;r=d+=1)void 0!==o[r<<16|l]?s.push(o[r<<16|l]):s.push(this.isWalkableAt(r,l)?"░":"▓");a=a+"\n"+s.join("")}return a},e}(),e.exports=t}).call(this)},5575:function(e){(function(){var t;t=function(){function e(e){this.locToF=e,this.nodes=[]}return e.prototype.isNotEmpty=function(){return this.nodes.length>0},e.prototype._siftdown=function(e,t){var i,s,n;for(i=this.nodes[t];t>e&&(n=t-1>>>1,s=this.nodes[n],this.locToF[i]<this.locToF[s]);)this.nodes[t]=s,t=n;this.nodes[t]=i},e.prototype._siftup=function(e){var t,i,s,n,o;for(i=this.nodes.length,o=e,s=this.nodes[e],t=1+(e<<1);t<i;)(n=t+1)<i&&this.locToF[this.nodes[t]]>this.locToF[this.nodes[n]]&&(t=n),this.nodes[e]=this.nodes[t],t=1+((e=t)<<1);this.nodes[e]=s,this._siftdown(o,e)},e.prototype.updateItem=function(e){var t;(t=this.nodes.indexOf(e))<0||(this._siftdown(0,t),this._siftup(t))},e.prototype.push=function(e){return this.nodes.push(e),this._siftdown(0,this.nodes.length-1)},e.prototype.pop=function(){var e,t;return e=this.nodes.pop(),this.nodes.length?(t=this.nodes[0],this.nodes[0]=e,this._siftup(0),t):e},e.prototype.reset=function(e){this.nodes.length=0,this.locToF=e},e}(),e.exports=t}).call(this)},394:function(e,t,i){(function(){var t,s,n,o,a,r,l,h,c,d,p,u,_,m,g;t=i(5575),_=new t,m=0,o=0,a=null,l=null,p=null,c=null,d=null,h=null,u=null,s=Math.SQRT2,r=function(e,t){return e+t},n=function(e){var t;for((t=[]).push(e);u[e];)e=u[e],t.unshift(e);return t},g={findPathByBrickLoc:function(e,t,i){return g.findPath(e>>>16,65535&e,t>>>16,65535&t,i)},findPath:function(e,t,i,g,f,y,v,b){var x,w,M,T,I,P,C,S,k,O,E;if(null==y&&(y=!1),null==v&&(v=!1),null==b&&(b=2147483647),isNaN(e)||e<0||isNaN(t)||t<0||isNaN(i)||i<0||isNaN(g)||g<0||!f)return console.log("ERROR [syncfinder_astar::findPath] bad arguments, startX:"+e+", startY:"+t+", endX:"+i+", endY:"+g+", theGrid:"+f),null;o=i<<16|g,a=f,l={},p={},h={},d={},u={},(c={})[m=e<<16|t]=0,h[m]=0,_.reset(h),_.push(m),p[m]=!0;let D=0;for(;_.isNotEmpty();){if(D++>b)return console.warn("WARNING [syncfinder_astar::findPath] max iterations reached, returning null"),null;if(I=_.pop(),l[I]=!0,I===o)return n(I);for(P=I>>>16,C=65535&I,O=0,E=(M=a.getNeighbors(P,C,y,v)).length;O<E;O++)x=M[O],l[x]||(S=x>>>16,k=65535&x,T=c[I]+(S===P||k===C?1:s),(!p[x]||T<c[x])&&(c[x]=T,d[x]=d[x]||r(Math.abs(S-i),Math.abs(k-g)),h[x]=c[x]+d[x],u[w=S<<16|k]=I,p[x]?_.updateItem(w):(_.push(w),p[x]=!0)))}return null}},e.exports=g}).call(this)},7872:e=>{"use strict";e.exports=JSON.parse('{"characters":[{"id":1,"name":"Character Test","hitpoint":{"max":120,"regenAmount":20,"regenDelay":10},"combat":{"attackDelay":1.5,"shootDamage":25,"shootRadius":3,"projectileId":1,"projectileSpeed":25,"projectileLifetime":1},"movement":{"speed":7.5,"dashSpeed":50,"acceleration":45,"deceleration":45,"dashDeceleration":5},"animation":{"idle":{"clip":"Idle","loop":true,"speed":1,"alt":[]},"walk":{"clip":"Walk","loop":true,"speed":1,"alt":[]},"attack":{"clip":"Hit","loop":false,"speed":1,"alt":[]},"die":{"clip":"Die","loop":false,"speed":1,"alt":[]},"damage":{"clip":"","loop":false,"speed":1,"alt":[]}},"render":{"model":"models/characters/new_char.glb","scale":0.75,"rotation":0}}],"monsters":[{"id":1,"name":"Wolf_White","hitpoint":{"max":50,"regenAmount":20,"regenDelay":60},"combat":{"attackDelay":1.5,"shootDamage":40,"shootRadius":4,"projectileId":0,"projectileSpeed":0,"projectileLifetime":0,"alertInRadius":20,"alertOutRadius":30,"patrolRadius":12.5},"movement":{"speed":9,"dashSpeed":45,"acceleration":15,"deceleration":10,"dashDeceleration":6},"animation":{"idle":{"clip":"Idle","loop":true,"speed":0.75,"alt":["Look Around","Howl"]},"walk":{"clip":"Run Forward WO Root","loop":true,"speed":1,"alt":[]},"attack":{"clip":"Pound Attack W Root","loop":false,"speed":1,"alt":[]},"die":{"clip":"Die","loop":false,"speed":1,"alt":[]},"damage":{"clip":"Take Damage","loop":false,"speed":1,"alt":[]}},"render":{"model":"models/monsters/wolf_white.glb","scale":0.8,"rotation":-90},"isBoss":false},{"id":2,"name":"Golem","hitpoint":{"max":500,"regenAmount":20,"regenDelay":60},"combat":{"attackDelay":4,"shootDamage":40,"shootRadius":4,"projectileId":0,"projectileSpeed":0,"projectileLifetime":0,"alertInRadius":25,"alertOutRadius":35,"patrolRadius":12.5},"movement":{"speed":4,"dashSpeed":45,"acceleration":15,"deceleration":10,"dashDeceleration":6},"animation":{"idle":{"clip":"Idle","loop":true,"speed":0.75,"alt":[]},"walk":{"clip":"Walk Forward WO Root","loop":true,"speed":0.5,"alt":[]},"attack":{"clip":"Hit Ground Attack","loop":false,"speed":1,"alt":["Punch Attack"]},"die":{"clip":"Die","loop":false,"speed":1,"alt":[]},"damage":{"clip":"Take Damage","loop":false,"speed":1,"alt":[]}},"render":{"model":"models/monsters/golem.glb","scale":0.8,"rotation":-90},"isBoss":true},{"id":3,"name":"Magma","hitpoint":{"max":200,"regenAmount":20,"regenDelay":60},"combat":{"attackDelay":5,"shootDamage":40,"shootRadius":4,"projectileId":0,"projectileSpeed":0,"projectileLifetime":0,"alertInRadius":25,"alertOutRadius":35,"patrolRadius":12.5},"movement":{"speed":4,"dashSpeed":45,"acceleration":15,"deceleration":10,"dashDeceleration":6},"animation":{"idle":{"clip":"Idle","loop":true,"speed":0.75,"alt":[]},"walk":{"clip":"Walk Forward WO Root","loop":true,"speed":0.5,"alt":[]},"attack":{"clip":"Hit Ground Attack","loop":false,"speed":1,"alt":["Punch Attack"]},"die":{"clip":"Die","loop":false,"speed":1,"alt":[]},"damage":{"clip":"Take Damage","loop":false,"speed":1,"alt":[]}},"render":{"model":"models/monsters/magma.glb","scale":0.8,"rotation":-90},"isBoss":false}],"projectiles":[{"id":1,"name":"Slime Ball","render":{"model":"models/projectiles/fireball.glb","scale":0.6,"rotation":0}}],"scenes":[{"width":1732,"height":1768,"precision":4,"useBakedTilemap":true,"models":[{"path":"Terrain_0_0-20230529_-_194720.glb","position":{"x":-79.3,"y":0,"z":-70.3},"rotation":{"x":0,"y":0,"z":0},"scale":{"x":1,"y":1,"z":1}},{"path":"scene.glb","position":{"x":0,"y":0,"z":0},"rotation":{"x":0,"y":0,"z":0},"scale":{"x":1,"y":1,"z":1}}],"objects":[{"id":200001,"name":"Monster.1","position":{"x":81.1000061,"y":75.19},"direction":-1.33786261,"type":1,"params":{"config":1,"freezePatrol":true}},{"id":600001,"name":"NPC.1","position":{"x":84.22,"y":82.92999},"direction":0.8229945,"type":5,"params":{"config":1}},{"id":500003,"name":"Trigger.InCity_2","position":{"x":180.7,"y":305.7},"direction":-1.57079637,"type":4,"params":{"area":[105.7,263.2,255.7,348.2],"autoReset":true}},{"id":400001,"name":"Chest.1","position":{"x":103.549995,"y":114.289993},"direction":0.6876505,"type":3,"params":{"drops":[]}},{"id":600002,"name":"NPC.2","position":{"x":70.7999954,"y":246.64},"direction":0.7516404,"type":5,"params":{"config":2}},{"id":500002,"name":"Trigger.InCity_1","position":{"x":155.099991,"y":249.1},"direction":-1.57079637,"type":4,"params":{"area":[60.09999,206.6,250.099991,291.6],"autoReset":true}},{"id":200002,"name":"Monster.2","position":{"x":90.92,"y":77.8500061},"direction":3.7778697,"type":1,"params":{"config":1,"freezePatrol":true}},{"id":200013,"name":"Monster.13","position":{"x":172.4,"y":15.1999969},"direction":-1.57079637,"type":1,"params":{"config":2,"freezePatrol":false}},{"id":200007,"name":"Monster.7","position":{"x":139.8,"y":388.3},"direction":-1.57079637,"type":1,"params":{"config":1,"freezePatrol":false}},{"id":200006,"name":"Monster.6","position":{"x":123.899994,"y":388.3},"direction":-1.57079637,"type":1,"params":{"config":1,"freezePatrol":false}},{"id":200003,"name":"Monster.3","position":{"x":91.54999,"y":87.67999},"direction":2.56423783,"type":1,"params":{"config":1,"freezePatrol":true}},{"id":200008,"name":"Monster.8","position":{"x":283.8,"y":385.099976},"direction":-1.57079637,"type":1,"params":{"config":1,"freezePatrol":false}},{"id":200009,"name":"Monster.9","position":{"x":225.799988,"y":103.899994},"direction":-1.57079637,"type":1,"params":{"config":3,"freezePatrol":false}},{"id":200010,"name":"Monster.10","position":{"x":14.6999969,"y":213.7},"direction":-1.57079637,"type":1,"params":{"config":3,"freezePatrol":false}},{"id":200004,"name":"Monster.4","position":{"x":268.4,"y":35.1999969},"direction":-1.57079637,"type":1,"params":{"config":2,"freezePatrol":false}},{"id":600003,"name":"NPC.3","position":{"x":159.3,"y":260},"direction":1.57079625,"type":5,"params":{"config":2}},{"id":100001,"name":"Character.1","position":{"x":54.6,"y":23},"direction":-1.57079637,"type":0,"params":{"config":1}},{"id":200011,"name":"Monster.11","position":{"x":273.599976,"y":175.9},"direction":-1.57079637,"type":1,"params":{"config":3,"freezePatrol":false}},{"id":200005,"name":"Monster.5","position":{"x":15.5999985,"y":388.3},"direction":-1.57079637,"type":1,"params":{"config":2,"freezePatrol":false}},{"id":500001,"name":"Trigger.Quest_KillMonsterTutorial.1","position":{"x":79.3999939,"y":82},"direction":-1.57079637,"type":4,"params":{"area":[44.3999939,47,114.399994,117],"autoReset":false}},{"id":200012,"name":"Monster.12","position":{"x":7.699997,"y":290.4},"direction":-1.57079637,"type":1,"params":{"config":1,"freezePatrol":false}},{"id":600004,"name":"NPC.3 (1)","position":{"x":159.3,"y":294},"direction":1.57079625,"type":5,"params":{"config":2}}],"points":[{"id":3,"position":{"x":202.9,"y":189.8}},{"id":6,"position":{"x":205.2,"y":254.21}},{"id":4,"position":{"x":83.98,"y":70.47}},{"id":7,"position":{"x":205.2,"y":248.29}},{"id":5,"position":{"x":94.4,"y":50.5}},{"id":8,"position":{"x":205.01,"y":241.22}},{"id":2,"position":{"x":78.9,"y":154.2}},{"id":1,"position":{"x":84.2,"y":83}}],"id":1,"name":"Map_Desert","hideFlags":0}],"missions":[{"id":10000,"name":"Intro_Radio","sceneId":0,"dependencyIds":[],"groupId":1,"type":0,"dialogs":[],"tpPoint":0,"title":"","description":"","cinematic":"","video":"Game_Intro_Radio.mp4","triggerIds":[],"monsterIds":[],"monsterCount":0,"npcId":0,"npcFirstDialog":"","npcGenericDialog":"","npcMovePointIds":[]},{"id":1,"name":"Intro_Landing","sceneId":1,"dependencyIds":[],"groupId":1,"type":0,"dialogs":[],"tpPoint":0,"title":"Introduction - Sauver les Nekoma","description":"A l\'atterissage","cinematic":"Cinematic_Intro","video":"","triggerIds":[],"monsterIds":[],"monsterCount":0,"npcId":0,"npcFirstDialog":"","npcGenericDialog":"","npcMovePointIds":[]},{"id":2,"name":"Intro_GoTo1stFight","sceneId":1,"dependencyIds":[1],"groupId":1,"type":1,"dialogs":[{"text":"Pfiou, ce voyage spatial a été mouvementé. Je crois que le village des Nekoma est proche d\'ici.","delay":0},{"text":"Je devrais faire attention au vent, il est assez fort sur cette hémisphère.","delay":0}],"tpPoint":0,"title":"Introduction - Sauver les Nekoma","description":"Trouvez un moyen de rejoindre le village des Nekoma.","cinematic":"","video":"","triggerIds":[500001],"monsterIds":[],"monsterCount":0,"npcId":0,"npcFirstDialog":"","npcGenericDialog":"","npcMovePointIds":[]},{"id":3,"name":"Intro_KillMonster_Intro","sceneId":1,"dependencyIds":[2],"groupId":1,"type":0,"dialogs":[{"text":"(Ces chiens ressemblent à ceux de Astria Corp...)","delay":0},{"text":"(Je devrais les tuer avant qu\'ils ne s\'en prennent à cet homme.)","delay":0}],"tpPoint":5,"title":"Introduction - Sauver les Nekoma","description":"","cinematic":"Cinematic_1stAttack_Intro","video":"","triggerIds":[],"monsterIds":[],"monsterCount":0,"npcId":0,"npcFirstDialog":"","npcGenericDialog":"","npcMovePointIds":[]},{"id":4,"name":"Intro_KillMonster_Battle","sceneId":1,"dependencyIds":[3],"groupId":1,"type":2,"dialogs":[],"tpPoint":0,"title":"Introduction - Sauver les Nekoma","description":"Tuez les loups qui menacent l\'homme (%progress% / %total%)<br/>Cliquez sur eux pour les attaquer.","cinematic":"","video":"","triggerIds":[],"monsterIds":[200001,200002,200003],"monsterCount":0,"npcId":0,"npcFirstDialog":"","npcGenericDialog":"","npcMovePointIds":[]},{"id":5,"name":"Intro_KillMonster_End","sceneId":1,"dependencyIds":[4],"groupId":1,"type":0,"dialogs":[{"text":"Merci de m\'avoir sauvé. Je suis le chef du village des Nekoma.","delay":0},{"text":"D\'après votre tenue, j\'imagine que vous êtes envoyé par Eco Earth pour nous aider.","delay":0},{"text":"Nous sommes attaqués par des créatures de Astria Corp. Elles veulent nous voler notre eau.","delay":0},{"text":"Nous avons besoin de votre aide pour les repousser.","delay":0},{"text":"Je vous invite à me suivre au village.","delay":0}],"tpPoint":4,"title":"Introduction - Sauver les Nekoma","description":"","cinematic":"Cinematic_1stAttack_End","video":"","triggerIds":[],"monsterIds":[],"monsterCount":0,"npcId":0,"npcFirstDialog":"","npcGenericDialog":"","npcMovePointIds":[]},{"id":6,"name":"Intro_FollowToVillage","sceneId":1,"dependencyIds":[5],"groupId":1,"type":5,"dialogs":[],"tpPoint":0,"title":"Introduction - Sauver les Nekoma","description":"Suivez l\'homme jusqu\'au village","cinematic":"","video":"","triggerIds":[],"monsterIds":[],"monsterCount":0,"npcId":600001,"npcFirstDialog":"","npcGenericDialog":"","npcMovePointIds":[1,2,3,6,7]},{"id":7,"name":"Intro_NpcTalk","sceneId":1,"dependencyIds":[6],"groupId":1,"type":0,"dialogs":[{"text":"Chef: Nous avons besoin de vous pour affronter les créatures de Astro Corp","delay":0},{"text":"Chef: Au total, nous en avons dénombrer 10 autours de la ville. Je vous demande de les tuer.","delay":0},{"text":"Vous: Rassemblez les habitants dans un endroit sûr, je m\'occupe des créatures.","delay":0},{"text":"Chef: Bien, merci à vous.","delay":0}],"tpPoint":8,"title":"Introduction - Sauver les Nekoma","description":"","cinematic":"Cinematic_ChiefTalk_Intro","video":"","triggerIds":[],"monsterIds":[],"monsterCount":0,"npcId":600001,"npcFirstDialog":"","npcGenericDialog":"","npcMovePointIds":[1,2,3,6,7]},{"id":8,"name":"Intro_KillMonster_Battle","sceneId":1,"dependencyIds":[7],"groupId":1,"type":3,"dialogs":[],"tpPoint":0,"title":"Introduction - Sauver les Nekoma","description":"Tuez les monstres autours de la ville (%progress% / %total%)","cinematic":"","video":"","triggerIds":[],"monsterIds":[],"monsterCount":10,"npcId":0,"npcFirstDialog":"","npcGenericDialog":"","npcMovePointIds":[]}],"npcs":[{"id":1,"name":"Nekoma\'s Chief","render":{"model":"models/npcs/nekoma_chief.glb","scale":1,"rotation":0},"animation":{"idle":{"clip":"Idle","loop":true,"speed":1,"alt":[]},"walk":{"clip":"Walk","loop":true,"speed":1,"alt":[]},"run":{"clip":"Run","loop":true,"speed":1,"alt":[]},"attack":{"clip":"Attack","loop":false,"speed":1,"alt":[]},"die":{"clip":"Die","loop":false,"speed":1,"alt":[]},"damage":{"clip":"damage","loop":false,"speed":1,"alt":[]}}},{"id":2,"name":"Trader","render":{"model":"models/npcs/trader.glb","scale":1,"rotation":0},"animation":{"idle":{"clip":"Idle","loop":true,"speed":1,"alt":[]},"walk":{"clip":"","loop":true,"speed":1,"alt":[]},"run":{"clip":"","loop":true,"speed":1,"alt":[]},"attack":{"clip":"","loop":false,"speed":1,"alt":[]},"die":{"clip":"","loop":false,"speed":1,"alt":[]},"damage":{"clip":"","loop":false,"speed":1,"alt":[]}}}],"audios":[{"id":1,"name":"Ambiant_1","type":0,"location":0,"volume":0.5,"loop":true,"audio":"audios/ambiant.mp3","area":[]},{"id":2,"name":"Ambiant_2","type":0,"location":1,"volume":0.5,"loop":true,"audio":"audios/ambiant_city.mp3","area":[500002,500003]},{"id":3,"name":"Battle","type":1,"location":0,"volume":0.5,"loop":true,"audio":"audios/battle.mp3","area":[]},{"id":3,"name":"Battle_boss","type":1,"location":0,"volume":0.5,"loop":true,"audio":"audios/battle.mp3","area":[]}],"globals":{"npcMovement":{"speed":7.75,"dashSpeed":30,"acceleration":10,"deceleration":10,"dashDeceleration":6},"npcStartWaitingPlayerDistance":15,"npcStartChasingPlayerDistance":10}}')}},i={};function s(e){var n=i[e];if(void 0!==n)return n.exports;var o=i[e]={exports:{}};return t[e].call(o.exports,o,o.exports,s),o.exports}s.m=t,e=[],s.O=(t,i,n,o)=>{if(!i){var a=1/0;for(c=0;c<e.length;c++){for(var[i,n,o]=e[c],r=!0,l=0;l<i.length;l++)(!1&o||a>=o)&&Object.keys(s.O).every((e=>s.O[e](i[l])))?i.splice(l--,1):(r=!1,o<a&&(a=o));if(r){e.splice(c--,1);var h=n();void 0!==h&&(t=h)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[i,n,o]},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={179:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var n,o,[a,r,l]=i,h=0;if(a.some((t=>0!==e[t]))){for(n in r)s.o(r,n)&&(s.m[n]=r[n]);if(l)var c=l(s)}for(t&&t(i);h<a.length;h++)o=a[h],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(c)},i=self.webpackChunknakama_game=self.webpackChunknakama_game||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var n=s.O(void 0,[996],(()=>s(3607)));n=s.O(n)})();