(()=>{"use strict";var t,e={3607:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(o,n){function a(t){try{c(s.next(t))}catch(t){n(t)}}function r(t){try{c(s.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}c((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),i(5996),i(9520);const o=i(8838),n=i(6649),a=i(3579);!function(){s(this,void 0,void 0,(function*(){const t=document.getElementById("view");let e;(yield a.WebGPUEngine.IsSupportedAsync)?(e=new a.WebGPUEngine(t),yield e.initAsync()):e=new o.Engine(t,!0),new n.default(e).init().then((()=>{e.runRenderLoop((()=>{const t=e.scenes[0];t&&t.update()}))}))}))}()},671:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(7872);e.default=class{static get characters(){return s.characters}static get monsters(){return s.monsters}static get projectiles(){return s.projectiles}static getCharacter(t){return s.characters.find((e=>e.id===t))}static getMonster(t){return s.monsters.find((e=>e.id===t))}static getProjectile(t){return s.projectiles.find((e=>e.id===t))}}},871:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(2557),o=i(5038),n=i(8403),a=i(320),r=i(4473),c=i(3120);class l extends c.default{constructor(t,e){super(t,e),this._direction=0,this.addComponent(new n.default(this,t.hitpoint,1)),this.addComponent(new o.default(this,t.combat)),this.addComponent(new a.default(this,t.movement)),this.addComponent(new r.default(this,t.render)),this.addComponent(new s.default(this,t.animation))}get direction(){return this._direction}set direction(t){this._direction=t}load(t){super.load(t),this._direction=t.direction}save(){let t=super.save();return t.direction=this._direction,t}get type(){return c.GameObjectType.Character}}e.default=l},2557:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(8629),o=i(320),n=i(2025),a=i(8403);class r extends s.default{constructor(t,e=null){var i;super(t),this._groups={},this._config=e;const s=null!==(i=this.parent.findComponent(o.default))&&void 0!==i?i:this.parent.findComponent(n.default);s&&(s.onMove=t=>{t<.1?this.play("idle"):this.play("walk",t)});const r=this.parent.findComponent(a.default);r&&(r.onDeath=()=>{this.play("die")},r.onDamage=()=>{this.play("damage")})}_loadAnimation(t,e=1,i=!0){const s=this._groups[t.clip];if(!s)return console.warn(`Animation group ${t.clip} not found`),null;s.speedRatio=e*t.speed,s!==this._currentGroup&&(s.play(t.loop),i&&this._currentGroup&&this._currentGroup.stop(),this._currentGroup=s)}play(t,e=1,i=!0){let s;switch(t){case"idle":s=this._config.idle;break;case"walk":s=this._config.walk;break;case"attack":s=this._config.attack;break;case"die":s=this._config.die;break;case"damage":s=this._config.damage;break;default:return void console.warn(`Unknown animation clip ${t}`)}this._loadAnimation(s,e,i)}get type(){return s.ComponentType.Animation}update(){}setGroups(t){t.forEach((t=>{this._groups[t.name]=t}))}}e.default=r},5038:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(671),o=i(5176),n=i(3639),a=i(8629),r=i(8403);class c extends a.default{constructor(t=null,e=null){super(t),this._attackCooldown=0,this._config=e}get type(){return a.ComponentType.Combat}get canAttack(){return this._attackCooldown<=0}get team(){return this._parent.getComponent(r.default).team}attack(t){if(console.assert(this.canAttack,"Cannot attack"),console.log("Attack"),this._attackCooldown=o.default.getTicks(this._config.attackDelay),this._config.projectileId){const e=s.default.getProjectile(this._config.projectileId),i=new n.default(e,this._parent.level);i.init(t,this._config.shootDamage,this._config.projectileSpeed,this.team,this._config.shootRadius,o.default.getTicks(this._config.projectileLifetime)),i.position.set(this._parent.position.x,this._parent.position.y),i.direction=t,this._parent.gameObjectManager.addObject(i)}else{const t=this._parent.gameObjectManager.objects.values(),e=this._parent.position;for(const i of t){const t=i.position,s=t.x-e.x,o=t.y-e.y;if(Math.sqrt(s*s+o*o)<=this._config.shootRadius){const t=i.getComponent(r.default);t&&t.team!=this.team&&t.hit(this._config.shootDamage)}}}}update(){this._attackCooldown>0&&this._attackCooldown--}}e.default=c},8629:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.ComponentType=void 0,function(t){t[t.Movement=0]="Movement",t[t.Render=1]="Render",t[t.Animation=2]="Animation",t[t.MonsterMovement=3]="MonsterMovement",t[t.Combat=4]="Combat",t[t.MonsterCombat=5]="MonsterCombat",t[t.Hitpoint=6]="Hitpoint"}(i||(i={})),e.ComponentType=i,e.default=class{constructor(t){this._parent=t}destroy(){this._parent=null}get parent(){return this._parent}}},8403:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(5176),o=i(8629);class n extends o.default{constructor(t,e=null,i=0){super(t),this._config=e,this._hitpoint=e.max,this._regenDelay=0,this._team=i,this.onDamage=t=>{},this.onHeal=t=>{},this.onDeath=()=>{}}get type(){return o.ComponentType.Hitpoint}get alive(){return this._hitpoint>0}get hitpoint(){return this._hitpoint}get team(){return this._team}heal(t){this.alive&&(this._hitpoint=Math.min(this._hitpoint+t,this._config.max),this.onHeal(t))}hit(t){this.alive&&(this._hitpoint=Math.max(this._hitpoint-t,0),this._regenDelay=s.default.getTicks(this._config.regenDelay),this.onDamage(t),this.alive||(this._deathDespawnDelay=s.default.getTicks(.75),this.onDeath()))}update(){this._regenDelay--,this._regenDelay<=0&&this._config.regenAmount>0&&(this._regenDelay=s.default.getTicks(this._config.regenDelay),this.heal(this._config.regenAmount)),this.alive||(this._deathDespawnDelay--,this._deathDespawnDelay<=0&&this.parent.gameObjectManager.removeObject(this.parent))}}e.default=n},1076:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(3579),o=i(5038),n=i(8629),a=i(5176),r=i(2025);class c extends o.default{constructor(t,e=null){super(t,e),this._patrolPointIndex=-1,this._alertInRadius=e.alertInRadius,this._alertOutRadius=e.alertOutRadius,this._patrolRadius=e.patrolRadius}get type(){return n.ComponentType.MonsterCombat}update(){super.update(),this.parent.alive&&(null==this._patrolPoints&&this.calculatePatrolPoints(),this.checkAlert(),this.checkAttack(),this.checkPatrol())}checkAlert(){if(this._alertCheckDelay--,this._alertCheckDelay>0)return;this._alertCheckDelay=c.AlertCheckTimer;const t=this.findEnemyInRadius(this._alerted?this._alertOutRadius:this._alertInRadius);null!=t?(this._alerted=!0,this.setTarget(t)):(this._alerted=!1,this.setTarget(null))}checkAttack(){const t=this._currentTarget;if(null==t)return;if(!this.canAttack)return;const e=this._parent.position,i=t.position,o=s.Vector2.DistanceSquared(e,i),n=this.attackRange;if(o<=n*n){const t=i.subtract(e),s=Math.atan2(t.y,t.x);this.attack(s)}}checkPatrol(){if(!this._alerted){if(this.isOnPatrolPoint()){if(this._patrolStayTimer--,this._patrolStayTimer>0)return}else if(this._patrolPointIndex>=0)return;this._patrolStayTimer=c.PatrolStayTimer,this._patrolPointIndex=(this._patrolPointIndex+1)%this._patrolPoints.length,this.moveToPatrolPoint()}}moveToPatrolPoint(){-1!==this._patrolPointIndex&&this.parent.getComponent(r.default).moveTo(this._patrolPoints[this._patrolPointIndex])}setTarget(t){if(null===t&&null===this._currentTarget)return;this._currentTarget=t,this._currentTargetPosition=null==t?void 0:t.position.clone();const e=this.parent.getComponent(r.default);null!=t?e.moveTo(this.findBestAttackPosition()):(this._patrolStayTimer=c.PatrolStayTimer,this._patrolPointIndex=this.searchClosestPatrolPointIndex(),console.log("searchClosestPatrolPointIndex",this._patrolPointIndex),this.moveToPatrolPoint())}findBestAttackPosition(){const t=this._parent.position,e=this._currentTargetPosition.subtract(t),i=e.length()-.75*this.attackRange;return i<=0?t:t.add(e.normalize().scale(i))}get attackRange(){let t=this._config.shootRadius;return this._config.projectileId&&(t+=this._config.projectileSpeed*(.1*this._config.projectileLifetime)),t}findEnemyInRadius(t){const e=t*t,i=this._parent.gameObjectManager.objects.values();let o=null,n=Number.MAX_VALUE;for(const t of i)if(t.alive&&t.team!==this._parent.team){const i=s.Vector2.DistanceSquared(t.position,this._parent.position);i<=e&&i<n&&(n=i,o=t)}return o}calculatePatrolPoints(){this._patrolPoints=[],this._patrolPointIndex=-1;const t=this._parent.position.clone();for(let e=0;e<c.NumPatrolPoints;e++){const i=2*Math.PI*e/c.NumPatrolPoints,o=this._patrolRadius,n=t.x+o*Math.cos(i),a=t.y+o*Math.sin(i),r=new s.Vector2(n,a);this.parent.level.isPassableTile(r)&&this._patrolPoints.push(r)}for(let t=0;t<this._patrolPoints.length;t++){const e=Math.floor(Math.random()*this._patrolPoints.length),i=this._patrolPoints[t];this._patrolPoints[t]=this._patrolPoints[e],this._patrolPoints[e]=i}}searchClosestPatrolPointIndex(){const t=this._parent.position;let e=Number.MAX_VALUE,i=-1;for(let o=0;o<this._patrolPoints.length;o++){const n=s.Vector2.DistanceSquared(t,this._patrolPoints[o]);n<e&&(e=n,i=o)}return i}isOnPatrolPoint(){const t=this._parent.position,e=this._patrolPoints[this._patrolPointIndex];return s.Vector2.DistanceSquared(t,e)<=.1}}e.default=c,c.AlertCheckTimer=a.default.getTicks(1),c.PatrolStayTimer=a.default.getTicks(2.5),c.NumPatrolPoints=4},2025:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(3579),o=i(5176),n=i(8629),a=i(320);class r extends a.default{constructor(){super(...arguments),this.onMove=()=>{},this._path=[],this._pathIndex=0}moveTo(t){if(console.log("Move to",t),this.parent.position.equals(t))return;const e=this._parent.position,i=this._parent.level.tileMap.pathFinder.findPath(e,t);0!==i.length?(this._path=i,this._pathIndex=0):console.warn("No path found")}clearPath(){this._path=[],this._pathIndex=0,this._velocity=s.Vector2.Zero()}update(){if(!this.parent.alive)return;if(0===this._path.length)return;const t=this._config.speed*o.default.TICK_DELTA_TIME;this.updatePFMove(t),this.updateDirection(),0===this._path.length?this.onMove(0):this.onMove(1)}updatePFMove(t){const e=this._path[this._pathIndex],i=s.Vector2.Distance(this.parent.position,e);if(i<t)this.parent.position=e,this._pathIndex++,this._pathIndex>=this._path.length?this.clearPath():this.updatePFMove(t-i);else{const i=s.Vector2.Normalize(e.subtract(this.parent.position));this._velocity=i.scale(t),this.parent.position=this.parent.position.add(this._velocity)}}get type(){return n.ComponentType.MonsterMovement}}e.default=r},320:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MovementInput=void 0;const s=i(5412),o=i(5176),n=i(8629);class a extends n.default{constructor(t,e=null){super(t),this.onMove=()=>{},this._dashing=!1,this.input=new r,this._velocity=s.Vector2.Zero(),this._config=e}get type(){return n.ComponentType.Movement}update(){this.parent.alive&&(!1!==this._parent.level.isPassableTile(this._parent.position)?(this.updateMove(this.input),this.updateDirection()):console.warn("Character is not on passable tile"))}updateMove(t){let e=t.axis;if(e.lengthSquared()>1&&e.normalize(),t.dash&&!this._dashing){if(this._dashing=!0,t.dash=!1,0===e.lengthSquared()){const t=this._parent.direction-Math.PI/2;e.x=Math.cos(t),e.y=Math.sin(t),e.normalize()}this._velocity=e.scale(this._config.dashSpeed)}else this._dashing||0===e.lengthSquared()?(this._velocity=s.Vector2.Lerp(this._velocity,s.Vector2.Zero(),(this._dashing?this._config.dashDeceleration:this._config.deceleration)*o.default.TICK_DELTA_TIME),this._dashing&&(this._dashing=this._velocity.lengthSquared()>this._config.speed*this._config.speed)):this._velocity=s.Vector2.Lerp(this._velocity,e.scale(this._config.speed),this._config.acceleration*o.default.TICK_DELTA_TIME);const i=this._velocity.clone().scale(o.default.TICK_DELTA_TIME),n=this._parent.level;let a=this._parent.position.add(i);if(!n.isPassableTile(a)){const t=a.clone();t.x=this._parent.position.x,n.isPassableTile(t)?a=t:(t.x=a.x,t.y=this._parent.position.y,a=n.isPassableTile(t)?t:this._parent.position)}this._parent.position=a,this.onMove(this._velocity.length()/this._config.speed)}updateDirection(){let t=this._velocity;if(t.lengthSquared()>1&&(t=t.clone().normalize()),t.lengthSquared()>0){let e=Math.atan2(t.y,t.x);this.parent.direction=e+Math.PI/2}}}class r{constructor(){this.axis=s.Vector2.Zero(),this.dash=!1}}e.MovementInput=r,e.default=a},4473:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(3579),o=i(3063),n=i(2557),a=i(8629);class r extends a.default{constructor(t,e){super(t),this._handle=o.default.instance.load(e.model),this._handle.onLoaded=t=>{this._mesh=t.meshes[0],t.animationGroups.forEach((t=>{t.targetedAnimations.forEach((t=>{t.animation.enableBlending=!0,t.animation.blendingSpeed=.2}))})),this._mesh.scaling=new s.Vector3(-e.scale,e.scale,-e.scale);const i=this.parent.findComponent(n.default);i&&i.setGroups(t.animationGroups)}}destroy(){super.destroy(),this._mesh&&(this._mesh.dispose(),this._mesh=null),this._handle&&(this._handle.dispose(),this._handle=null)}get type(){return a.ComponentType.Render}update(){if(this._mesh){this._mesh.position.x=this.parent.position.x,this._mesh.position.z=this.parent.position.y;const t=this._mesh.rotation,e=new s.Vector3(0,-this.parent.direction,0).subtract(t);e.y>Math.PI&&(e.y-=2*Math.PI),e.y<-Math.PI&&(e.y+=2*Math.PI),this._mesh.rotation=t.add(e.scale(.2))}}}e.default=r},3120:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GameObjectType=void 0;const s=i(5412),o=i(8403);var n;e.default=class{constructor(t,e){this._components=new Map,this._level=e,this._config=t,this._id=-1,this._position=s.Vector2.Zero()}destroy(){this._components.forEach((t=>{t.destroy()})),this._components.clear()}get id(){return this._id}set id(t){this._id=t}get level(){return this._level}get gameObjectManager(){return this._level.gameObjectManager}get config(){return this._config}get position(){return this._position}set position(t){this._position=t}get direction(){return 0}set direction(t){}get team(){const t=this.findComponent(o.default);return t?t.team:-1}get alive(){const t=this.findComponent(o.default);return!!t&&t.alive}getComponent(t){const e=t.prototype.type;if(!this._components.has(e))throw new Error(`Component of type ${e} does not exist.`);return this._components.get(e)}findComponent(t){const e=t.prototype.type;return this._components.has(e)?this._components.get(e):null}addComponent(t){if(this._components.has(t.type))throw new Error(`Component of type ${t.type} already exists.`);this._components.set(t.type,t)}update(){this._components.forEach((t=>{t.update()}))}load(t){this._id=t.id,this._position=new s.Vector2(t.position.x,t.position.y)}save(){return{id:this._id,position:{x:this._position.x,y:this._position.y}}}},(n=e.GameObjectType||(e.GameObjectType={}))[n.Character=0]="Character",n[n.Monster=1]="Monster",n[n.Projectile=2]="Projectile"},5163:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(671),o=i(871),n=i(3120),a=i(3115);e.default=class{constructor(t){this.onNewObject=()=>{},this.onRemoveObject=()=>{},this._objects=new Map,this._nextId=0,this._level=t}get level(){return this._level}get objects(){return this._objects}addObject(t){if(-1==t.id?t.id=this._nextId++:this._nextId=Math.max(this._nextId,t.id+1),this._objects.has(t.id))throw new Error(`Object with id ${t.id} already exists.`);this._objects.set(t.id,t),this.onNewObject(t)}removeObject(t){if(!this._objects.has(t.id))throw new Error(`Object with id ${t.id} does not exist.`);t.destroy(),this._objects.delete(t.id),this.onRemoveObject(t)}getObject(t){return this._objects.get(t)}destroy(){this._objects.forEach((t=>{t.destroy()})),this._objects.clear(),this._nextId=0}load(t){this.destroy();for(let e=0;e<t.length;e++){const i=t[e],s=i.type,o=i.config,n=this.createObject(s,o);n.id=i.id,n.load(i),this.addObject(n)}}save(){let t=[];return this._objects.forEach((e=>{let i=e.save();i.type=e.type,i.config=e.config.id,i.id=e.id,t.push(i)})),t}update(){this._objects.forEach((t=>{t.update()}))}createObject(t,e){switch(t){case n.GameObjectType.Character:return new o.default(s.default.getCharacter(e),this._level);case n.GameObjectType.Monster:return new a.default(s.default.getMonster(e),this._level);default:throw new Error(`Unknown game object type: ${t}`)}}}},3115:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(2557),o=i(8403),n=i(1076),a=i(2025),r=i(4473),c=i(3120);class l extends c.default{constructor(t,e){super(t,e),this._direction=0,this.addComponent(new o.default(this,t.hitpoint)),this.addComponent(new a.default(this,t.movement)),this.addComponent(new n.default(this,t.combat)),this.addComponent(new r.default(this,t.render)),this.addComponent(new s.default(this,t.animation))}get direction(){return this._direction}set direction(t){this._direction=t}load(t){super.load(t),this._direction=t.direction}save(){let t=super.save();return t.direction=this._direction,t}get type(){return c.GameObjectType.Monster}}e.default=l},3639:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(3579),o=i(4473),n=i(3120),a=i(8403),r=i(5176);class c extends n.default{constructor(t,e){super(t,e),this.addComponent(new o.default(this,t.render))}init(t,e,i,s,o,n){this._direction=t,this._damage=e,this._speed=i,this._team=s,this._radius=o,this._lifeTime=n}get type(){return n.GameObjectType.Projectile}get direction(){return this._direction}set direction(t){this._direction=t}update(){if(this._lifeTime--,0==this._lifeTime)return void this.gameObjectManager.removeObject(this);const t=this.position,e=this.position.clone();e.x+=Math.cos(this._direction)*this._speed*r.default.TICK_DELTA_TIME,e.y+=Math.sin(this._direction)*this._speed*r.default.TICK_DELTA_TIME;const i=this.gameObjectManager.objects.values();for(const s of i){const i=s.position;if(this.isInLine(t,e,this._radius,i)){const t=s.findComponent(a.default);null!==t&&t.team!=this._team&&(t.hit(this._damage),this.gameObjectManager.removeObject(this))}}this.position=e,super.update()}isInLine(t,e,i,o){const n=t.clone().add(new s.Vector2(-i,-i)),a=t.clone().add(new s.Vector2(i,-i)),r=t.clone().add(new s.Vector2(i,i)),c=t.clone().add(new s.Vector2(-i,i)),l=this.isInTriangle(n,a,e,o),h=this.isInTriangle(a,r,e,o),p=this.isInTriangle(r,c,e,o);return l||h||p}isInTriangle(t,e,i,s){const o=s.x-t.x,n=s.y-t.y,a=(e.x-t.x)*n-(e.y-t.y)*o>0;return(i.x-t.x)*n-(i.y-t.y)*o>0!=a&&(i.x-e.x)*(s.y-e.y)-(i.y-e.y)*(s.x-e.x)>0==a}}e.default=c},4026:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Collider=void 0;const s=i(5163),o=i(7163);e.default=class{constructor(t,e){this._tileMap=new o.default(t,e),this._gameObjectManager=new s.default(this)}get size(){return this._tileMap.size}get resolution(){return this._tileMap.resolution}get gameObjectManager(){return this._gameObjectManager}get tileMap(){return this._tileMap}destroy(){this._gameObjectManager.destroy()}load(t){const e=t.objects;this._gameObjectManager.load(e)}save(){return{objects:this._gameObjectManager.save()}}isPassableTile(t){const e=this._tileMap.get(t),i=0!=(e&o.TileState.Terrain);return!(0!=(e&o.TileState.Water)&&!i)&&0==(e&o.TileState.Object)}update(){this._gameObjectManager.update()}},e.Collider=class{constructor(t,e){this.start=t,this.end=e}}},7163:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TileState=void 0;const s=i(3579),o=i(1502);class n{constructor(t,e){this._size=t,this._subSize=new s.Vector2(t.x*e,t.y*e),this._states=new Uint8Array(Math.ceil(this._subSize.x*this._subSize.y/n.TILE_PER_BYTE)),this._resolution=e,this._pathFinder=new o.default(this)}get size(){return this._size}get resolution(){return this._resolution}get states(){return this._states}get pathFinder(){return this._pathFinder}get(t){const e=Math.floor(t.x*this._resolution),i=Math.floor(t.y*this._resolution);return this.getSubTile(e,i)}set(t,e){const i=Math.floor(t.x*this._resolution),s=Math.floor(t.y*this._resolution);this.setSubTile(i,s,e)}getSubTile(t,e){if(t<0||t>=this._subSize.x||e<0||e>=this._subSize.y)return a.Object;const i=t+e*this._subSize.x,s=Math.floor(i/n.TILE_PER_BYTE),o=i%n.TILE_PER_BYTE*n.TILE_BITS_SIZE;return this._states[s]>>o&n.TILE_STATE_MASK}setSubTile(t,e,i){if(t<0||t>=this._subSize.x||e<0||e>=this._subSize.y)throw new Error("Position out of bounds");const s=t+e*this._subSize.x,o=Math.floor(s/n.TILE_PER_BYTE),a=s%n.TILE_PER_BYTE*n.TILE_BITS_SIZE;this._states[o]=this._states[o]&~(n.TILE_STATE_MASK<<a)|i<<a}updatePathFinder(){this._pathFinder.updateGrid()}destroy(){this._states=new Uint8Array(0)}}var a;e.default=n,n.TILE_BITS_SIZE=4,n.TILE_PER_BYTE=8/n.TILE_BITS_SIZE,n.TILE_STATE_MASK=(1<<n.TILE_BITS_SIZE)-1,function(t){t[t.None=0]="None",t[t.Terrain=1]="Terrain",t[t.Water=2]="Water",t[t.Object=4]="Object"}(a=e.TileState||(e.TileState={}))},5176:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this._tickNumber=0,this._startTimestamp=0}get tick(){return this._tickNumber}get timestamp(){return this._startTimestamp+Math.floor(this._tickNumber/i.TICKS_PER_SECOND)}static getTicks(t){return Math.floor(t*i.TICKS_PER_SECOND)}static getSeconds(t){return t/i.TICKS_PER_SECOND}}e.default=i,i.TICKS_PER_SECOND=60,i.TICK_DELTA_TIME=1/i.TICKS_PER_SECOND},1502:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(3579),o=i(7931),n=i(7163);e.default=class{constructor(t){this._tileMap=t,this.updateGrid()}updateGrid(){const t=this._tileMap.size,e=this._tileMap.resolution,i=new Array(t.y*e);for(let s=0;s<t.y*e;s++){i[s]=new Array(t.x*e);for(let o=0;o<t.x*e;o++){const t=this._tileMap.getSubTile(o,s),e=0!=(t&n.TileState.Terrain),a=0!=(t&n.TileState.Object);i[s][o]=e&&!a?0:1}}this._finder=new o.AStarFinder({grid:{width:t.x*e,height:t.y*e,matrix:i}})}findPath(t,e){console.log(`Finding path from ${t} to ${e}`);const i=new s.Vector2(Math.floor(t.x*this._tileMap.resolution),Math.floor(t.y*this._tileMap.resolution)),o=new s.Vector2(Math.floor(e.x*this._tileMap.resolution),Math.floor(e.y*this._tileMap.resolution)),n=this._tileMap.resolution;return this._finder.findPath(i,o).map((t=>new s.Vector2(t[0]/n,t[1]/n)))}}},7967:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(3579);e.default=class{constructor(t,e,i,o=10){this._scene=t,this._camera=new s.FlyCamera("camera",s.Vector3.Zero(),t),this._camera.mode=s.Camera.ORTHOGRAPHIC_CAMERA;const n=t.getEngine().getRenderingCanvasClientRect(),a=n.height/n.width;this._camera.orthoLeft=-20,this._camera.orthoRight=20,this._camera.orthoBottom=-20*a,this._camera.orthoTop=20*a,this._target=e,this._offset=i,this._speed=o}update(t){if(this._target){const e=new s.Vector3(this._target.position.x,0,this._target.position.y),i=this._camera.position,o=e.add(this._offset),n=s.Vector3.Lerp(i,o,this._speed*t);this._camera.position=n,this._camera.setTarget(e);const a=this._camera.rotation;a.y=0,a.z=0,this._camera.rotation=a}}destroy(){this._camera=null,this._target=null}}},7838:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(5038),o=i(320),n=i(4521);class a{constructor(t,e){this._attackDirection=null,this._character=e,t.onPointerDown=(t,e)=>{if(e.hit){const t=this._character.position,i=e.pickedPoint,s=Math.atan2(i.x-t.x,i.z-t.y);this._attackDirection=-s+Math.PI/2,console.log(s)}}}destroy(){this._character=null}get character(){return this._character}update(){const t=this._character.findComponent(o.default);if(t){const e=this.getKeyAxis(a.KEY_RIGHT)-this.getKeyAxis(a.KEY_LEFT),i=this.getKeyAxis(a.KEY_FORWARD)-this.getKeyAxis(a.KEY_BACKWARD),s=t.input;s.axis.x=e,s.axis.y=i,s.dash=s.dash||n.default.isKeyDown("Shift",!0)}if(null!==this._attackDirection){const t=this._character.findComponent(s.default);t&&t.canAttack&&t.attack(this._attackDirection),this._attackDirection=null}}getKeyAxis(t){return n.default.isKeyDown(t)?1:0}}e.default=a,a.KEY_FORWARD="z",a.KEY_BACKWARD="s",a.KEY_LEFT="q",a.KEY_RIGHT="d"},203:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(3579),o=i(7163);class n{constructor(t,e){this._scene=t,this._root=e,this._root.bakeCurrentTransformIntoVertices(!0),this._root.computeWorldMatrix(!0);const i=this._root.getChildMeshes();for(let t=0;t<i.length;t++){const e=i[t];e.computeWorldMatrix(!0),e.refreshBoundingInfo()}this.computePassableTiles()}computePassableTiles(){const t=this._scene.level,e=t.size.scale(t.resolution),i=t.resolution,o=this._root.getChildMeshes();for(let a=0;a<o.length;a++){const r=o[a];if(this.isPassableMesh(r))continue;const c=r.getBoundingInfo(),l=c.boundingBox.minimumWorld,h=c.boundingBox.maximumWorld,p=new s.Vector2(Math.floor(l.x*i),Math.floor(l.z*i)),d=new s.Vector2(Math.ceil(h.x*i),Math.ceil(h.z*i)),u=this.getMeshTileType(r);p.x=n.clamp(p.x,0,e.x-1),p.y=n.clamp(p.y,0,e.y-1),d.x=n.clamp(d.x,0,e.x-1),d.y=n.clamp(d.y,0,e.y-1);for(let e=p.x;e<d.x;e++)for(let s=p.y;s<d.y;s++){if(!n.insideMesh(r,e/i,s/i))continue;const o=t.tileMap.getSubTile(e,s);t.tileMap.setSubTile(e,s,o|u)}}t.tileMap.updatePathFinder(),this.dump()}isPassableMesh(t){return this.getMeshTileType(t)===o.TileState.None}getMeshTileType(t){return t.name.startsWith("Terrain")?o.TileState.Terrain:t.name.startsWith("Water")?o.TileState.Water:t.name.startsWith("Passable")?o.TileState.None:o.TileState.Object}update(t){}destroy(){this._root.dispose()}dump(){const t=this._scene.level,e=t.resolution,i=t.tileMap,s=t.size.x*e;let n="";for(let a=t.size.y*e;a>=0;a--){n+=a+" ";for(let t=0;t<s;t++){const e=i.getSubTile(t,a),s=0!=(e&o.TileState.Object),r=0!=(e&o.TileState.Terrain),c=0!=(e&o.TileState.Water);n+=s?"O":r?" ":c?"W":" "}n+="\r\n"}const a=document.createElement("a");a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(n)),a.setAttribute("download","map.txt"),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}static clamp(t,e,i){return t<e?e:t>i?i:t}static insideMesh(t,e,i){const o=new s.Vector3(e,-2,i),n=new s.Ray(o,s.Vector3.Up(),4).intersectsMesh(t,!1);return null!==n&&n.hit}}e.default=n},4521:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(3579);class o{static init(t){t.onKeyboardObservable.add((t=>{t.type===s.KeyboardEventTypes.KEYDOWN?o._keysDown[t.event.key]=!0:o._keysDown[t.event.key]=!1}))}static isKeyDown(t,e=!1){const i=o._keysDown[t]||!1;return i&&e&&(o._keysDown[t]=!1),i}static onKeyDown(t){o._keysDown[t]=!0}}e.default=o,o._keysDown={}},3063:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MeshAsyncHandle=void 0;const s=i(3579);class o{constructor(){this._queue=[],this._nextId=0}load(t){const e=new n(this._nextId++,t);return this._queue.push(e),e}executeQueue(){if(0!==this._queue.length){console.log(`Loading ${this._queue.length} meshes...`);for(const t of this._queue)s.SceneLoader.ImportMeshAsync(null,"assets/",t.path).then((e=>{t.result=e}));this._queue=[]}}}e.default=o,o.instance=new o;class n{constructor(t,e){this._onLoaded=t=>{},this._onDisposed=()=>{},this._id=t,this._path=e,this._isLoaded=!1,this._isDisposed=!1}get id(){return this._id}get path(){return this._path}get mesh(){return this._result}get isLoaded(){return this._isLoaded}set result(t){if(this._isDisposed)for(const e of t.meshes)e.dispose();else this._result=t,this._isLoaded=!0,this._onLoaded(this._result)}get onLoaded(){return this._onLoaded}set onLoaded(t){this._onLoaded=t,this._isLoaded&&this._onLoaded(this._result)}get onDisposed(){return this._onDisposed}set onDisposed(t){this._onDisposed=t,this._isDisposed&&this._onDisposed()}dispose(){if(this._isDisposed=!0,this._result){for(const t of this._result.meshes)t.dispose();this._onDisposed(),this._result=null}}}e.MeshAsyncHandle=n},3184:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(o,n){function a(t){try{c(s.next(t))}catch(t){n(t)}}function r(t){try{c(s.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}c((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const o=i(5897),n=i(4521),a=i(3063);class r extends o.Scene{constructor(t){super(t),this._sceneComponents=[]}init(){return s(this,void 0,void 0,(function*(){yield this.whenReadyAsync(),window.addEventListener("resize",(()=>{this.getEngine().resize()}))}))}update(){this.render();const t=this.getEngine().getDeltaTime()/1e3;this._sceneComponents.forEach((e=>e.update(t))),n.default.init(this),a.default.instance.executeQueue()}destroy(){this._sceneComponents.forEach((t=>t.destroy())),this._sceneComponents=[]}addComponent(t){this._sceneComponents.push(t)}}e.default=r},6649:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(o,n){function a(t){try{c(s.next(t))}catch(t){n(t)}}function r(t){try{c(s.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}c((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const o=i(3579),n=i(3184),a=i(7907),r=i(6752),c=i(3856),l=i(8841);class h extends n.default{constructor(t){super(t),this.onDispose=()=>{}}init(){const t=Object.create(null,{init:{get:()=>super.init}});return s(this,void 0,void 0,(function*(){yield t.init.call(this);var e=new o.CannonJSPlugin;this.enablePhysics(new o.Vector3(0,-9.81,0),e),this._createCamera(),this._createLight(),this._createSkybox(),this._createPlanets(),yield this._createSpaceship(),this._createDialogue()}))}_createCamera(){this._camera=new o.UniversalCamera("camera",new o.Vector3(0,0,-10),this),this._camera.maxZ=1e5}_createLight(){this._sun=new o.HemisphericLight("light1",new o.Vector3(1,1,0),this)}_createSkybox(){let t=o.MeshBuilder.CreateBox("skyBox",{size:1e4},this),e=new o.StandardMaterial("skyBox",this);e.backFaceCulling=!1,e.reflectionTexture=new o.CubeTexture("assets/space/img/skybox/skybox",this),e.reflectionTexture.coordinatesMode=o.Texture.SKYBOX_MODE,e.diffuseColor=new o.Color3(0,0,0),e.specularColor=new o.Color3(0,0,0),t.material=e,t.infiniteDistance=!0}_createPlanets(){this._planets=new a.PlanetManager(this),this._planets.createMeshes()}_createSpaceship(){return s(this,void 0,void 0,(function*(){let t=new r.Spaceship("assets/space/obj/","cockpit.glb",this,this._camera);yield t.spawnAsync(this._planets),t.subCollision((t=>this.onSpaceShipCollision(t)))}))}_createDialogue(){this._dialogue=new l.Dialogue,this._dialogue.addText("Bienvenue dans Nakama ! Nous sommes heureux de vous accueillir dans ce jeu spatial épique (1/4)",1e4),this._dialogue.addText("Avant de commencer, voici les commandes de votre vaisseau spatial : Z pour monter, S pour descendre, Q pour tourner à gauche et D pour tourner à droite (2/4)",1e4),this._dialogue.addText("Espace pour accélérer, et Shift pour ralentir. Assurez-vous de les maîtriser avant de partir à l'aventure. (3/4)",1e4),this._dialogue.addText("Votre mission est de naviguer dans l'espace et de trouver la planète la plus proche. Utilisez la touche E pour orienter votre vaisseau vers elle. Une fois que vous l'avez trouvée, atterrissez sur sa surface pour explorer ses merveilles. (4/4)",1e4)}update(){this._planets.update(this.getEngine().getDeltaTime()),this._dialogue.update(this.getEngine().getDeltaTime()),super.update()}onSpaceShipCollision(t){this.isDisposed||this._switchToWorldScene()}_switchToWorldScene(){const t=this.getEngine();new c.default(t).init().then((()=>{this.dispose()}))}}e.default=h},3856:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(o,n){function a(t){try{c(s.next(t))}catch(t){n(t)}}function r(t){try{c(s.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}c((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const o=i(3579),n=i(3120),a=i(4026),r=i(5176),c=i(7967),l=i(7838),h=i(203),p=i(3184),d=i(6649),u=i(8841);class _ extends p.default{constructor(t){super(t),this._logicTime=0,this._initialized=!1,this._level=new a.default(_.WORLD_SIZE,_.WORLD_PRECISION),this.onDispose=()=>{this._level.destroy()}}get level(){return this._level}init(){const t=Object.create(null,{init:{get:()=>super.init}});return s(this,void 0,void 0,(function*(){yield t.init.call(this),this._level.load({objects:[{type:n.GameObjectType.Character,config:1,id:1,position:new o.Vector2(50,50),direction:0},{type:n.GameObjectType.Monster,config:1,id:-1,position:new o.Vector2(60,60),direction:0},{type:n.GameObjectType.Monster,config:1,id:-1,position:new o.Vector2(40,40),direction:0},{type:n.GameObjectType.Monster,config:1,id:-1,position:new o.Vector2(35,25),direction:0},{type:n.GameObjectType.Monster,config:1,id:-1,position:new o.Vector2(35,75),direction:0},{type:n.GameObjectType.Monster,config:1,id:-1,position:new o.Vector2(33,73),direction:0},{type:n.GameObjectType.Monster,config:1,id:-1,position:new o.Vector2(37,75),direction:0},{type:n.GameObjectType.Monster,config:1,id:-1,position:new o.Vector2(35,77),direction:0}]});const e=this._level.gameObjectManager.getObject(1);this.addComponent(new l.default(this,e)),this.addComponent(new c.default(this,e,_.CAMERA_OFFSET,_.CAMERA_SPEED)),new o.HemisphericLight("light",new o.Vector3(0,1,0),this).intensity=1.4,yield this.createTerrain(),this._createDialogue(),this._initialized=!0}))}createTerrain(){return s(this,void 0,void 0,(function*(){const t=(yield o.SceneLoader.ImportMeshAsync(null,"./assets/models/scenes/","world.glb",this)).meshes[0];t.position=new o.Vector3(5,-5.25,30).add(_.WORLD_CENTER_3D),t.scaling=new o.Vector3(-5,5,5),this.addComponent(new h.default(this,t))}))}updateLogic(){if(!this._initialized)return;const t=this.getEngine().getDeltaTime()/1e3;for(this._logicTime+=t;this._logicTime>r.default.TICK_DELTA_TIME;)this._level.update(),this._logicTime-=r.default.TICK_DELTA_TIME;void 0===this.level.gameObjectManager.getObject(1)&&(this._initialized=!1,this.switchToSpace())}update(){this.updateLogic(),this._dialogue.update(this.getEngine().getDeltaTime()),super.update()}_createDialogue(){this._dialogue=new u.Dialogue,this._dialogue.clear(),this._dialogue.addText,this._dialogue.addText("Hmm... Cette planète est étrange. Je devrais aller voir ce qu'il se passe.",5e3),this._dialogue.addText("Avancer: Z | Reculer: S | Gauche: Q | Droite: D | Attaquer : Cliquer sur l'ennemi",3e4)}switchToSpace(){const t=this.getEngine();new d.default(t).init().then((()=>{this.dispose()}))}}e.default=_,_.CAMERA_SPEED=15,_.CAMERA_OFFSET=new o.Vector3(0,1500,-2e3),_.WORLD_PRECISION=4,_.WORLD_SIZE=new o.Vector2(100,100),_.WORLD_CENTER_3D=new o.Vector3(_.WORLD_SIZE.x/2,0,_.WORLD_SIZE.y/2)},8977:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Planet=void 0;const s=i(3579),o=i(5432);e.Planet=class{constructor(t,e,i,s,o,n){this._name=t,this._orbitRadius=e,this._orbitSpeed=i,this._rotationSpeed=s,this._diameter=o,this._texture=n}createMeshes(t){const e=s.MeshBuilder.CreateTorus(`${this._name}-orbit`,{diameter:2*this._orbitRadius,thickness:.01},t);this._orbitMesh=e,this._orbitMesh.visibility=.1;const i=s.MeshBuilder.CreateSphere(`${this._name}-planet`,{diameter:this._diameter},t);i.material=o.ToonMaterial.createMaterial(this._texture),this._planetMesh=i}update(t){this._orbitMesh&&this._planetMesh&&(this._planetMesh.rotation.y+=t*this._rotationSpeed,this._planetMesh.position.x=this._orbitRadius*Math.cos(Date.now()/1e3*this._orbitSpeed),this._planetMesh.position.z=this._orbitRadius*Math.sin(Date.now()/1e3*this._orbitSpeed))}getMesh(){return this._planetMesh}getRadius(){return this._diameter/2}dispose(){this._orbitMesh&&this._orbitMesh.dispose(),this._planetMesh&&this._planetMesh.dispose()}getName(){return this._name}}},7907:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PlanetManager=void 0;const s=i(3579),o=i(8977);e.PlanetManager=class{constructor(t){this._scale=.005,this._scene=t,this._planets=[];let e=new o.Planet("mercury",500,4e-4,1e-5,4879*this._scale,new s.Texture("assets/space/img/planets/2k_mercury.jpg",t)),i=new o.Planet("venus",875,.0035,1e-5,12104*this._scale,new s.Texture("assets/space/img/planets/2k_venus_surface.jpg",t)),n=new o.Planet("earth",1250,.003,1e-5,12742*this._scale,new s.Texture("assets/space/img/planets/2k_earth_daymap.jpg",t)),a=new o.Planet("mars",1875,.0024,1e-5,6779*this._scale,new s.Texture("assets/space/img/planets/2k_mars.jpg",t)),r=new o.Planet("jupiter",2500,.0013,1e-5,139820*this._scale,new s.Texture("assets/space/img/planets/2k_jupiter.jpg",t)),c=new o.Planet("saturn",3125,.009,1e-5,116460*this._scale,new s.Texture("assets/space/img/planets/2k_saturn.jpg",t)),l=new o.Planet("uranus",3750,7e-4,1e-5,50724*this._scale,new s.Texture("assets/space/img/planets/2k_uranus.jpg",t)),h=new o.Planet("neptune",4375,5e-4,1e-5,49244*this._scale,new s.Texture("assets/space/img/planets/2k_neptune.jpg",t)),p=new o.Planet("pluto",5e3,4e-4,1e-5,2376*this._scale,new s.Texture("assets/space/img/planets/2k_haumea_fictional.jpg",t));this._planets.push(e,i,n,a,r,c,l,h,p)}createMeshes(){this._planets.forEach((t=>{t.createMeshes(this._scene)}))}getPlanets(){return this._planets}update(t){this._planets.forEach((e=>{e.update(t)}))}getDistanceClosestPlanet(t){let e=Number.MAX_VALUE,i=null;return this._planets.forEach((o=>{let n=s.Vector3.Distance(t.position,o.getMesh().position)-o.getRadius();n<e&&(e=n,i=o)})),{planet:i,distance:e}}disposeAll(){this._planets.forEach((t=>{t.dispose()}))}}},6752:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(o,n){function a(t){try{c(s.next(t))}catch(t){n(t)}}function r(t){try{c(s.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}c((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.Spaceship=void 0;const o=i(3579),n=i(6376),a=i(7556),r=i(6527),c=i(1513),l=i(7650);e.Spaceship=class{constructor(t,e,i,s){this._speedCooldown=0,this._speedRefresh=.1,this._scaleFactor=.1,this._scaleSpeed=100,this._spaceshipCollisionObservable=new o.Observable,this._rootUrl=t,this._sceneFilename=e,this._scene=i,this._camera=s,this._speed=0,this._speedKm=0,this._velocity=new o.Vector3(0,0,0),this._maxSpeed=5*this._scaleFactor,this._acceleration=35*this._scaleFactor/this._scaleSpeed,this._deceleration=1*this._scaleFactor/this._scaleSpeed,this._rotationSpeedHori=0,this._rotationSpeedVer=0,this._maxRotationSpeed=.05,this._rotationAcceleration=.05,this._rotationDeceleration=.005,this._isGoingUp=!1,this._isGoingDown=!1,this._isGoingLeft=!1,this._isGoingRight=!1,this._isGoingForward=!1,this._isGoingBackward=!1}spawnAsync(t){return s(this,void 0,void 0,(function*(){this._planetManager=t,yield o.SceneLoader.ImportMeshAsync("",this._rootUrl,this._sceneFilename,this._scene).then(this.onSpawnSuccess.bind(this),(()=>{console.log("error loading spaceship")}))}))}onSpawnSuccess(t){this._spaceship=t.meshes[0],this._setupSpaceship(),this._applyShader(),this._setupCamera(),this._setupKeyboardInput(),this._setupShake(),this._setupEffect(),this._setupDashboard(),this._scene.onBeforeRenderObservable.add((()=>{this._update()}))}_applyShader(){}_setupDashboard(){this._dashboard=new l.Dashboard(this._scene,this._spaceship)}_setupEffect(){this._trailsEntry=new r.TrailsManager(50,this._scene,this._spaceship,.1,6,!0,a.ColorFactory.yellow()),this._trailsEntry.start(),this._trailsEntry.changeEmitRate(0),this._trailsSpeed=new r.TrailsManager(10,this._scene,this._spaceship,.5,20,!0,a.ColorFactory.purple()),this._trailsSpeed.start(),this._cloudEffect=new c.CloudEffect(this._scene,this._spaceship),this._cloudEffect.start()}_setupShake(){this._projectionMatrix=this._camera.getProjectionMatrix(),this._r=this._projectionMatrix.getRow(3),this._t=0}_setupSpaceship(){this._parentMesh=o.MeshBuilder.CreateBox("parentMesh",{size:1},this._scene),this._parentMesh.position=new o.Vector3(0,0,0),this._parentMesh.rotationQuaternion=o.Quaternion.Identity(),this._parentMesh.isVisible=!1,this._spaceship.parent=this._parentMesh,this._spaceship.rotationQuaternion=o.Quaternion.Identity(),this._parentMesh.physicsImpostor=new o.PhysicsImpostor(this._spaceship,o.PhysicsImpostor.BoxImpostor,{mass:0,restitution:.9,friction:0},this._scene),this._spaceship.scaling=new o.Vector3(this._scaleFactor,this._scaleFactor,this._scaleFactor)}_setupCamera(){this._camera.parent=this._spaceship,this._camera.position=new o.Vector3(0,.2,-1),this._camera.fov=1}_setupKeyboardInput(){this._scene.onKeyboardObservable.add((t=>{switch(t.type){case 1:switch(t.event.key){case"q":this._isGoingLeft=!0;break;case"d":this._isGoingRight=!0;break;case"z":this._isGoingUp=!0;break;case"s":this._isGoingDown=!0;break;case" ":this._isGoingForward=!0;break;case"Shift":this._isGoingBackward=!0;break;case"e":this.reorientToPlanet()}break;case 2:switch(t.event.key){case"q":this._isGoingLeft=!1;break;case"d":this._isGoingRight=!1;break;case"z":this._isGoingUp=!1;break;case"s":this._isGoingDown=!1;break;case" ":this._isGoingForward=!1;break;case"Shift":this._isGoingBackward=!1}}}))}_update(){if(this._updateDashboard(),this._shakeCamera(),this._lockMovement)return;var t=this._scene.getEngine().getDeltaTime()/1e3;let e=!1;this._isGoingBackward&&(this._speed+=this._acceleration*t,this._speed>=0?this._speed=0:this._speed>this._maxSpeed&&(this._speed=this._maxSpeed)),this._isGoingForward&&(this._speed-=this._acceleration*t,this._speed<-this._maxSpeed&&(this._speed=-this._maxSpeed)),this._isGoingRight&&(e=!0,this._rotationSpeedHori+=this._rotationAcceleration*t,this._rotationSpeedHori>this._maxRotationSpeed&&(this._rotationSpeedHori=this._maxRotationSpeed)),this._isGoingLeft&&(e=!0,this._rotationSpeedHori-=this._rotationAcceleration*t,this._rotationSpeedHori<-this._maxRotationSpeed&&(this._rotationSpeedHori=-this._maxRotationSpeed)),this._isGoingUp&&(e=!0,this._rotationSpeedVer+=this._rotationAcceleration*t,this._rotationSpeedVer>this._maxRotationSpeed&&(this._rotationSpeedVer=this._maxRotationSpeed)),this._isGoingDown&&(e=!0,this._rotationSpeedVer-=this._rotationAcceleration*t,this._rotationSpeedVer<-this._maxRotationSpeed&&(this._rotationSpeedVer=-this._maxRotationSpeed)),e||(this._rotationSpeedHori>0&&(this._rotationSpeedHori-=this._rotationDeceleration*t,this._rotationSpeedHori<0&&(this._rotationSpeedHori=0)),this._rotationSpeedHori<0&&(this._rotationSpeedHori+=this._rotationDeceleration*t,this._rotationSpeedHori>0&&(this._rotationSpeedHori=0)),this._rotationSpeedVer>0&&(this._rotationSpeedVer-=this._rotationDeceleration*t,this._rotationSpeedVer<0&&(this._rotationSpeedVer=0)),this._rotationSpeedVer<0&&(this._rotationSpeedVer+=this._rotationDeceleration*t,this._rotationSpeedVer>0&&(this._rotationSpeedVer=0)),this._speed>0?(this._speed-=this._deceleration*t,this._speed<0&&(this._speed=0)):this._speed<0&&(this._speed+=this._deceleration*t,this._speed>0&&(this._speed=0))),this._turnHorizontal(this._rotationSpeedHori),this._turnVertical(this._rotationSpeedVer),this._velocity=this._parentMesh.forward.scale(-this._speed),this._parentMesh.moveWithCollisions(this._velocity),this._computeSpeedKm(),this._planetData=this._planetManager.getDistanceClosestPlanet(this._parentMesh),this._updateEffects(),this._planetData.distance<=20&&this._fakeStop()}_updateEffects(){this._trailsSpeed.changeEmitRate(n.Utils.clamp(0,this._maxSpeed,-this._speed)),this._cloudEffect.changeEmitRate(1-n.Utils.clamp(0,150,this._planetData.distance)),this._trailsEntry.changeEmitRate(1-n.Utils.clamp(0,150,this._planetData.distance))}_fakeStop(){this._planetManager.disposeAll(),this._lockSpeed=this._speed,this._lockMovement=!0,console.log("fake stop on planet "+this._planetData.planet.getName()),this._spaceshipCollisionObservable.notifyObservers(this._planetData.planet)}_computeSpeedKm(){this._lockMovement||(this._speedCooldown-=this._scene.getEngine().getDeltaTime(),this._speedCooldown<=0&&(this._speedKm=3.6*-this._speed/this._speedRefresh*1/this._scaleFactor*this._scaleSpeed,this._speedCooldown=this._speedRefresh))}_turnHorizontal(t){const e=o.Quaternion.RotationAxis(o.Axis.Y,t);this._parentMesh.rotationQuaternion.multiplyInPlace(e)}_turnVertical(t){const e=o.Quaternion.RotationAxis(o.Axis.X,-t);this._parentMesh.rotationQuaternion.multiplyInPlace(e)}_shakeCamera(){let t=this._speed;this._lockMovement&&(t=this._lockSpeed),this._r.x+=.01*Math.cos(this._t)*n.Utils.clamp(0,this._maxSpeed,-t),this._r.y+=.01*Math.sin(this._t)*n.Utils.clamp(0,this._maxSpeed,-t),this._projectionMatrix.setRowFromFloats(3,this._r.x,this._r.y,this._r.z,this._r.w),this._t+=81337.18}_updateDashboard(){var t,e,i,s;let o=this._speed;this._lockMovement&&(o=this._lockSpeed),this._dashboard.setAllEngText(100*n.Utils.clamp(0,this._maxSpeed,-o)),this._dashboard.setSpeedText(this._speedKm),this._dashboard.setPlanetText(null!==(e=null===(t=this._planetData)||void 0===t?void 0:t.planet.getName())&&void 0!==e?e:"Inconnu"),this._dashboard.setDistanceText(null!==(s=(null===(i=this._planetData)||void 0===i?void 0:i.distance)*this._scaleSpeed)&&void 0!==s?s:0),this._dashboard.updateTime(),this._dashboard.updateFPSText()}reorientToPlanet(){this._planetData&&(this._lockMovement||(this._rotationSpeedHori=0,this._rotationSpeedVer=0,this._parentMesh.lookAt(this._planetData.planet.getMesh().position)))}subCollision(t){this._spaceshipCollisionObservable.add(t)}}},7556:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ColorFactory=void 0;const s=i(3579),o=i(5021);e.ColorFactory=class{static yellow(){return new o.ColorTheme(new s.Color4(1,1,.7,1),new s.Color4(1,1,.2,1),new s.Color4(.2,.2,0,.4))}static purple(){return new o.ColorTheme(new s.Color4(.9,0,.7,1),new s.Color4(.7,0,1,1),new s.Color4(.6,0,.26,.4))}}},5021:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ColorTheme=void 0,e.ColorTheme=class{constructor(t,e,i){this._color1=t,this._color2=e,this._color3=i}get color1(){return this._color1}get color2(){return this._color2}get color3(){return this._color3}}},1513:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CloudEffect=void 0;const s=i(3579);class o extends s.GPUParticleSystem{constructor(t,e){if(super("cloud",{capacity:1500},t),!s.GPUParticleSystem.IsSupported)throw new Error("GPUParticleSystem is not supported");this._meshSpace=e;let i=s.MeshBuilder.CreateBox("cloud",{size:1});i.visibility=0,i.parent=e,this.emitter=i,this.isLocal=!0,this.emitter.position=new s.Vector3(0,0,5),this.particleTexture=new s.Texture("/assets/space/effects/smoke_15.png",t),this.color1=new s.Color4(.8,.8,.8,.5),this.color2=new s.Color4(.95,.95,.95,.4),this.colorDead=new s.Color4(.9,.9,.9,.3),this.minSize=2,this.maxSize=4,this.minLifeTime=.1,this.maxLifeTime=1.2,this.emitRate=0,this._maxEmitRate=1e3,this.blendMode=s.ParticleSystem.BLENDMODE_STANDARD,this.gravity=new s.Vector3(0,0,0),this.direction1=new s.Vector3(0,0,0),this.direction2=new s.Vector3(0,0,0),this.minAngularSpeed=-2,this.maxAngularSpeed=2,this.minEmitBox=new s.Vector3(-6,-4,-.5),this.maxEmitBox=new s.Vector3(6,4,.5),this.minEmitPower=.5,this.maxEmitPower=1,this.updateSpeed=.005}changeEmitRate(t){this.emitRate=t*this._maxEmitRate,t<=0&&this.reset()}}e.CloudEffect=o},1866:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TrailsEffect=void 0;const s=i(3579);class o extends s.ParticleSystem{constructor(t,e,i,o,n){super(t,e,i);var a=s.MeshBuilder.CreateBox("box",{size:.01},i);this.particleTexture=new s.Texture("assets/space/effects/flare.png",i),a.parent=o,this.emitter=a,this.isLocal=!0,this.minEmitBox=new s.Vector3(0,0,0),this.maxEmitBox=new s.Vector3(0,0,0),this.color1=n.color1,this.color2=n.color2,this.colorDead=n.color3,this.minSize=.1,this.maxSize=.5,this.minLifeTime=.3,this.maxLifeTime=1.5,this.emitRate=200,this.blendMode=s.ParticleSystem.BLENDMODE_ONEONE,this.gravity=new s.Vector3(0,0,-10),this.direction1=new s.Vector3(-1,4,1),this.direction2=new s.Vector3(1,4,-1),this.minEmitPower=0,this.maxEmitPower=0,this.updateSpeed=.005}}e.TrailsEffect=o},6527:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TrailsManager=void 0;const s=i(3579),o=i(1866);e.TrailsManager=class{constructor(t,e,i,s,n,a,r){this.trails=[],this._maxEmitRate=200,this._maxGravity=-10,this._radius=s,this._distance=n,this._angled=a;for(let s=0;s<t;s++)this.trails.push(new o.TrailsEffect(s.toString(),200,e,i,r));this._setEmmitersPosition()}start(){this.trails.forEach((t=>{t.start()}))}_setEmmitersPosition(){let t=0,e=2*Math.PI/this.trails.length;this.trails.forEach((i=>{if(i.emitter instanceof s.Mesh){if(i.emitter.position.x=Math.cos(t)*this._radius,i.emitter.position.y=Math.sin(t)*this._radius,i.emitter.position.z=this._distance,this._angled){let e=new s.Vector3(5,5,1),o=new s.Vector3(Math.cos(t)*this._radius*-e.x,Math.sin(t)*this._radius*-e.y,this._distance*e.z);i.emitter.lookAt(o)}}else i.emitter instanceof s.Vector3&&(i.emitter.x=Math.cos(t)*this._radius,i.emitter.y=Math.sin(t)*this._radius,i.emitter.z=this._distance);t+=e}))}changeEmitRate(t){this.trails.forEach((e=>{e.emitRate=this._maxEmitRate*t,e.gravity=new s.Vector3(0,0,this._maxGravity*t)}))}}},5432:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ToonMaterial=void 0;const s=i(3579),o=i(7203);e.ToonMaterial=class{static createMaterial(t){let e=new o.NodeMaterial("Toon");var i=new o.InputBlock("position");i.visibleInInspector=!1,i.visibleOnFrame=!1,i.target=1,i.setAsAttribute("position");var n=new o.TransformBlock("worldPos");n.visibleInInspector=!1,n.visibleOnFrame=!1,n.target=1,n.complementZ=0,n.complementW=1;var a=new o.InputBlock("world");a.visibleInInspector=!1,a.visibleOnFrame=!1,a.target=1,a.setAsSystemValue(o.NodeMaterialSystemValues.World);var r=new o.TransformBlock("World normal");r.visibleInInspector=!1,r.visibleOnFrame=!1,r.target=1,r.complementZ=0,r.complementW=0;var c=new o.InputBlock("normal");c.visibleInInspector=!1,c.visibleOnFrame=!1,c.target=1,c.setAsAttribute("normal");var l=new o.VectorSplitterBlock("N");l.visibleInInspector=!1,l.visibleOnFrame=!1,l.target=4;var h=new o.NormalizeBlock("N (Normalized)");h.visibleInInspector=!1,h.visibleOnFrame=!1,h.target=4;var p=new o.DotBlock("N Dot L (Diffuse Light Intensity)");p.visibleInInspector=!1,p.visibleOnFrame=!1,p.target=4;var d=new o.NormalizeBlock("L (Normalized)");d.visibleInInspector=!1,d.visibleOnFrame=!1,d.target=4;var u=new o.LightInformationBlock("Light information");u.visibleInInspector=!1,u.visibleOnFrame=!1,u.target=1;var _=new o.AddBlock("H");_.visibleInInspector=!1,_.visibleOnFrame=!1,_.target=4;var m=new o.NormalizeBlock("V (Normalized)");m.visibleInInspector=!1,m.visibleOnFrame=!1,m.target=4;var g=new o.ViewDirectionBlock("View direction");g.visibleInInspector=!1,g.visibleOnFrame=!1,g.target=4;var f=new o.InputBlock("cameraPosition");f.visibleInInspector=!1,f.visibleOnFrame=!1,f.target=1,f.setAsSystemValue(o.NodeMaterialSystemValues.CameraPosition);var v=new o.DotBlock("N Dot V");v.visibleInInspector=!1,v.visibleOnFrame=!1,v.target=4;var T=new o.OneMinusBlock("1 - N Dot V");T.visibleInInspector=!1,T.visibleOnFrame=!1,T.target=4;var y=new o.MultiplyBlock("Rim INtensity");y.visibleInInspector=!1,y.visibleOnFrame=!1,y.target=4;var x=new o.PowBlock("Rim Factor");x.visibleInInspector=!1,x.visibleOnFrame=!1,x.target=4;var b=new o.InputBlock("Rim Intensity");b.visibleInInspector=!1,b.visibleOnFrame=!1,b.target=1,b.value=.4,b.min=0,b.max=0,b.isBoolean=!1,b.matrixMode=0,b.animationType=o.AnimatedInputBlockTypes.None,b.isConstant=!1;var w=new o.StepBlock("Quantized Rim Light Intensity");w.visibleInInspector=!1,w.visibleOnFrame=!1,w.target=4;var M=new o.InputBlock("Rim Cutoff");M.visibleInInspector=!1,M.visibleOnFrame=!1,M.target=1,M.value=.6,M.min=0,M.max=0,M.isBoolean=!1,M.matrixMode=0,M.animationType=o.AnimatedInputBlockTypes.None,M.isConstant=!1;var S=new o.ScaleBlock("Scale");S.visibleInInspector=!1,S.visibleOnFrame=!1,S.target=4;var I=new o.InputBlock("Rim Light Color");I.visibleInInspector=!1,I.visibleOnFrame=!1,I.target=1,I.value=new s.Color3(1,1,1),I.isConstant=!1;var P=new o.AddBlock("Add Rim + Spec + Diffuse + Ambient");P.visibleInInspector=!1,P.visibleOnFrame=!1,P.target=4;var C=new o.AddBlock("Add Specular + Diffuse + Ambient");C.visibleInInspector=!1,C.visibleOnFrame=!1,C.target=4;var O=new o.AddBlock("Add Ambient to Diffuse Light");O.visibleInInspector=!1,O.visibleOnFrame=!1,O.target=4;var k=new o.InputBlock("Ambient Light Color");k.visibleInInspector=!1,k.visibleOnFrame=!1,k.target=1,k.value=new s.Color3(.1803921568627451,.1803921568627451,.1803921568627451),k.isConstant=!1;var E=new o.ScaleBlock("Diffuse Light Calculation");E.visibleInInspector=!1,E.visibleOnFrame=!1,E.target=4;var D=new o.InputBlock("Diffuse Light Color");D.visibleInInspector=!1,D.visibleOnFrame=!1,D.target=1,D.value=new s.Color3(.6901960784313725,.6901960784313725,.6901960784313725),D.isConstant=!1;var j=new o.StepBlock("Quantized Diffuse Light Intensity");j.visibleInInspector=!1,j.visibleOnFrame=!1,j.target=4;var A=new o.InputBlock("Diffuse Cutoff");A.visibleInInspector=!1,A.visibleOnFrame=!1,A.target=1,A.value=0,A.min=0,A.max=0,A.isBoolean=!1,A.matrixMode=0,A.animationType=o.AnimatedInputBlockTypes.None,A.isConstant=!1;var B=new o.MultiplyBlock("Specular Factor");B.visibleInInspector=!1,B.visibleOnFrame=!1,B.target=4;var R=new o.DotBlock("N Dot H");R.visibleInInspector=!1,R.visibleOnFrame=!1,R.target=4;var F=new o.NormalizeBlock("H (Normalized)");F.visibleInInspector=!1,F.visibleOnFrame=!1,F.target=4;var V=new o.PowBlock("Specular Intensity");V.visibleInInspector=!1,V.visibleOnFrame=!1,V.target=4;var L=new o.MultiplyBlock("Glossiness ^2");L.visibleInInspector=!1,L.visibleOnFrame=!1,L.target=4;var N=new o.InputBlock("Glossiness");N.visibleInInspector=!1,N.visibleOnFrame=!1,N.target=1,N.value=5,N.min=0,N.max=0,N.isBoolean=!1,N.matrixMode=0,N.animationType=o.AnimatedInputBlockTypes.None,N.isConstant=!1;var G=new o.StepBlock("Quantized Specular Intensity");G.visibleInInspector=!1,G.visibleOnFrame=!1,G.target=4;var z=new o.InputBlock("Specular Cutoff");z.visibleInInspector=!1,z.visibleOnFrame=!1,z.target=1,z.value=.5,z.min=0,z.max=0,z.isBoolean=!1,z.matrixMode=0,z.animationType=o.AnimatedInputBlockTypes.None,z.isConstant=!1;var K=new o.ScaleBlock("Calculate Specular Light");K.visibleInInspector=!1,K.visibleOnFrame=!1,K.target=4;var H=new o.InputBlock("Color3");H.visibleInInspector=!1,H.visibleOnFrame=!1,H.target=1,H.value=new s.Color3(1,1,1),H.isConstant=!1;var U=new o.MultiplyBlock("Multiply Lighting by Color");U.visibleInInspector=!1,U.visibleOnFrame=!1,U.target=4;var W=new o.TextureBlock("Texture"),q=new o.InputBlock("uv"),Z=new o.ImageSourceBlock("Surface Texture");new o.InputBlock("Surface Color"),W.visibleInInspector=!1,W.visibleOnFrame=!1,W.target=3,W.convertToGammaSpace=!1,W.convertToLinearSpace=!1,W.disableLevelMultiplication=!1,W.texture=t,W.texture.wrapU=1,W.texture.wrapV=1,W.texture.uAng=0,W.texture.vAng=0,W.texture.wAng=0,W.texture.uOffset=0,W.texture.vOffset=0,W.texture.uScale=1,W.texture.vScale=1,W.texture.coordinatesMode=7,q.visibleInInspector=!1,q.visibleOnFrame=!1,q.target=1,q.setAsAttribute("uv"),Z.visibleInInspector=!1,Z.visibleOnFrame=!1,Z.target=3,Z.texture=t,Z.texture.wrapU=1,Z.texture.wrapV=1,Z.texture.uAng=0,Z.texture.vAng=0,Z.texture.wAng=0,Z.texture.uOffset=0,Z.texture.vOffset=0,Z.texture.uScale=1,Z.texture.vScale=1,Z.texture.coordinatesMode=7;var Y=new o.FragmentOutputBlock("fragmentOutput");Y.visibleInInspector=!1,Y.visibleOnFrame=!1,Y.target=2,Y.convertToGammaSpace=void 0,Y.convertToLinearSpace=void 0,Y.useLogarithmicDepth=!1;var Q=new o.TransformBlock("worldPos * viewProjectionTransform");Q.visibleInInspector=!1,Q.visibleOnFrame=!1,Q.target=1,Q.complementZ=0,Q.complementW=1;var $=new o.InputBlock("viewProjection");$.visibleInInspector=!1,$.visibleOnFrame=!1,$.target=1,$.setAsSystemValue(o.NodeMaterialSystemValues.ViewProjection);var X=new o.VertexOutputBlock("vertexOutput");return X.visibleInInspector=!1,X.visibleOnFrame=!1,X.target=1,i.output.connectTo(n.vector),a.output.connectTo(n.transform),n.output.connectTo(Q.vector),$.output.connectTo(Q.transform),Q.output.connectTo(X.vector),k.output.connectTo(O.left),D.output.connectTo(E.input),c.output.connectTo(r.vector),a.output.connectTo(r.transform),r.output.connectTo(l.xyzw),l.xyzOut.connectTo(h.input),h.output.connectTo(p.left),n.output.connectTo(u.worldPosition),u.direction.connectTo(d.input),d.output.connectTo(p.right),p.output.connectTo(j.value),A.output.connectTo(j.edge),j.output.connectTo(E.factor),E.output.connectTo(O.right),O.output.connectTo(C.left),H.output.connectTo(K.input),h.output.connectTo(R.left),n.output.connectTo(g.worldPosition),f.output.connectTo(g.cameraPosition),g.output.connectTo(m.input),m.output.connectTo(_.left),d.output.connectTo(_.right),_.output.connectTo(F.input),F.output.connectTo(R.right),R.output.connectTo(B.left),j.output.connectTo(B.right),B.output.connectTo(V.value),N.output.connectTo(L.left),N.output.connectTo(L.right),L.output.connectTo(V.power),V.output.connectTo(G.value),z.output.connectTo(G.edge),G.output.connectTo(K.factor),K.output.connectTo(C.right),C.output.connectTo(P.left),I.output.connectTo(S.input),h.output.connectTo(v.left),m.output.connectTo(v.right),v.output.connectTo(T.input),T.output.connectTo(y.left),p.output.connectTo(x.value),b.output.connectTo(x.power),x.output.connectTo(y.right),y.output.connectTo(w.value),M.output.connectTo(w.edge),w.output.connectTo(S.factor),S.output.connectTo(P.right),P.output.connectTo(U.left),q.output.connectTo(W.uv),Z.source.connectTo(W.source),W.rgb.connectTo(U.right),U.output.connectTo(Y.rgb),e.addOutputNode(X),e.addOutputNode(Y),e.build(),e}}},7650:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Dashboard=void 0;const s=i(3579),o=i(9848);e.Dashboard=class{constructor(t,e){this._scene=t,this.spaceship=e,this._initMesh(),this._initGUI()}_initMesh(){this._screenMesh=s.MeshBuilder.CreatePlane("screen",{width:1.75,height:1},this._scene),this._screenMesh.parent=this.spaceship,this._screenMesh.visibility=.75,this._screenMesh.position=new s.Vector3(0,-.2,1.5),this._screenMesh.rotation=new s.Vector3(.53,0,0)}_initGUI(){this._uiTexture=o.AdvancedDynamicTexture.CreateForMesh(this._screenMesh,2048,1170,!1),this._uiTexture.background="transparent",this._uiTexture.parseFromURLAsync("assets/space/ui/FullDashboard.json").then((()=>{let t=new s.StandardMaterial("mat",this._scene);t.diffuseTexture=this._uiTexture,t.backFaceCulling=!1,this._grabElement()}))}_grabElement(){this._speedText=this._uiTexture.getControlByName("SPEED"),this._eng1Text=this._uiTexture.getControlByName("ENG_1"),this._eng2Text=this._uiTexture.getControlByName("ENG_2"),this._eng3Text=this._uiTexture.getControlByName("ENG_3"),this._pressText=this._uiTexture.getControlByName("PRESS"),this._tempText=this._uiTexture.getControlByName("TEMP"),this._o2Text=this._uiTexture.getControlByName("O2"),this._timeText=this._uiTexture.getControlByName("TIME"),this._distanceText=this._uiTexture.getControlByName("DISTANCE"),this._fpsText=this._uiTexture.getControlByName("FPS"),this._planetText=this._uiTexture.getControlByName("PLANET")}setSpeedText(t){this._speedText&&(this._speedText.text=t.toFixed(0))}setEng1Text(t){this._eng1Text&&(this._eng1Text.text=t.toFixed(0)+"%")}setEng2Text(t){this._eng2Text&&(this._eng2Text.text=t.toFixed(0)+"%")}setEng3Text(t){this._eng3Text&&(this._eng3Text.text=t.toFixed(0)+"%")}setAllEngText(t){this.setEng1Text(t),this.setEng2Text(t),this.setEng3Text(t)}setPressText(t){this._pressText&&(this._pressText.text=t.toFixed(0)+"hPa")}setTempText(t){this._tempText&&(this._tempText.text=t.toFixed(0)+"°C")}setO2Text(t){this._o2Text&&(this._o2Text.text=t.toFixed(0)+"%")}updateTime(){if(!this._timeText)return;let t=new Date,e=t.getHours(),i=t.getMinutes(),s=t.getSeconds();this._timeText.text=(e<10?"0"+e:e)+":"+(i<10?"0"+i:i)+":"+(s<10?"0"+s:s)}setDistanceText(t){this._distanceText&&(this._distanceText.text=t.toFixed(0)+"km restant")}updateFPSText(){if(!this._fpsText)return;let t=this._scene.getEngine().getFps();this._fpsText.text=t.toFixed(0)+"fps"}setPlanetText(t){this._planetText&&(this._planetText.text=t)}}},8841:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Dialogue=void 0;const s=i(9848);class o{constructor(){this._texts=[],this._textTime=[],this.index=0,this._uiTexture=s.AdvancedDynamicTexture.CreateFullscreenUI("UI"),this._textBlock=new s.TextBlock,this._textBlock.text="Hello world",this._textBlock.color="white",this._textBlock.fontSize=24,this._textBlock.resizeToFit=!0,this._textBlock.verticalAlignment=s.Control.VERTICAL_ALIGNMENT_BOTTOM,this._textBlock.horizontalAlignment=s.Control.HORIZONTAL_ALIGNMENT_CENTER,this._textBlock.width=1,this._textBlock.height="40%",this._textBlock.textWrapping=!0,this._uiTexture.addControl(this._textBlock)}static getInstance(){return o.instance||(o.instance=new o),o.instance}addText(t,e){this._texts.push(t),this._textTime.push(e)}update(t){this._texts.length>0&&(this._textBlock.text=this._texts[this.index],this._textTime[this.index]-=t,this._textTime[this.index]<0&&(this._texts.splice(this.index,1),this._textTime.splice(this.index,1),this.index=this.index%this._texts.length))}clear(){this._texts=[],this._textTime=[]}}e.Dialogue=o},6376:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Utils=void 0,e.Utils=class{static clamp(t,e,i){let s=(i-t)/(e-t);return Math.min(Math.max(s,0),1)}}},7872:t=>{t.exports=JSON.parse('{"characters":[{"id":1,"name":"Character Test","hitpoint":{"max":100,"regenAmount":20,"regenDelay":10},"combat":{"attackDelay":1.5,"shootDamage":25,"shootRadius":1,"projectileId":1,"projectileSpeed":15,"projectileLifetime":1},"movement":{"speed":5,"dashSpeed":30,"acceleration":10,"deceleration":10,"dashDeceleration":6},"animation":{"idle":{"clip":"idle","loop":true,"speed":1},"walk":{"clip":"walk","loop":true,"speed":1.5},"attack":{"clip":"attack","loop":false,"speed":1},"die":{"clip":"die","loop":false,"speed":1},"damage":{"clip":"damage","loop":false,"speed":1}},"render":{"model":"models/characters/shriley.glb","scale":1}}],"monsters":[{"id":1,"name":"Slime Flower","hitpoint":{"max":50,"regenAmount":20,"regenDelay":60},"combat":{"attackDelay":1.5,"shootDamage":40,"shootRadius":1,"projectileId":1,"projectileSpeed":15,"projectileLifetime":1.5,"alertInRadius":7.5,"alertOutRadius":12,"patrolRadius":4},"movement":{"speed":2.5,"dashSpeed":30,"acceleration":10,"deceleration":10,"dashDeceleration":6},"animation":{"idle":{"clip":"idle","loop":true,"speed":1},"walk":{"clip":"move","loop":true,"speed":1},"attack":{"clip":"attack","loop":false,"speed":1},"die":{"clip":"die","loop":false,"speed":1},"damage":{"clip":"damage","loop":false,"speed":1}},"render":{"model":"models/monsters/slime_flower.glb","scale":0.9}}],"projectiles":[{"id":1,"name":"Slime Ball","render":{"model":"models/projectiles/fireball.glb","scale":0.4}}]}')}},i={};function s(t){var o=i[t];if(void 0!==o)return o.exports;var n=i[t]={id:t,loaded:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.loaded=!0,n.exports}s.m=e,t=[],s.O=(e,i,o,n)=>{if(!i){var a=1/0;for(h=0;h<t.length;h++){for(var[i,o,n]=t[h],r=!0,c=0;c<i.length;c++)(!1&n||a>=n)&&Object.keys(s.O).every((t=>s.O[t](i[c])))?i.splice(c--,1):(r=!1,n<a&&(a=n));if(r){t.splice(h--,1);var l=o();void 0!==l&&(e=l)}}return e}n=n||0;for(var h=t.length;h>0&&t[h-1][2]>n;h--)t[h]=t[h-1];t[h]=[i,o,n]},s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t={179:0};s.O.j=e=>0===t[e];var e=(e,i)=>{var o,n,[a,r,c]=i,l=0;if(a.some((e=>0!==t[e]))){for(o in r)s.o(r,o)&&(s.m[o]=r[o]);if(c)var h=c(s)}for(e&&e(i);l<a.length;l++)n=a[l],s.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return s.O(h)},i=self.webpackChunknakama_game=self.webpackChunknakama_game||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var o=s.O(void 0,[957],(()=>s(3607)));o=s.O(o)})();